/* mobilecaddy-utils - v2.0.1 - Bundle Time: 2018-11-28 11:16:04 */
/* git info: "2018-11-23 16:02:33 +0000": f458f3fe3659eef32ccde089f82b18d5376b87d6 (msd-628/p2m-fileUtils) */
/* Copyright 2018 MobileCaddy Ltd */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.debug=debug,exports.error=error,exports.errorAndDispatch=errorAndDispatch,exports.info=info,exports.log=log,exports.warn=warn;var appDataUtils=_interopRequireWildcard(require("./appDataUtils")),smartStoreUtils=_interopRequireWildcard(require("./smartStoreUtils"));function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var t=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};t.get||t.set?Object.defineProperty(o,r,t):o[r]=e[r]}return o.default=e,o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var LOG_LEVEL_ERROR=0,LOG_LEVEL_WARN=1,LOG_LEVEL_LOG=2,LOG_LEVEL_INFO=3,LOG_LEVEL_DEBUG=4;function insertLog(e,o){return new Promise(function(r,t){if(1==o.length&&(o=o[0]),"object"==_typeof(o)&&(o=JSON.stringify(o)),"number"!=typeof o&&"boolean"!=typeof o||(o=o.toString()),"string"==typeof o){e==LOG_LEVEL_ERROR&&localStorage.setItem("lastErrorLog",o.substring(0,1024));var n={mobilecaddy1__Error_Text__c:o.substring(0,1024),SystemModstamp:(new Date).getTime()},i=localStorage.getItem("appSoup-audId");n.mobilecaddy1__Application_User_Device__c=i,n.mobilecaddy1__Log_Type__c="D"+e.toString(),smartStoreUtils.insertRecords("Mobile_Log__mc",[n],function(e){r()},function(e){t(e)})}else error("Trying to log unsupported type",_typeof(o)),t("Trying to log unsupported type"+_typeof(o))})}function doLog(e,o,r,t){var n=localStorage.getItem("logLevel");if((n=void 0===n?0:n)>=o){var i="";if(o>0){var c=t.stack.split("\n")[4];if(void 0!==c){var s=c.indexOf("at ");i=c.slice(s+2,c.length)}}var a=r[0];switch(o){case LOG_LEVEL_ERROR:r[0]&&r[0].stack?a=r[0].message+", STACK:"+r[0].stack:r[1]&&r[1].stack?a+="\n"+r[1].message+", STACK:"+r[1].stack:a=r,insertLog(o,a),console.error.apply(console,r);break;case LOG_LEVEL_WARN:n>=LOG_LEVEL_WARN&&(insertLog(o,r),console.log.apply(console,r),console.log(i));break;default:n>=LOG_LEVEL_LOG&&(insertLog(o,r),console.log.apply(console,r),console.log(i))}e&&(console.info("Dispatching error"),"undefined"!=typeof LOCAL_DEV&&LOCAL_DEV&&alert(a+"\n\nSee dev console for more information"))}}function getErrorObject(){try{throw Error("")}catch(e){return e}}function debug(e){return doLog(!1,LOG_LEVEL_DEBUG,arguments,getErrorObject())}function error(e){return doLog(!1,LOG_LEVEL_ERROR,arguments)}function errorAndDispatch(e){return doLog(!0,LOG_LEVEL_ERROR,arguments)}function info(e){return doLog(!1,LOG_LEVEL_INFO,arguments,getErrorObject())}function log(e){return doLog(!1,LOG_LEVEL_LOG,arguments,getErrorObject())}function warn(e){return doLog(!1,LOG_LEVEL_WARN,arguments,getErrorObject())}