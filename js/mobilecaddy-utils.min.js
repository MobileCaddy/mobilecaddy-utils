/*! mobilecaddy-utils - v1.7.3 - Bundle Time: 2018-04-16 21:00:09 */
/* git info: "2018-03-29 13:33:39 +0100": a62ddb4ab029d3dee9d33bb6d3699c449d1fab61 (develop) */
/* Copyright 2018 MobileCaddy Ltd */

String.prototype.includes||(String.prototype.includes=function(e,n){"use strict";return"number"!=typeof n&&(n=0),!(n+e.length>this.length)&&-1!==this.indexOf(e,n)});var $j=jQuery.noConflict(),MC_TABLES=["Connection_Session__mc","Mobile_Log__mc","MC_Project__ap","MC_Time_Expense__ap","MC_Project_Location__ap"];!function(){var r,s,a,i,c;a={},i=[],c={},r=function(e){if(a[e]){if(e in c){var n=i.slice(c[e]).join("->")+"->"+e;console.error("Cycle in require graph: "+n)}}else console.error("module "+e+" not found");if(a[e].factory)try{return c[e]=i.length,i.push(e),o=a[e],t=o.factory,o.exports={},delete o.factory,t(r,o.exports,o),o.exports}finally{delete c[e],i.pop()}var o,t;return a[e].exports},(s=function(e,n){a[e]&&console.error("module "+e+" already defined"),a[e]={id:e,factory:n}}).remove=function(e){delete a[e]},"object"==typeof module&&"function"==typeof r&&(module.exports.require=r,module.exports.define=s),s("mobileCaddy",function(e,n,o){var t={define:s,require:e,START_PAGE_CONTROLLER:"",QUERY_BUFFER_SIZE:50,INITIAL_APPCACHE_INFO:[]};o.exports=t}),s("mobileCaddy/mobileLogger",function(e,n,o){function t(){try{throw Error("")}catch(e){return e}}function r(e,n){var o=n.stack.split("\n")[4],t="";if(void 0!==o){var r=o.indexOf("at ");t=o.slice(r+2,o.length)}console.log(e,t)}o.exports={logMessageAndThrow:function(e){!function(e,n){throw r(e,n),e}(e,t())},logMessage:function(e){r(e,t())},logObjectDetails:function(e){!function(e,n){for(var o in e)r("field:"+o+": has value :"+e[o]+":",n)}(e,t())}}}),s("mobileCaddy/geolocation",function(e,n,o){o.exports={getLocation:function(e,n){var o,t;o=e,(t=[]).Error="Location information is unavailable.",t.ErrorNumber=2,o(t)}}}),s("mobileCaddy/startup",function(r,e,n){var u=r("mobileCaddy/mobileLogger"),l=(r("mobileCaddy/logger"),cordova.require("com.salesforce.plugin.smartstore")),d=r("mobileCaddy/systemData"),f=r("mobileCaddy/smartStoreUtils");r("mobileCaddy/appDataUtils");console.log("Startup error listener"),window.addEventListener("error",function(e){var n=e.error?e.error.stack:null,o=e.error.toString();n&&(o+="\n"+n),console.log("Error event listener fired",JSON.stringify(o))});var t=100900,s=100901;function o(e,n){"progress"==e.type?(console.log("cache in progress"),mobileCaddy.INITIAL_APPCACHE_INFO.push({Name:"Event ",Description:e.loaded+" of "+e.total})):mobileCaddy.INITIAL_APPCACHE_INFO.push({Name:"Event ",Description:e.type});var o={};"udpateready"==e.type||(e.type="cached")?(console.log("cache in update ready or cached"),o.status=t):(console.log("cache in else"),o.status=s),console.log("return object "),u.logObjectDetails(o),n&&"function"==typeof n&&n(o)}function a(n){$j(function(){!function(n){mobileCaddy.INITIAL_APPCACHE_INFO=[],console.log("checkCache entry"),window.applicationCache.addEventListener("checking",function(e){o(e)},!1),window.applicationCache.addEventListener("downloading",function(e){o(e)},!1),window.applicationCache.addEventListener("progress",function(e){o(e)},!1),mobileCaddy.INITIAL_APPCACHE_INFO.push({Name:"AppCache: Initial Status",Description:window.applicationCache.status});var e={};switch(e.status=t,window.applicationCache.status){case window.applicationCache.CHECKING:case window.applicationCache.DOWNLOADING:throw window.applicationCache.addEventListener("updateready",function(e){o(e,n)},!1),window.applicationCache.addEventListener("cached",function(e){o(e,n)},!1),window.applicationCache.addEventListener("error",function(e){o(e,n)},!1),window.applicationCache.addEventListener("noupdate",function(e){o(e,n)},!1),new Error("MobileCaddy - Cache busy.  Will continue when check/load is complete");case window.applicationCache.UPDATEREADY:window.applicationCache.swapCache(),n(e),console.log("cache in updateready");break;default:console.log("cache in default"),n(e)}}(function(e){!function(a,i){console.log("prep platform cache status = "+i);var e=S("appSoupJson");if(""!==e){console.log("app soup json = "+JSON.stringify(e));var n=$j.parseJSON(e);l.registerSoup("appSoup",[{path:"Name",type:"string"},{path:"CurrentValue",type:"string"},{path:"NewValue",type:"string"}],function(){l.upsertSoupEntries("appSoup",n,function(e){l.registerSoup("cacheSoup",[{path:"Name",type:"string"},{path:"Description",type:"string"}],function(){c(a,i)},function(e){u.logMessage("Failed to create cache soup with error = "+e)})},function(e){u.logMessage("Failed to update app soup with error = "+e)})},function(e){u.logMessage("Failed to register app soup with error = "+e)})}else console.log("app soup json2 = "+e),LOCAL_DEV?(cacheSoupStructure=[{path:"Name",type:"string"},{path:"Description",type:"string"}],l.registerSoup("cacheSoup",cacheSoupStructure,function(){c(a,i)})):navigator.appVersion.includes("Electron")?l.soupExists("appSoup",function(e){if(e)c(a,i);else{var n=[],o=ipcRenderer.sendSync("request-creds","");console.log("creds",o);S("access_token","?"+o);if(n.push({Name:"accessToken",CurrentValue:S("access_token","?"+o),NewValue:null}),n.push({Name:"refreshToken",CurrentValue:S("refresh_token","?"+o),NewValue:null}),n.push({Name:"clientId",CurrentValue:S("client_id","?"+o),NewValue:null}),n.push({Name:"orgId",CurrentValue:S("org_id","?"+o),NewValue:null}),n.push({Name:"applicationName",CurrentValue:S("buildName","?"+o),NewValue:null}),n.push({Name:"buildName",CurrentValue:S("buildName","?"+o),NewValue:null}),window.location.pathname.startsWith("/apex/"))n.push({Name:"loginUrl",CurrentValue:window.location.protocol+"//"+window.location.host,NewValue:null});else{var t=window.location.pathname.split("/"),r=t[1];n.push({Name:"loginUrl",CurrentValue:window.location.protocol+"//"+window.location.host+"/"+r,NewValue:null})}var s=ipcRenderer.sendSync("request-device-info","");console.log("Device from Electron",JSON.stringify(s)),n.push({Name:"buildStatus",CurrentValue:"Initial"}),n.push({Name:"buildVersion",CurrentValue:s.buildVersion}),n.push({Name:"buildOS",CurrentValue:s.platform}),n.push({Name:"deviceUuid",CurrentValue:s.uuid});l.registerSoup("appSoup",[{path:"Name",type:"string"},{path:"CurrentValue",type:"string"},{path:"NewValue",type:"string"}],function(){l.upsertSoupEntries("appSoup",n,function(e){l.registerSoup("cacheSoup",[{path:"Name",type:"string"},{path:"Description",type:"string"}],function(){c(a,i)},function(e){u.logMessage("Failed to create cache soup with error = "+e)})},function(e){u.logMessage("Failed to update app soup with error = "+e)})},function(e){u.logMessage("Failed to register app soup with error = "+e)})}}):(document.addEventListener("deviceready",function(){c(a,i)},!1),document.addEventListener("backbutton",function(){},!0))}(n,e)})})}var p=100800,m=100801;function c(i,c){console.debug("cache status = "+JSON.stringify(c));r("mobileCaddy/logger");l.upsertSoupEntries("cacheSoup",mobileCaddy.INITIAL_APPCACHE_INFO,function(){f.querySoupRecsPromise("appSoup").then(function(e){var s={},a=[];if(e.forEach(function(e){if(void 0!==s[e.Name])throw"Should only be 1 "+e.Name+" entry in the app soup.  Found more";s[e.Name]=e}),s.userOverrideId||(s.userOverrideId=""),"Complete"==s.buildStatus.CurrentValue&&"Complete"==s.buildStatus.NewValue){if(null!==i){u.logMessage("build already complete - calling 3rd party callback function");var n={};if(n.status=m,n.mc_add_status=c.status,n.curVsn=s.dynVersionNumber.CurrentValue,void 0!==s.dynVersionNumber.NewValue&&(n.newVsn=s.dynVersionNumber.NewValue),navigator.appVersion.includes("Electron")){var o=window.location.protocol+"//"+window.location.host+window.location.pathname;ipcRenderer.send("startPageUrl",o)}i(n)}}else{var t=function(e,n){if(n.status){u.logMessage("Parse json aud"+e),a=$j.parseJSON(e);var o=_.find(a,{Name:"audId"}).CurrentValue,t=_.find(a,{Name:"sysDataPlatSupVersion"}).CurrentValue;if(navigator.appVersion.includes("Electron")){var r=window.location.protocol+"//"+window.location.host+window.location.pathname;ipcRenderer.send("startPageUrl",r)}new Promise(function(e,n){l.registerSoup("recsToSync",[{path:"Mobile_Table_Name",type:"string"},{path:"SOUP_Record_Id",type:"string"},{path:"Id",type:"string"},{path:"LastModifiedDateTime",type:"integer"},{path:"CRUD_Operation",type:"string"},{path:"Current_Connection_Session",type:"string"}],function(){e()},function(e){n(e)})}).then(function(){d.createSystemDataSoup(function(){f.buildMobileTables(function(){var e=s.buildStatus;e.CurrentValue="Complete",e.NewValue="Complete",a.map(function(e){return s[e.Name]&&(e._soupEntryId=s[e.Name]._soupEntryId),e}),a.push(e),l.upsertSoupEntries("appSoup",a,function(){d.getRecordTypeDots(o,t).then(function(){if(null!==i){var e={};e.status=p,e.mc_add_status=c.status,u.logMessage("Calling 3rd party callback"),u.logObjectDetails(e),i(e)}}).catch(function(e){u.logMessage("From getRecordTypeDots "+e)})},function(e){u.logMessage("From upsert soup records "+e)})},function(e){u.logMessage("Error building mobile tables "+e)})},function(e){u.logMessage("create system data soup returned error"+e)},o,t),u.logMessage("Exiting startup")}).catch(function(e){u.logMessage("Error building recs to sync soup "+e)})}else"exception"===n.type&&alert(n.message)};r("mobileCaddy/syncRefresh").heartBeat(function(e){console.log("getAudInfo heartbeat response",e),!0===USE_FORCETK?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getAUDInfo001",contentType:"application/json",data:{buildVersion:s.buildVersion.CurrentValue,buildName:s.buildName.CurrentValue,buildOS:s.buildOS.CurrentValue,deviceUuid:s.deviceUuid.CurrentValue,overrideUserId:force.getUserId(),startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN}},function(e){console.info("response -> "+JSON.stringify(e));var n={status:"200"};t(e,n)},function(e){console.error("err -> "+JSON.stringify(e)),error()}):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".getAudInfo",s.buildVersion.CurrentValue,s.buildName.CurrentValue,s.buildOS.CurrentValue,s.deviceUuid.CurrentValue,s.userOverrideId,t,{escape:!1,timeout:3e4})},function(e){console.log("getAudInfo heartbeat error",e),error()})}}).catch(function(e){console.error(e)})},function(e){u.logMessage("Failed to update app soup with initial app cache info = "+e)})}function S(e,n){n||(n=window.location.search),console.info("getUrlParamByName -> name = "+e),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(n);return console.log("getUrlParamByName results -> "+o),null===o?"":decodeURIComponent(o[1].replace(/\+/g," "))}n.exports={startup:function(e){a(e)}}}),s("mobileCaddy/systemData",function(e,n,o){var i=e("mobileCaddy/mobileLogger"),c=e("mobileCaddy"),u=e("mobileCaddy/logger"),l=cordova.require("com.salesforce.plugin.smartstore"),d=(c.require("mobileCaddy/smartStoreUtils"),e("mobileCaddy/appDataUtils"));function f(t,r,s,a){console.log("In getSystemDataSoupDefinition with audId = "+t+" and sysDataPlatSupVersion = "+r);var o=function(e,n){if(n.status){console.log("In getSystemDataSoupDefinition callback -> "+e),console.log("Parse json app defns"+e);var o=$j.parseJSON(e);console.log("Parse json app defns done"),$j.each(o,function(e,n){i.logObjectDetails(n)}),l.registerSoup("syncLib_system_data",o,function(){!function(e,n,t,r){console.log("In populate system data row values");var o=function(e,n){if(n.status){console.log("In remoting callback for getSysDataSoupVariables with record count = "+e.length);var o=$j.parseJSON(e);console.log("Parse json soup field defns done"),l.upsertSoupEntries("syncLib_system_data",o,t,r)}else"exception"===n.type?(alert(n.message),u.error("Exception return from getSystemDataRowValues = "+n.message)):u.error("Unknown return from getSystemDataRowValues = "+n.message)};!0===USE_FORCETK?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getSysDataSoupVariables001",contentType:"application/json",data:{audId:e,startPageControllerVersion:c.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:n}},function(e){var n={status:"200"};o(e,n)},r):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+c.START_PAGE_CONTROLLER+".getSysDataSoupVariables",e,n,o,{escape:!1})}(t,r,function(){!function(e,n,t,r){console.log(c.START_PAGE_CONTROLLER+".getDefsForSObjectMobileTables");var o=function(e,n){if(n.status){var o=$j.parseJSON(e);console.log("Parse json table defns done"),l.upsertSoupEntries("syncLib_system_data",o,function(e){console.log("successful upsert with rec count = "+e.length),t(e)},function(e){u.error("Error returned from upsert, message =  "+e),r(e)})}else"exception"===n.type?(alert(n.message),u.error("Exception return from getDefsForSObjectMobileTables = "+n.message)):u.error("Unknown return from getDefsForSObjectMobileTables = "+n.message)};!0===USE_FORCETK?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getDefsForSObjectMobileTables001",contentType:"application/json",data:{audId:e,startPageControllerVersion:c.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:n}},function(e){var n={status:"200"};o(e,n)},r):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+c.START_PAGE_CONTROLLER+".getDefsForSObjectMobileTables",e,n,o,{escape:!1,timeout:12e4})}(t,r,s,a)},a)},a)}else"exception"===n.type?(alert(n.message),u.error("Exception return from getSystemDataSoupDefinition = "+n.message)):u.error("Unknown return from getSystemDataSoupDefinition = "+n.message)};!0===USE_FORCETK?(console.debug("USE_FORCETK == true"),force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getSystemDataSoupDefinition001",contentType:"application/json",data:{audId:t,startPageControllerVersion:c.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:r}},function(e){var n={status:"200"};o(e,n)},a)):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+c.START_PAGE_CONTROLLER+".getSystemDataSoupDefinition",t,r,o,{escape:!1})}o.exports={createSystemDataSoup:function(e,n,o,t){var r,s,a,i;r=e,s=n,a=o,i=t,console.log("In createSystemDataSoup"),void 0!==a&&void 0!==i?f(a,i,r,s):d.getCurrentValueFromAppSoup("audId").then(function(e){return a=e,d.getCurrentValueFromAppSoup("sysDataPlatSupVersion")}).then(function(e){console.log("In success callback with aud id = "+a),f(a,e,r,s)}).catch(function(e){s(e)})},getRecordTypeDots:function(s){return new Promise(function(r,o){var n,t=function(t,e){console.log("getRecordTypeDots",n,t),e.status?l.registerSoup("dotsRecordTypes",[{path:"Table",type:"string"},{path:"Data",type:"string"}],function(e){var n=JSON.parse(t).map(function(e){return{Table:e.mobileTableName,Data:JSON.stringify(e.recTypeInfoList)}});console.log("upsertRecs",n),l.upsertSoupEntries("dotsRecordTypes",n,function(e){console.log("successful upsert with rec count = "+e.length);var o={};JSON.parse(t).forEach(function(e){var n={};e.recTypeInfoList.forEach(function(e){e.recTypeDevName?(n[e.recTypeId]={recTypeName:e.recTypeName,recTypeDevName:e.recTypeDevName},n[e.recTypeName]=e.recTypeId,n[e.recTypeDevName]=e.recTypeId):(n[e.recTypeId]=e.recTypeName,n[e.recTypeName]=e.recTypeId)}),o[e.mobileTableName]=n}),localStorage.setItem("lsDotsRecordTypes",JSON.stringify(o)),r()},function(e){u.error("Error returned from upsert, message =  "+e),o(e)})},function(e){o(e)}):("exception"===e.type?u.error("Exception return from p2mRefreshRecTypeDOTs = "+e.message):u.error("Unknown return from p2mRefreshRecTypeDOTs = "+e.message),o(e.message))};d.getCachedCurrentValueFromAppSoup("syncRefreshVersion").then(function(e){n=e,!0===USE_FORCETK?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/p2mRefreshRecTypeDOTs001",contentType:"application/json",data:{audId:s,startPageControllerVersion:c.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:n,connSessJson:"{}"}},function(e){var n={status:"200"};t(e,n)},function(e){t("[]",{status:"OK"})}):Visualforce.remoting.Manager.getAction("mobilecaddy1."+c.START_PAGE_CONTROLLER+".p2mRefreshRecTypeDOTs")?Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+c.START_PAGE_CONTROLLER+".p2mRefreshRecTypeDOTs",s,n,"{}",t,{escape:!1,timeout:12e4}):t("[]",{status:"OK"})})})}}}),s("mobileCaddy/smartStoreUtils",function(p,e,n){var f=p("mobileCaddy/mobileLogger"),m=cordova.require("com.salesforce.plugin.smartstore");function r(e,n,o){var t=[];function r(e){n(t)}function s(e){if(console.error("onCursorClosedError",e),console.error("onCursorClosedError",e.stack),!o)throw e;o(e)}!function e(n){$j.each(n.currentPageOrderedEntries,function(e,n){t.push(n)}),n.currentPageIndex<n.totalPages-1?cordova.require("com.salesforce.plugin.smartstore").moveCursorToNextPage(n,e):cordova.require("com.salesforce.plugin.smartstore").closeCursor(n,r,s)}(e)}function s(e,n,o){i("syncLib_system_data",m.buildExactQuerySpec("Name",e,mobileCaddy.QUERY_BUFFER_SIZE),function(e){console.log("soup definition rows success callback with rec count = "+e.length);var o=[];$j.each(e,function(e,n){console.log("processing record = "),n.Type!=mobileCaddy.STANDING_DATA_OBJECT&&n.Type!=mobileCaddy.DYNAMIC_DATA_OBJECT?(console.log("Record Match"),o.push(n)):console.log("Record does not match")}),n(o)},o)}function c(e,n,o){var t=m.buildAllQuerySpec("_soupEntryId",null,mobileCaddy.QUERY_BUFFER_SIZE);m.querySoup(e,t,function(e){r(e,function(e){n(e)},o)})}function i(n,e,o,t){m.querySoup(n,e,function(e){r(e,function(e){console.log("Passing records back to callback for soup = "+n+" and rec count = "+e.length),o(e)},t)},t)}function u(e,n,o){console.debug("smartQuerySoupRecordsWithQuerySpec",e),m.runSmartQuery(e,function(e){r(e,function(e){console.log("Passing records back to callback for soup with rec count = "+e.length),n(e)},o)},o)}function _(t,r,s,n,e){if(void 0===n&&void 0===e)return new Promise(function(n,o){var e=m.buildExactQuerySpec(r,s,mobileCaddy.QUERY_BUFFER_SIZE_SL);i(t,e,function(e){n(e)},function(e){o(e)})});var o=m.buildExactQuerySpec(r,s,mobileCaddy.QUERY_BUFFER_SIZE_SL);i(t,o,function(e){n(e)},e)}function S(e,n,o,t,r,s,a){i(e,m.buildExactQuerySpec(n,o,mobileCaddy.QUERY_BUFFER_SIZE_SL),function(e){var o=[];$j.each(e,function(e,n){n[t]==r&&o.push(n)}),s(o)},a)}function a(n,o,t){h("Row Mapping PT","Mobile Table Name",function(e){S("syncLib_system_data","MC_Var_String_001","Platform Table Definition",e,n,function(e){1!=e.length&&f.logMessageAndThrow("Should be exactly 1 table defn row for table: "+n+", but we got "+e.length),o(e[0])},t)},t)}function l(e,r){return new Promise(function(o,t){a(e,function(n){h("Row Mapping PT",r,function(e){o(n[e])},function(e){t(e)})},function(e){t(e)})})}function d(e,r,s){return new Promise(function(o,t){a(e,function(n){h("Row Mapping PT",r,function(e){n[e]=s,m.upsertSoupEntries("syncLib_system_data",[n],function(){o()},function(e){t(e)})},function(e){t(e)})},function(e){t(e)})})}function h(n,o,t,e){S("syncLib_system_data","MC_Var_String_001",n,"MC_Var_String_003",o,function(e){1!=e.length&&($j.each(e,function(e,n){f.logObjectDetails(n)}),f.logMessageAndThrow("Must be exactly 1 Row Mapping Record for Sys Data Row Type = "+n+" and Sys Data Row Value = "+o+" found count = "+e.length)),t(e[0].MC_Var_String_004)},e)}function g(s,e,o,n){i("syncLib_system_data",m.buildExactQuerySpec("MC_Var_String_001",s,mobileCaddy.QUERY_BUFFER_SIZE_SL),function(n){var r=[];$j.each(e,function(e,o){var t=!1;if($j.each(n,function(e,n){if(n.MC_Var_String_003==o)return r.push(n.MC_Var_String_004),void(t=!0)}),!t)throw"No mapping found for type = "+s+" and value = "+o}),o(r)},n)}var y=1,b=2;function t(n,r,o){g("Row Mapping PT",["Mobile Table Name","Build Order"],function(e){var t=e[0],s=e[1];_("syncLib_system_data","MC_Var_String_001","Platform Table Definition",function(e){var o=[];n==b?(e.sort(function(e,n){var o=0,t=parseInt(e[s]),r=parseInt(n[s]);return isNaN(t)||isNaN(r)||(o=t-r),o}),$j.each(e,function(e,n){o.push(n[t])})):($j.each(e,function(e,n){o.push(n[t])}),n==y&&o.sort()),null!==r&&r(o)},o)},o)}var C=0,o=1,R=2;function T(o,l,d,e){g("Row Mapping TC",["Parent SOUP Name","Table Column Name","Mobile Column Type","Application Field CRUD","META isNillable","Platform Column Type","Device Value Type","Proxy Ref Field Name"],function(e){var n=e[0],t=e[1],r=e[2],s=e[3],a=e[4],i=e[5],c=e[6],u=e[7];S("syncLib_system_data","MC_Var_String_001","Platform Table Column",n,o,function(e){var o=[];$j.each(e,function(e,n){l==C?o.push(n[t]):l==R?o.push({path:n[t],type:n[r],crud:n[s],nillable:n[a],platColType:n[i],appColType:n[c],proxyRefField:n[u]}):(o.push({path:n[t],type:n[r]}),console.log("path = "+n[t]+" and type = "+n[r]))}),d(o)},function(e){f.logMessage("Error retrieving column names = "+e)})},e)}function v(r,s){console.debug("About to buildMobileTables"),t(b,function(e){var n=e.length;$j.each(e,function(e,t){T(t,o,function(o){console.debug("tableColumnObjectArray -> "+o),m.registerSoup(t,o,function(){console.log("success on register soup "+t),d(t,"SOUP Built Date/Time",(new Date).getTime()).then(function(){var n;return console.log("success on update of soup build date time"),n=t,o.forEach(function(e){e.path.includes("MC_Proxy_ID")&&localStorage.setItem("proxyField-"+n,e.path)}),l(t,"Snapshot Data Required")}).then(function(e){"Yes"==e?m.registerSoup("SnapShot_"+t,o,function(){console.log("Success from build of SnapShot_"+t),d(t,"Snapshot SOUP Built Date/Time",(new Date).getTime()),0===--n&&r()},function(e){console.error("Fail on create of SnapShot_"+t+" "+e),s(e)}):0===--n&&r()}).catch(function(e){s(e)})},s)},function(e){console.error("Fail on create of table"+t+" "+e),s(e)})})},s)}function E(e,n,o,t){if(console.log("In delete recs from soup with rec count = "+e.length),0!==e.length){var r=[];$j.each(e,function(e,n){n&&n._soupEntryId&&r.push(n._soupEntryId)}),0!==r.length?m.removeFromSoup(n,r,function(e){console.log("Deleted rec(s) - calling callback"),o(e)},t):o()}else o()}function I(i,e,n,o,t){var c,u,l,d,f;p("mobileCaddy/syncRefresh");(c=i,u=e,l=n,d=u.length,f=0,new Promise(function(a,i){N(c).then(function(s){$j.each(u,function(t,r){_(c,l,r[l]).then(function(e){if(0<e.length){var n=e[0];for(var o in r)n[o]=r[o];u[t]=n,d<=++f&&a(u)}else"Id"==l&&18<r.Id.length?_(c,s,r.Id).then(function(e){if(0<e.length){var n=e[0];for(var o in r)"Id"!=o&&(n[o]=r[o]);u[t]=n,d<=++f&&a(u)}else i({status:101107})}):i({status:101107})}).catch(function(e){i(e)})})}).catch(function(e){i(e)})})).then(function(e){m.upsertSoupEntriesWithExternalId(i,e,n,function(e){_("recsToSync","Mobile_Table_Name",i,function(s){var a=[];$j.each(e,function(e,o){var t,n;if($j.each(s,function(e,n){n.Id!=o.Id||(t=n)}),void 0!==t)if(console.log("existingRecToSync",t),t.Current_Connection_Session&&void 0!==t.Current_Connection_Session)switch(t.CRUD_Operation){case"Insert":case"InsertUpdate":n="InsertUpdate";break;default:n="UpdateUpdate"}else n=t.CRUD_Operation;else n="Update";var r={Mobile_Table_Name:i,SOUP_Record_Id:o._soupEntryId,Id:o.Id,CRUD_Operation:n,LastModifiedDateTime:o.SystemModstamp};"InsertUpdate"!=n&&"UpdateUpdate"!=n||(r.Current_Connection_Session=t.Current_Connection_Session),a.push(r)}),m.upsertSoupEntriesWithExternalId("recsToSync",a,"Id",o,t)},t)},t)}).catch(function(e){t(e)})}function N(t){return new Promise(function(o,e){var n=localStorage.getItem("proxyField-"+t);n?o(n):(console.log("getProxyFieldName",t),T(t,C,function(e){var n=null;e.forEach(function(e){e.includes("MC_Proxy_ID")&&(n=e,localStorage.setItem("proxyField-"+t,e),console.log("GOT IT ",n))}),o(n)},function(e){console.error("listMobileTableColumns",JSON.stringify(e)),o(null)}))})}n.exports={NONE:0,ALPHA:y,BUILD:b,listMobileTables:function(e,n,o){t(e,n,o)},LIST:C,BUILD_OBJECT:o,FULL:R,listMobileTableColumns:function(e,n,o,t){T(e,n,o,t)},queryMobileTable:function(e,n,o,t,r){return _(e,n,o,t,r)},buildMobileTables:function(e,n){v(e,n)},getProxyFieldName:function(e){return N(e)},getSysDataRowMapColHeading:function(e,n,o,t){h(e,n,o,t)},getSysDataRowMapColHeadings:function(e,n,o,t){g(e,n,o,t)},getTableDefnColumnValue:function(e,n){return l(e,n)},setTableDefnColumnValue:function(e,n,o,t,r){return d(e,n,o)},queryMobileTableWithAnd:function(e,n,o,t,r,s,a){S(e,n,o,t,r,s,a)},smartQuerySoupRecordsWithQuerySpec:function(e,n,o){u(e,n,o)},insertRecords:function(e,n,o,t){var s,r,a,i,c;s=e,r=n,a=o,i=t,c=p("mobileCaddy/syncRefresh"),console.log("in insert records"),console.log("mobile table name = "+s),console.log("records = "+JSON.stringify(r)),console.log("records size = "+r.length),m.upsertSoupEntries(s,r,function(e){console.log("back from upsert soup with records = "+JSON.stringify(e));var r=(new Date).getTime();c.addProxyIds(s,e,r,function(e){console.log("back with proxy ids = "+JSON.stringify(e));var t=[];$j.each(e,function(e,n){var o={Mobile_Table_Name:s,CRUD_Operation:"Insert",SOUP_Record_Id:n._soupEntryId,Id:n.Id,LastModifiedDateTime:r};t.push(o)}),m.upsertSoupEntriesWithExternalId("recsToSync",t,"Id",a,i)},i)},i)},updateRecordsWithExternalId:function(e,n,o,t,r){I(e,n,o,t,r)},markSoupToSync:function(o,t,r){i("syncLib_system_data",m.buildExactQuerySpec("Type",mobileCaddy.DYNAMIC_DATA_OBJECT,mobileCaddy.QUERY_BUFFER_SIZE_SL),t,function(e){for(var n=0;n<e.length;n++)if(e[n].Name==o){e[n].Refresh_Indicator="Once",m.upsertSoupEntries("syncLib_system_data",[e[n]],t,r);break}})},emptySoup:function(e,n,o){var t=mobileCaddy.require("mobileCaddy/smartStoreUtils");m.removeSoup(e,function(){t.createSoup(e,n,o)},o)},emptySoupPromise:function(t){return new Promise(function(e,n){var o=mobileCaddy.require("mobileCaddy/smartStoreUtils");m.removeSoup(t,function(){o.createSoup(t,function(){console.debug("emptySoupPromise",t),e()},function(e){n(e)})},function(e){n(e)})})},deleteSoup:function(t){return console.debug("deleteSoup",t),new Promise(function(e,n){mobileCaddy.require("mobileCaddy/smartStoreUtils");var o=p("mobileCaddy/logger");m.removeSoup(t,function(){o.log("deleteSoup",t),e()},function(e){o.errorAndDispatch("deleteSoup",e),n(e)})})},createSoup:function(o,t,r){s(o,function(e){!function(e,n,o){console.log("in getQueryAndSoupDefinition");var t=[],r="Select ";$j.each(e,function(e,n){console.log("soup column defn = "),t.push({path:n.Column_Name,type:n.Column_Type}),0!==n.Column_Name.indexOf("_")&&(r+=n.Column_Name+",")}),r=r.substring(0,r.length-1),n(r+=" From "+e[0].Name,t)}(e,function(e,n){m.registerSoup(o,n,function(e){t()},r)})},r)},querySoupRecords:function(e,n,o){c(e,n,o)},querySoupRecsPromise:function(e){return t=e,new Promise(function(n,o){c(t,function(e){n(e.filter(function(e){return"object"==typeof e}))},function(e){o(e)})});var t},querySoupRecordsWithQuerySpec:function(e,n,o,t){i(e,n,o,t)},compareVersions:function(n,o){i("syncLib_system_data",cordova.require("com.salesforce.plugin.smartstore").buildExactQuerySpec("Name",mobileCaddy.VERSION_ID,mobileCaddy.QUERY_BUFFER_SIZE),function(e){simpleMessageSL("Version in soup = "+e[0].Value),getVersion(function(e){simpleMessageSL("Version in Salesforce = "+e),n()},o)},o)},deleteRecordsForExternalId:function(e,n,o,t,r){return function(s,n,a,t,r){if(!t&&!r)return new Promise(function(o,t){if(0===n.length)o();else{var r="";"object"==typeof n[0]?n.forEach(function(e,n){r+=0===n?"'"+e[a]+"'":",'"+e[a]+"'"}):n.forEach(function(e,n){r+=0===n?"'"+e+"'":", '"+e+"'"});var e="SELECT * FROM {"+s+"} WHERE {"+s+":"+a+"} IN ("+r+")";console.log("deleteRecordsForExternalId soql",e),querySpec=m.buildSmartQuerySpec(e),u(querySpec,function(e){console.log("recs",e);var n=e.map(function(e){return e[0]});m.removeFromSoup(s,n,function(e){o(e)},function(e){t(e)})},function(e){t(e)})}});if(0===n.length)t();else{var i=[];$j.each(n,function(e,n){i.push(n[a])}),c(s,function(e){var o=[];$j.each(e,function(e,n){-1!=i.indexOf(n[a])&&o.push(n._soupEntryId)}),0===o.length?t():m.removeFromSoup(s,o,t,r)},r)}}(e,n,o,t,r)},deleteRecordsFromSoup:function(e,n,o,t){E(e,n,o,t)},refreshSnapshot:function(e,n,o){var t,r,s;t=e,r=n,s=o,m.soupExists(t,function(e){e?m.soupExists("SnapShot_"+t,function(e){e?c("SnapShot_"+t,function(e){E(e,"SnapShot_"+t,function(){c(t,function(e){m.upsertSoupEntries("SnapShot_"+t,e,r,s)},s)},s)},s):f.logMessageAndThrow("SnapShot Table is missing: SnapShot_"+t)},s):f.logMessageAndThrow("Mobile Table is missing"+t)},s)}}}),s("mobileCaddy/appDataUtils",function(e,n,o){e("mobileCaddy/mobileLogger");var a=cordova.require("com.salesforce.plugin.smartstore"),i=e("mobileCaddy/smartStoreUtils");function r(t){return new Promise(function(n,o){var e=a.buildExactQuerySpec("Name",t,mobileCaddy.QUERY_BUFFER_SIZE);i.querySoupRecordsWithQuerySpec("appSoup",e,function(e){e[0]?n(e[0].CurrentValue):n(e[0])},function(e){o(e)})})}function t(t,r,s){return new Promise(function(n,o){var e=a.buildExactQuerySpec("Name",t,mobileCaddy.QUERY_BUFFER_SIZE);i.querySoupRecordsWithQuerySpec("appSoup",e,function(e){0<e.length?(e[0][s]=r,a.upsertSoupEntries("appSoup",e,function(e){n(e)},function(e){o(e)})):n()},function(e){o(e)})})}o.exports={getCurrentValueFromAppSoup:function(e){return r(e)},getCachedCurrentValueFromAppSoup:function(e){return o=e,t=localStorage.getItem("appSoup-"+o),new Promise(function(n,e){t?n(t):r(o).then(function(e){localStorage.setItem("appSoup-"+o,e),n(e)})});var o,t},updateNewValueInAppSoup:function(e,n){return t(e,n,"NewValue")},updateCurrentValueInAppSoup:function(e,n){return t(e,n,"CurrentValue")}}}),s("mobileCaddy/syncRefresh",function(r,e,n){var h=r("mobileCaddy/appDataUtils"),f=r("mobileCaddy/vsnUtils"),g=r("mobileCaddy/smartStoreUtils"),y=(r("mobileCaddy/mobileLogger"),r("mobileCaddy/logger")),b=cordova.require("com.salesforce.plugin.smartstore"),C=r("mobileCaddy/connSessUtils"),R="006";function T(d){return new Promise(function(s,n){var a=function(e){n(e)},i={};console.log("json object date time = "+d.lastRefreshDatetime);var c={},u={},l=d.mt;null===l&&console.error("Mobile Table (tag 'mt') empty in p2mRefresh response: ",d);var e=b.buildExactQuerySpec("Mobile_Table_Name",l,mobileCaddy.QUERY_BUFFER_SIZE);g.querySoupRecordsWithQuerySpec("recsToSync",e,function(o){$j.each(o,function(e,n){if("Insert"==n.CRUD_Operation||"InsertUpdate"==n.CRUD_Operation)c[n.Id]=1;else{if("Update"!=n.CRUD_Operation&&"UpdateUpdate"!=n.CRUD_Operation)return void y.error("RTS contains record with non support CRUD Operation"+n);u[n.Id]=1}}),g.getProxyFieldName(l).then(function(t){var r=[],n=[];($j.each(d.records,function(e,n){var o=!0;null!==n.recordData.MC_Proxy_ID__c&&c.hasOwnProperty(n.recordData[t])&&(o=!1),o&&u.hasOwnProperty(n.recordData.Id)&&(o=!1),o&&r.push(n.recordData)}),d.ds)&&d.ds.oq.concat(d.ds.sd.concat(d.ds.hd.concat(d.ds.sh))).forEach(function(e){u.hasOwnProperty(e)?console.log("We have a dirty local version, not deleting"):n.push({Id:e})});var e=b.buildExactQuerySpec("Mobile_Table_Name",l,mobileCaddy.QUERY_BUFFER_SIZE);g.querySoupRecordsWithQuerySpec("recsToSync",e,function(e){e.length==o.length?g.deleteRecordsForExternalId(l,n,"Id",function(){b.upsertSoupEntriesWithExternalId(l,r,"Id",function(){b.soupExists("SnapShot_"+l,function(e){e?g.deleteRecordsForExternalId("SnapShot_"+l,n,"Id",function(){b.upsertSoupEntriesWithExternalId("SnapShot_"+l,r,"Id",function(){f.checkForMigrateToInfo(d),p(d.platAuthUrl),i.status=0,i.cs=d.cs,i.cp=d.cp,i.lastRefreshDatetime=d.lastRefreshDatetime,s(i)},a)},a):(f.checkForMigrateToInfo(d),p(d.platAuthUrl),i.status=0,i.lastRefreshDatetime=d.lastRefreshDatetime,i.cs=d.cs,i.cp=d.cp,s(i))},a)},a)},a):(i.status=0,i.mc_add_status=1,i.cs=d.cs,i.cp=d.cp,i.lastRefreshDatetime=d.lastRefreshDatetime,resolves(i))},a)})},a)})}function p(n){console.log("setPlatAuthUrl",n),n||(n=""),h.updateCurrentValueInAppSoup("platAuthUrl",n).catch(function(e){y.error("setPlatAuthUrl",n,e)})}var v=100500,E=100402;function I(t,r,s){return new Promise(function(n,o){h.getCachedCurrentValueFromAppSoup("audId").then(function(e){n("PROXY%"+t+"%"+s+"%"+r+"%"+e)}).catch(function(e){o(e)})})}function N(e,n,o,t){var r;if("Throw Exception"==t)throw y.errorAndDispatch("nullHandler - NULL value found",e,n,o.Id),"NULL value found for field "+n+" in Mobile Table "+e+" with Id = "+o.Id;return"Return NULL"==t?r=null:"Return Empty String"==t&&(r=""),r}function D(t,s){return new Promise(function(n,e){if(console.log("syncRefreshVersion",t,R),t<R||!s)n();else{var o,r=[];g.queryMobileTable("recsToSync","Mobile_Table_Name","Connection_Session__mc").then(function(e){return o=e,console.log("rtsRecs",o),0<o.length?g.querySoupRecsPromise("Connection_Session__mc"):Promise.resolve([])}).then(function(t){console.log("csRecs",t),o.forEach(function(e){for(var n,o=0;o<t.length;++o)if(t[o].Id===e.Id){n=t[o];break}n&&r.push({Id:e.Id,t:function(e){switch(e){case"Sync - Refresh":return 1;case"Sync - Update":return 2;case"Status Check":return 3;default:return y.error("Unkown Session_Type__c",e),0}}(n.mobilecaddy1__Session_Type__c),s:function(e){switch(e){case"P2M RE Records Processed":return 1;case"P2M Conn_Sess Records Processed":return 2;case"P2M RE Abandoned":return 3;case"P2M RE Exception/Timeout":return 4;case"P2M RE Heartbeat Exception/Timeout":return 5;case"P2M RE Failure":return 6;case"P2M RE Hearbeat Failure":return 7;case"M2P Conn_Sess Records Processed":return 8;case"M2P Records Processed":return 9;case"M2P UP Failed - RTS Cleared":return 10;case"M2P SC - Status Check Processed":return 11;case"M2P SC Failure":return 12;case"M2P SC Exception/Timeout":return 13;case"M2P SC Heartbeat Exception/Timeout":return 14;case"M2P SC Heartbeat Failure":return 15;case"M2P UP Received - Records Processed":return 16;default:return y.error("Unkown CS status",e),0}}(n.mobilecaddy1__Mobile_Process_Status__c)})}),n(r)}).catch(function(e){y.error(e),n(null)})}})}function S(a,i,c,e,u,l,n,d,f,o,t){var p={MobileTable:a,connSessProxyId:o,records:[]};n.forEach(function(e){for(var n,o=0;o<d.length;++o)if(d[o].Id===e.Id){n=d[o];break}if(n){var t={RTSRowNum:e._soupEntryId,RecordCRUD:function(e){switch(e){case"Insert":return"I";case"InsertDelete":return"T";case"Update":return"U";case"UpdatetDelete":return"Q";case"Delete":return"D";default:return null}}(e.CRUD_Operation),fields:[]};switch(t.RecordCRUD){case"I":case"T":t=function(e,n,o,t,r,s,a,i){for(var c in i){var u={name:c};if("mobilecaddy1__Error_Text__c"==c)u.value=JSON.stringify(i[c]),e.fields.push(u);else if("_soupEntryId"!=c&&"_soupLastModifiedDate"!=c){var l,d={};d[t]=c;var f=_.findWhere(o,d);if(null===i[c])fieldNullHandler=f[s],l=N(n,c,i,fieldNullHandler);else if(l=i[c],f){var p=f[a];"M2P UP Unquoted"!=p||"true"!=l&&"false"!=l||(l="true"==l)}u.value=l,e.fields.push(u)}}return e}(t,a,i,c,0,u,l,n),p.records.push(t);break;case"D":case"U":case"Q":for(var r,s=0;s<f.length;++s)if(f[s].Id===e.Id){r=f[s];break}r?(t=function(e,n,o,t,r,s,a,i,c){var u=!1;for(var l in i)if("_soupEntryId"!=l&&"_soupLastModifiedDate"!=l){var d={name:l};if(i[l]!=c[l]||"SystemModstamp"==l){var f,p;u=!0;var m={};m[t]=l;var S=_.findWhere(o,m);if(null===i[l])fieldNullHandler=S[s],f=N(n,l,i,fieldNullHandler),p=N(n,l,c,fieldNullHandler);else if(f=i[l],p=c[l],S){var h=S[a];"M2P UP Unquoted"!=h||"true"!=f&&"false"!=f||(f="true"==f),"M2P UP Unquoted"!=h||"true"!=p&&"false"!=p||(p="true"==p)}d.previousValue=p,d.value=f,e.fields.push(d)}}return u?(e.fields.push({name:"Id",previousValue:c.Id,value:c.Id}),e):[]}(t,a,i,c,0,u,l,n,r),p.records.push(t)):y.errorAndDispatch("createUpdateJson Missing snapShot",a,n.Id);break;default:y.errorAndDispatch("createUpdateJson unknown CRUD",a,e.Id,e.CRUD_Operation)}}else y.errorAndDispatch("createUpdateJson Missing primary",a,e.Id)}),t(JSON.stringify(p))}function P(n,e,o,t,r){var s=[];$j.each(e,function(e,t){var r={};$j.each(o,function(e,n){if(t.Id==n.Id&&"Insert"==t.CRUD_Operation)for(var o in n)"_soupEntryId"!=o&&"_soupLastModifiedDate"!=o&&(r[o]=n[o])}),_.isEmpty(r)||s.push(r)}),0===s.length?t():g.getProxyFieldName(n).then(function(e){b.upsertSoupEntriesWithExternalId("SnapShot_"+n,s,e,t,r)})}function O(e,f,p,m,_,S){return new Promise(function(l,t){var e=r("mobileCaddy/geolocation"),d={};e.getLocation(function(r){var s,e,a,i,c,n,o={mobilecaddy1__Session_Type__c:f,mobilecaddy1__Mobile_Process_Status__c:p,SystemModstamp:(new Date).getTime()},u=r.ErrorNumber;0!==u?o.mobilecaddy1__Session_Created_Location_Error__c=r.Error:(o.Session_Created_Location__Longitude__s=r.Latitude,o.Session_Created_Location__Latitude__s=r.Longitude),s="Connection_Session__mc",e=o,a=function(e){var n=new Date,o={"Sync Session Proxy ID":null,"Total Sessions":_,"Session Number":m,"Device Call Date/Time":n.getTime(),"Connection Session Proxy ID":e.proxyId};S&&(o.CsPId=S),0!==u?o.ErrorNumber=u:(o["Location Long"]=r.Longitude,o["Location Lat"]=r.Latitude),d.status=0,d.connSessionRec=e.insertedRecord,d.connSessProxyId=e.proxyId;var t={version:"NULL"};window.device&&(t=window.device),h.getCurrentValueFromAppSoup("containerVersion").then(function(e){o.containerVsn=e,o.OSVsn=t.version,d.connSessJson=JSON.stringify(o),l(d)}).catch(function(e){y.error("buildConnectionSession - Could not get containerVsn",e),o.OSVsn=t.version,d.connSessJson=JSON.stringify(o),l(d)})},i=function(e){t(e)},c={},n=new Date,g.getProxyFieldName(s).then(function(t){b.upsertSoupEntries(s,[e],function(e){var o=e[0];I(s,o._soupEntryId,n.getTime()).then(function(n){o.Id=n,o[t]=n,b.upsertSoupEntries(s,[o],function(e){c.status=0,c.proxyId=n,c.insertedRecord=e[0],a(c)},i)}).catch(function(e){i(e)})},i)}).catch(function(e){i(e)})},function(e){t(e)})})}function o(p){return new Promise(function(n,o){var l={},d=function(e){n(e)},f=function(e){o(e)},e=b.buildExactQuerySpec("Mobile_Table_Name",p,mobileCaddy.QUERY_BUFFER_SIZE);g.querySoupRecordsWithQuerySpec("recsToSync",e,function(e){if(0!==e.length){console.debug("recsToSyncRecords",JSON.stringify(e));var c=!1;"Connection_Session__mc"!=p&&3e4<e.length&&(c=!0),console.log("moreToSync: "+c);var u=[];u=c?(u=_.sortBy(e,"_soupLastModifiedDate")).slice(0,3e4):e,console.debug("recsToSyncRecords2",JSON.stringify(u)),g.querySoupRecords(p,function(i){g.querySoupRecords("SnapShot_"+p,function(a){g.getSysDataRowMapColHeadings("Row Mapping TC",["Parent SOUP Name","Table Column Name","M2P Update Converter DEVICE","M2P Update NULL Handler DEVICE","M2P Update Formatter DEVICE"],function(e){var n=e[0],t=e[1],r=(e[2],e[3]),s=e[4];g.queryMobileTableWithAnd("syncLib_system_data","MC_Var_String_001","Platform Table Column",n,p,function(e){var o=[];if(_.each(u,function(e){var n;n=e.Id,_.find(i,function(e){return e.Id==n})&&o.push(e)}),_.isEmpty(o))return console.debug("Nothing in checkedRecsToSync."),void g.setTableDefnColumnValue(p,"Last Sync Date/Time",(new Date).getTime()).then(function(){l.status=U,l.mc_add_status=w,d(l)}).catch(function(e){y.error(e)});S(p,e,t,0,r,s,o,i,a,"",function(n){var t;h.getCachedCurrentValueFromAppSoup("audId").then(function(e){return t=e,h.getCachedCurrentValueFromAppSoup("syncRefreshVersion")}).then(function(e){P(p,u,i,function(){console.log("moreToSync: "+c);var o=function(e,n){console.debug("result: "+e),console.debug("event: "+n),l.result=e,l.event=n,d(l)};n=n.replace(/: undefined/g,': "undefined"'),console.debug("jsonString -> "+n),!0===USE_FORCETK?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pUpdateTable001",contentType:"application/json",data:{audId:t,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:e,mobileTableName:p,jsonRecords:n}},function(e,n){void 0===n&&((n={}).status="200"),o(e,n)},f):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".m2pUpdateTable",t,e,p,n,JSON.stringify({"Session Number":1,"Location Long":10,"Location Lat":10,"Total Sessions":1,"Device Call Date/Time":(new Date).getTime(),"Connection Session Proxy ID":"1",ErrorNumber:2}),o,{buffer:!1,escape:!1,timeout:3e4})},f)}).catch(function(e){f(e)})})},f)},f)},f)},f)}else g.setTableDefnColumnValue(p,"Last Sync Date/Time",(new Date).getTime()).then(function(){l.status=U,l.mc_add_status=w,d(l)}).catch(function(e){y.log("No recs to sync")})},f)})}var U=100300,w=100310;function s(u,a,l,d){var f,p,m={};console.debug("In m2pUpdateMobileTable call",u,a);try{h.getCachedCurrentValueFromAppSoup("syncRefreshVersion").then(function(e){return p=e,O(0,"Sync - Update","M2P Process Called",1,1,null)}).then(function(e){return f=e,console.log("proxy id = "+f.connSessProxyId),D(p,!0)}).then(function(e){console.log("m2p csUpdates",e),e&&(f.connSessJson=JSON.parse(f.connSessJson),f.connSessJson.csM2P=e,f.connSessJson=JSON.stringify(f.connSessJson)),console.log("connSessObject -> ",f);var n=b.buildExactQuerySpec("Mobile_Table_Name",u,mobileCaddy.QUERY_BUFFER_SIZE);g.querySoupRecordsWithQuerySpec("recsToSync",n,function(e){if(0!==e.length){console.debug("recsToSyncRecords",JSON.stringify(e));var c=!1;"Connection_Session__mc"!=u&&e.length>a&&(c=!0),console.log("moreToSync",c);var n=[];n=c?(n=_.sortBy(e,"_soupLastModifiedDate")).slice(0,a):e,console.debug("recsToSyncRecords2",JSON.stringify(n)),o=n,t=f.connSessProxyId,r=function(i){g.querySoupRecords(u,function(a){g.querySoupRecords("SnapShot_"+u,function(s){g.getSysDataRowMapColHeadings("Row Mapping TC",["Parent SOUP Name","Table Column Name","M2P Update Converter DEVICE","M2P Update NULL Handler DEVICE","M2P Update Formatter DEVICE"],function(e){var n=e[0],o=e[1],t=(e[2],e[3]),r=e[4];g.queryMobileTableWithAnd("syncLib_system_data","MC_Var_String_001","Platform Table Column",n,u,function(e){S(u,e,o,0,t,r,i,a,s,f.connSessProxyId,function(t){var n;h.getCachedCurrentValueFromAppSoup("audId").then(function(e){n=e,P(u,i,a,function(){console.log("moreToSync",c);var o=function(e,n){var o;(console.debug("result",e),console.debug("event",n),n.status)?(e=e.replace(/,}/g,"}"),console.log("Parse json processM2PUpdateResponse"),o=JSON.parse(e),console.log("Parse json processM2PUpdateResponse done"),C.processM2PUpdateResponse(o,t,function(e){console.debug("responseObject",JSON.stringify(e)),f.connSessionRec.mobilecaddy1__Mobile_Process_Status__c="Connection_Session__mc"==u?"M2P Conn_Sess Records Processed":"M2P Records Processed",f.connSessionRec.Id=e.csId,C.postProcessConnectionSession(f.connSessionRec).then(function(){return C.handleUpdatedCS(o.csM2P)}).then(function(){console.log("success return from post process"),console.log("success return from post process"),console.log("moreToSync",c),c?(m.status=U,m.mc_add_status="more-to-sync",l(m)):p<R?C.maybeSyncConnSess(f.connSessionRec,function(){console.log("success return from maybeSyncConnSess"),m.status=U,l(m)},d):(m.status=U,l(m))}).catch(function(e){d(e)})},d)):("exception"===n.type?(m.status=U,m.mc_add_status=M):(m.status=U,m.mc_add_status=A),l(m),y.error("m2pUpdate",u,n.message,n.where))};t=t.replace(/: undefined/g,': "undefined"'),console.debug("jsonString -> "+t),!0===USE_FORCETK?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pUpdateTable001",contentType:"application/json",data:{audId:n,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:p,mobileTableName:u,jsonRecords:t,connSessJson:f.connSessJson}},function(e,n){void 0===n&&((n={}).status="200"),o(e,n)},d):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".m2pUpdateTable",n,p,u,t,f.connSessJson,o,{buffer:!1,escape:!1,timeout:3e4})},d)}).catch(function(e){d(e)})})},d)},d)},d)},d)},s=d,$j.each(o,function(e,n){n.Current_Connection_Session=t}),b.upsertSoupEntriesWithExternalId("recsToSync",o,"Id",r,s)}else g.setTableDefnColumnValue(u,"Last Sync Date/Time",(new Date).getTime()).then(function(){m.status=U,m.mc_add_status=w,l(m)}).catch(function(e){d(e)});var o,t,r,s},d)},d)}catch(e){y.errorAndDispatch(e)}}var a=100100,M=100101,A=100102,t=100103,i=100104,c=100105;function u(o,e){var t={};Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".heartBeat",function(e,n){n.status?(t.status=a,o(t)):"exception"===n.type?l(function(e){console.log("refresh token refreshed in heartbeat"),t.status=c,o(t)},function(e){t.status=M,o(t)}):(console.debug("other"),t.status=A,o(t))},{escape:!1,timeout:3e4})}function l(o,t){g.querySoupRecords("appSoup",function(e){var n={};e.forEach(function(e){n[e.Name]=e.CurrentValue}),function(e,n,o){r("mobileCaddy/mobileLogger"),cordova.require("com.salesforce.plugin.smartstore");var t="grant_type=refresh_token&identity_url="+e.identityUrl+"&client_id="+e.clientId+"&refresh_token="+e.refreshToken+"&orgId="+e.orgId+"&audId="+e.audId+"&userId="+e.userId;console.log("data: "+t),$j.ajax({type:"POST",url:"https://mobilecaddy.secure.force.com/apex/ProxyToken",cache:!1,processData:!1,data:t,success:function(e){console.log("Changing vf access token from "+Visualforce.remoting.oauthAccessToken+" to "+e.access_token),Visualforce.remoting.oauthAccessToken=e.access_token,Visualforce.remoting.last.refresh(function(){h.updateCurrentValueInAppSoup("accessToken",e.access_token).then(function(){console.log("Updated accessToken in appSoup"),n(e.access_token)}).catch(function(e){o(e)})},function(e){y.error("in VF last refresh error"),o(e)})},error:function(e){y.error("failed to refresh access token "+JSON.stringify(e)),o(e)},dataType:"json",beforeSend:function(e){}})}(n,o,t)},function(e){t(e)})}n.exports={CSINHEAD_SYNC_VSN:R,refreshToken:function(e,n){l(e,n)},genProxyId:function(e,n,o){return I(e,n,o)},addProxyIds:function(e,n,o,t,r){var s,a,i,c,u,l;s=e,a=n,i=o,c=t,u=r,g.getProxyFieldName(s).then(function(e){return l=e,h.getCachedCurrentValueFromAppSoup("audId")}).then(function(t){$j.each(a,function(e,n){var o="PROXY%"+s+"%"+i+"%"+n._soupEntryId+"%"+t;n.Id=o,n[l]=o}),b.upsertSoupEntries(s,a,function(e){c(e)},u)}).catch(function(e){u(e)})},P2M_REFRESH_OK:v,p2mRefreshTable:function(e,n,o,t,r,s,a,i){!function s(a,i,c,o,n,t,u,l){console.log("Refreshing table",a);var r,d,f,p,m=function(e,n){if(console.debug("respJson",e),console.debug("event",n),n.status){var o,t,r=new RegExp("\n","g");e=e.replace(r,"\\n"),r=new RegExp("\r","g"),e=e.replace(r,""),t=JSON.parse(e),console.log("Parse json done"),T(t).then(function(e){return o=e,console.log("handle refresh res = "+o.status),g.setTableDefnColumnValue(a,"Last Refresh Date/Time",o.lastRefreshDatetime)}).then(function(){var e="P2M RE Records Processed";return"Connection_Session__mc"==a&&(e="P2M Conn_Sess Records Processed"),1==o.mc_add_status&&(e="P2M RE Abandoned"),p.connSessionRec.mobilecaddy1__Mobile_Process_Status__c=e,p.connSessionRec.Id=o.cs,C.postProcessConnectionSession(p.connSessionRec)}).then(function(){return C.handleUpdatedCS(t.csM2P)}).then(function(){console.log("success return from post process"),c&&d<R?C.maybeSyncConnSess(p.connSessionRec,function(){console.log("success return from maybeSyncConnSess"),t["Session Number"]&&t["Session Number"]<t["Total Sessions"]?(console.info("Page "+t["Session Number"]+" of "+t["Total Sessions"]+", going again."),s(a,i,c,t["Session Number"]+1,t["Total Sessions"],t.CsPId,u,l)):t.moreBatches?(console.info("moreBatches"),s(a,i,c,"newBatch",1,null,u,l)):(_.status=v,u(_))},l):t["Session Number"]&&t["Session Number"]<t["Total Sessions"]?(console.info("Page "+t["Session Number"]+" of "+t["Total Sessions"]+", going again."),s(a,i,c,t["Session Number"]+1,t["Total Sessions"],t.CsPId,u,l)):t.moreBatches?(console.info("moreBatches"),s(a,i,c,"newBatch",1,null,u,l)):(console.log("No more pages or batches"),_.status=v,u(_))}).catch(function(e){l(e)})}else"exception"===n.type&&y.error("p2mRefresh",a,n.message,n.where),C.cleanConnectionSessionVFEvent(n,p,function(e){_.status=E,_.mc_add_status=e.mc_add_status,u(_)},l)},_={},S="newBatch"==o;S&&(o=1);try{g.getTableDefnColumnValue(a,"Last Refresh Date/Time").then(function(e){(f=e)&&"null"!=f||(f=0),console.log("Using lastRefreshDatetime = "+f),console.debug("maxTableAge",i);var n=new Date;return f<n-i||1<o||S?h.getCachedCurrentValueFromAppSoup("audId"):(console.log("Not refreshing table. it is too young"),_.status=100402,_.status=100497,Promise.reject(_))}).then(function(e){return r=e,h.getCachedCurrentValueFromAppSoup("syncRefreshVersion")}).then(function(e){return O(d=e,"Sync - Refresh","P2M RE Process Called",o,n,t)}).then(function(e){if(p=e,!c){var n=JSON.parse(p.connSessJson);n.initialSync=!0,p.connSessJson=JSON.stringify(n)}if(S){var o=JSON.parse(p.connSessJson);o.firstBatch=!1,p.connSessJson=JSON.stringify(o)}return D(d,c)}).then(function(e){console.log("csUpdates",e),e&&(p.connSessJson=JSON.parse(p.connSessJson),p.connSessJson.csM2P=e,p.connSessJson=JSON.stringify(p.connSessJson)),console.log("connSessObject -> ",p),!0===USE_FORCETK?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/p2mRefreshTable001",contentType:"application/json",data:{audId:r,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:d,mobileTableName:a,deviceRefreshIds:[],lastRefreshDateTime:f,thirdPartyJson:"",connSessJson:p.connSessJson}},function(e,n){void 0===n&&((n={}).status="200"),m(e,n)},l):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".p2mRefreshTable",r,d,a,[],f,"",p.connSessJson,m,{buffer:!1,escape:!1,timeout:12e4})}).catch(function(e){100497==e.status?u(e):(y.error(e),l(e))})}catch(e){y.errorAndDispatch(e)}}(e,n,o,t,r,s,a,i)},buildConnectionSession:function(e,n,o,t,r,s){return O(0,n,o,t,r,s)},M2P_UPDATE_OK:U,M2P_NO_RECS_TO_SYNC:w,m2pUpdateMobileTable:function(e,n,o,t){s(e,n,o,t)},m2pRecoveryUpdateMobileTable:function(e){return o(e)},HEARTBEAT_OK:a,HEARTBEAT_EXCEPTION:M,HEARTBEAT_FAILURE:A,HEARTBEAT_NO_CONNECTION:t,HEARTBEAT_NOT_DEVICE:i,HEARTBEAT_REFRESHED_OK:c,heartBeat:function(e,n){!function(r,e){var s={},n=navigator.appVersion.includes("Electron");if(n||navigator&&navigator.connection&&"undefined"!=typeof Connection)if(console.log("Connection details"),n||navigator.connection.type!=Connection.NONE)if("undefined"==typeof Visualforce){y.log("Visualforce not currently defined");var a=window.location.pathname;$j.get(a).done(function(e){y.log("Startpage re-fetched",a);var t=new RegExp('"(\\S+VFRemote.js)"').exec(e);if(t[0]){var n=t[1];$j.getScript(n).done(function(){y.log("remote script fetched",n),new Function($j("script")[2].innerHTML)(),y.log("set up Visualforce ref"),u(r)}).fail(function(e,n,o){y.errorAndDispatch("vfRemote Load Error",t[0],o),s.status=A,r(s)})}else y.errorAndDispatch("heartBeat Could not find VFRemote src",a),s.status=A,r(s)}).fail(function(e,n,o){y.errorAndDispatch("Startpage Load Error",a,o),s.status=A,r(s)})}else u(r);else s.status=t,r(s);else localStorage.connection?s.status=localStorage.connection:s.status=i,r(s)}(e)},handleRefreshResponse:function(o){return new Promise(function(e,n){T(o)})},createUpdateJson:S}}),s("mobileCaddy/connSessUtils",function(V,n,o){var y=100200,l=100201;function t(a,h,g){var o=V("mobileCaddy/syncRefresh"),t=V("mobileCaddy/appDataUtils"),r=V("mobileCaddy/connSessUtils"),i=V("mobileCaddy/smartStoreUtils"),c=V("mobileCaddy/logger");console.debug("csStatusCheck -> "+a);try{var u;t.getCachedCurrentValueFromAppSoup("syncRefreshVersion").then(function(e){return u=e,o.buildConnectionSession(u,"Status Check","M2P SC Status Check Requested",1,1,null)}).then(function(S){o.heartBeat(function(n){var s;n.status==o.HEARTBEAT_OK||n.status==o.HEARTBEAT_NOT_DEVICE||n.status==o.HEARTBEAT_REFRESHED_OK?t.getCachedCurrentValueFromAppSoup("audId").then(function(n){s=n;var o=function(n,o){var _;o.status?((_=JSON.parse(n)).cs_fc_jr&&(_.cs_fc_jr=JSON.parse(_.cs_fc_jr)),console.debug("Parse json status check done"),"Received Processed"==_.cs_fc_sc?function(o,t,n,r){var s=V("mobileCaddy/connSessUtils"),a=V("mobileCaddy/logger"),i=V("mobileCaddy/smartStoreUtils");try{d(t.cs_fc_jr,function(e){o.connSessionRec.mobilecaddy1__Mobile_Process_Status__c="M2P SC - Status Check Processed",o.connSessionRec.SystemModstamp=(new Date).getTime(),o.connSessionRec.mobilecaddy1__Status__c="Closed",o.connSessionRec.Id=t.cs_sc_sf,i.queryMobileTable("Connection_Session__mc","Id",t.cs_fc_jr.cp).then(function(e){var n=e[0];return console.log("m2pCsObject",n),n.Id=t.cs_fc_jr.csId,n.SystemModstamp=(new Date).getTime(),n.mobilecaddy1__Mobile_Process_Status__c="M2P Records Processed",s.postProcessConnectionSession([o.connSessionRec,n])}).then(function(){n({status:y})}).catch(function(e){r(e)})},r)}catch(e){a.errorAndDispatch("processM2PUpdateResponse",e),r("processM2PUpdateResponse-error")}}(S,_,h,g):function(e,o,t){console.log("clearRTSRecs",e);var n=V("mobileCaddy/smartStoreUtils"),r=cordova.require("com.salesforce.plugin.smartstore");n.queryMobileTable("recsToSync","Current_Connection_Session",e,function(e){if(0!==e.length){for(var n=0;n<e.length;n++)e[n].Current_Connection_Session=null,"InsertUpdate"==e[n].CRUD_Operation?e[n].CRUD_Operation="Insert":"UpdateUpdate"==e[n].CRUD_Operation&&(e[n].CRUD_Operation="Update");r.upsertSoupEntries("recsToSync",e,o,t)}else o()},t)}(a,function(){i.queryMobileTable("Connection_Session__mc","mobilecaddy1__MC_Proxy_ID__c",a,function(n){if(0<n.length){var o=n[0];"Received Not Processed"==_.cs_fc_sc?(u=o,l=S,d=_,f=h,p=g,m=V("mobileCaddy/connSessUtils"),u.mobilecaddy1__Mobile_Process_Status__c="M2P UP Failed - RTS Cleared",u.mobilecaddy1__Session_Type__c="Sync Update",u.mobilecaddy1__Status__c="Closed",u.SystemModstamp=(new Date).getTime(),u.Id=d.cs_fc_sf,m.postProcessConnectionSession(u).then(function(){l.connSessionRec.mobilecaddy1__Mobile_Process_Status__c="M2P SC - Status Check Processed",l.connSessionRec.SystemModstamp=(new Date).getTime(),l.connSessionRec.mobilecaddy1__Status__c="Closed",l.connSessionRec.Id=d.cs_sc_sf,m.postProcessConnectionSession(l.connSessionRec,function(){f({status:y})},p)}).catch(function(e){p(e)})):(t=o,r=S,s=_,a=h,i=g,c=V("mobileCaddy/connSessUtils"),V("mobileCaddy/smartStoreUtils").deleteRecordsFromSoup([t],"Connection_Session__mc",function(n){r.connSessionRec.mobilecaddy1__Mobile_Process_Status__c="M2P SC - Status Check Processed",r.connSessionRec.SystemModstamp=(new Date).getTime(),r.connSessionRec.mobilecaddy1__Status__c="Closed",r.connSessionRec.Id=s.cs_sc_sf,r.connSessionRec.mobilecaddy1__Session_Type__c="Status Check",c.postProcessConnectionSession(r.connSessionRec).then(function(){a({status:y})}).catch(function(){i(e)})},i))}else h({status:y});var t,r,s,a,i,c,u,l,d,f,p,m},g)},g)):(c.error("csStatusCheck",o.message),h({status:l}))},t=S.connSessJson,r=localStorage.getItem("lastErrorLog");r&&(localStorage.removeItem("lastErrorLog"),(t=JSON.parse(t)).lastErrorLog=r,t=JSON.stringify(t)),!0===USE_FORCETK?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pCSStatusCheck001",contentType:"application/json",data:{audId:s,syncRefreshDataVersion:u,statusCheckCSProxyId:a,connSessJson:t,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN}},function(e,n){console.info("response -> "+JSON.stringify(e)),void 0===n&&((n={}).status="200"),o(e,n)},function(e){c.error("err -> "+JSON.stringify(e)),g(e)}):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".m2pCSStatusCheck",s,u,a,t,o,{buffer:!1,escape:!1,timeout:3e4})}).catch(function(e){g(e)}):r.cleanConnectionSessionHeartBeat(n,S,function(e){h({status:y,mc_add_status:e.mc_add_status})},g)},g)}).catch(function(e){g(e)})}catch(e){c.errorAndDispatch(e)}}function d(f,e,p,m){m||(m=p,p=e,e="{}");var S=V("mobileCaddy/smartStoreUtils"),h=(cordova.require("com.salesforce.plugin.smartstore"),V("mobileCaddy/logger")),g=V("mobileCaddy/vsnUtils"),y=1;console.debug("processM2PUpdateResponse",f,e);var a,i,c,u,b=f.mt,C=void 0!==f.is?f.is:[],n=void 0!==f.id?f.id:[],R=void 0!==f.us?f.us:[],T=void 0!==f.ifmf?f.ifmf:[],v=void 0!==f.ufmf?f.ufmf:[],E=[],I=[],N=[],D=[],P=[],O=[],U=[],w=[],M=[],A=[],L=[];if(C=C.concat(n),void 0===f.if)A=[];else if(void 0===f.if.if)A=f.if;else{y=2;var o=f.if.if.map(function(e){return{pd:e,fbe:void 0!==f.ifbe?f.ifbe:"K"}}),t=f.if.ifv.map(function(e){return{pd:e,fbe:void 0!==f.ifvbe?f.ifvbe:"K"}}),r=f.if.icv.map(function(e){return{pd:e,fbe:void 0!==f.icvbe?f.icvbe:"K"}});A=o.concat(t.concat(r))}(a=e,i=C,c=A,u=T,new Promise(function(e,n){var o=V("mobileCaddy/smartStoreUtils");a=JSON.parse(a);var t=c.concat(u),r=c;if(a.records&&a.records.length>i.length+t.length){var s=[];o.getProxyFieldName(a.MobileTable).then(function(o){a.records.forEach(function(e){if("I"==e.RecordCRUD){var n=e.fields.find(function(e){return e.name==o}).value;_.findWhere(i,{pd:n})||_.findWhere(t,{pd:n})||s.push({pd:n,fbe:"K"})}}),0<s.length&&(r=c.concat(s)),e(r)})}else e(r)})).then(function(e){if(A=e,void 0===f.uf)L=[];else if(void 0===f.uf.uf)L=f.uf;else{y=2;var n=f.uf.uf.map(function(e){return{Id:e,fbe:void 0!==f.ufbe?f.ufbe:"K"}}),o=f.uf.usv.map(function(e){return{Id:e,fbe:void 0!==f.usvbe?f.usvbe:"K"}}),t=f.uf.sdf.map(function(e){return{Id:e,fbe:void 0!==f.sdfbe?f.sdfbe:"K"}}),r=f.uf.hdf.map(function(e){return{Id:e,fbe:void 0!==f.hdfbe?f.hdfbe:"K"}}),s=f.uf.ufv.map(function(e){return{Id:e,fbe:void 0!==f.ufvbe?f.ufvbe:"K"}}),a=f.uf.ucv.map(function(e){return{Id:e,fbe:void 0!==f.ucvbe?f.ucvbe:"K"}});L=n.concat(o.concat(t.concat(r.concat(s.concat(a)))))}return k("SnapShot_"+b)}).then(function(e){return M=e,k(b)}).then(function(d){console.debug("priRecords -> "+JSON.stringify(d)),S.queryMobileTable("recsToSync","Mobile_Table_Name",b,function(e){for(var n in e)if(console.debug("recsToSyncRec[i] = "+JSON.stringify(e[n])),e[n].Current_Connection_Session==f.cp){var o=!1,t={},r={};switch(e[n].CRUD_Operation){case"Insert":case"InsertUpdate":for(var s in C)if(e[n].Id==C[s].pd){if(C[s].crud=e[n].CRUD_Operation,r=F(C[s],d),"Insert"==e[n].CRUD_Operation){switch(f.stbe){case"D":U.push(r),w.push(C[s]);break;default:if("U"==C[s].pc){if(r.Id=C[s].Id,void 0!==C[s].an&&(void 0!==C[s].nf?r[C[s].nf]=C[s].an:r.Name=C[s].an),void 0!==C[s].lu)for(var a in C[s].lu)C[s].lu.hasOwnProperty(a)&&console.debug("prop",a,C[s].lu[a]),r[a]=C[s].lu[a];D.push(r),O.push(r)}}I.push(e[n]._soupEntryId)}else{if(r.Id=C[s].Id,void 0!==C[s].an&&(void 0!==C[s].nf?r[C[s].nf]=C[s].an:r.Name=C[s].an),void 0!==C[s].lu)for(var i in C[s].lu)C[s].lu.hasOwnProperty(i)&&console.debug("iUProp",i,C[s].lu[i]),r[i]=C[s].lu[i];D.push(r);var c=F(C[s],M);c.Id=C[s].Id,O.push(c),(t=e[n]).Current_Connection_Session=null,t.CRUD_Operation="Update",t.Id=C[s].Id,E.push(t)}o=!0;break}if(!o)for(s in A)if(console.info("failure",e[n].Id,A[s].pd),e[n].Id==A[s].pd){if(A[s].crud=e[n].CRUD_Operation,"Insert"==e[n].CRUD_Operation)switch("K",1==y?x(0,A[s].fl,f):A[s].fbe){case"K":(t=e[n]).Current_Connection_Session=null,E.push(t);break;case"R":break;default:r=F(A[s],d),U.push(r),I.push(e[n]._soupEntryId),w.push(A[s])}else"InsertUpdate"==e[n].CRUD_Operation&&((t=e[n]).Current_Connection_Session=null,t.CRUD_Operation="Insert",E.push(t));o=!0;break}if(!o)for(s in T)if(e[n].Id==T[s].pd){if(T[s].crud=e[n].CRUD_Operation,"Insert"==e[n].CRUD_Operation)switch(T[s].fbe){case"K":(t=e[n]).Current_Connection_Session=null,E.push(t);break;case"R":break;default:r=F(T[s],d),U.push(r),I.push(e[n]._soupEntryId),w.push(T[s])}else"InsertUpdate"==e[n].CRUD_Operation&&((t=e[n]).Current_Connection_Session=null,t.CRUD_Operation="Insert",E.push(t));o=!0;break}break;case"Update":case"UpdateUpdate":for(s in R)if(e[n].Id==R[s].Id){if(R[s].crud=e[n].CRUD_Operation,"Update"==e[n].CRUD_Operation){switch(r=F(R[s],d),f.stbe){case"D":U.push(r),w.push(R[s]);break;default:if("M"==R[s].pc&&(r.SystemModstamp=new Date(R[s].sm)),void 0!==R[s].lu)for(var u in console.debug("lu",R[s].lu),R[s].lu)R[s].lu.hasOwnProperty(u)&&(r[u]=R[s].lu[u]);N.push(r),P.push(r)}I.push(e[n]._soupEntryId)}else"UpdateUpdate"==e[n].CRUD_Operation&&((t=e[n]).Current_Connection_Session=null,t.CRUD_Operation="Update",E.push(t));o=!0;break}if(!o)for(s in L)if(e[n].Id==L[s].Id){if("Update"==e[n].CRUD_Operation)switch("K",1==y?x(1,L[s].fl,f):L[s].fbe){case"K":(t=e[n]).Current_Connection_Session=null,E.push(t);break;case"R":break;default:r=F(L[s],d),U.push(r),I.push(e[n]._soupEntryId),w.push(L[s])}else"UpdateUpdate"==e[n].CRUD_Operation&&((t=e[n]).Current_Connection_Session=null,t.CRUD_Operation="Update",E.push(t));o=!0;break}if(!o)for(s in v)if(e[n].Id==v[s].pd){if(v[s].crud=e[n].CRUD_Operation,"Update"==e[n].CRUD_Operation)switch(v[s].fbe){case"K":(t=e[n]).Current_Connection_Session=null,E.push(t);break;case"R":break;default:r=F(v[s],d),U.push(r),I.push(e[n]._soupEntryId),w.push(v[s])}else"UpdateUpdate"==e[n].CRUD_Operation&&((t=e[n]).Current_Connection_Session=null,t.CRUD_Operation="Update",E.push(t));o=!0;break}}}var l;console.info("priToInsertRecs",D),console.info("rtsToUpdateRecs",E),S.getProxyFieldName(b).then(function(e){return l=e,J(b,"Id",N)}).then(function(e){return console.debug("m2pRespUpRecs ("+b+") res -> "+JSON.stringify(e)),J(b,l,D)}).then(function(e){return console.debug("m2pRespUpRecs"+b+") (PROXY KEY) res -> "+JSON.stringify(e)),J("SnapShot_"+b,"Id",P)}).then(function(e){return console.debug("m2pRespUpRecs"+b+") (PROXY KEY) res -> "+JSON.stringify(e)),J("SnapShot_"+b,l,O)}).then(function(e){return console.debug("m2pRespUpRecs (SnapShot_"+b+") res -> "+JSON.stringify(e)),j(b,U)}).then(function(e){return console.debug("m2pRespDelRecs res -> "+JSON.stringify(e)),j("SnapShot_"+b,w)}).then(function(e){return console.debug("m2pRespDelRecs (SnapShot_' + mobileTable + ') res -> "+JSON.stringify(e)),t=E,r=cordova.require("com.salesforce.plugin.smartstore"),console.debug("m2pRespUpRTSRecs recsToUp -> "+JSON.stringify(t)),new Promise(function(n,o){0<t.length?r.upsertSoupEntries("recsToSync",t,function(e){n(e)},function(e){o(e)}):n("OK")});var t,r}).then(function(e){return console.debug("m2pRespUpRTSRecs res -> "+JSON.stringify(e)),t=I,r=cordova.require("com.salesforce.plugin.smartstore"),console.debug("m2pRespDelRTSRecs recsToDel -> "+JSON.stringify(t)),new Promise(function(n,o){0<t.length?r.removeFromSoup("recsToSync",t,function(e){n(e)},function(e){o(e)}):n("OK")});var t,r}).then(function(e){return console.debug("m2pRespDelRTSRecs res -> "+JSON.stringify(e)),g.checkForMigrateToInfo(f)}).then(function(){var e={status:0};e.csId=f.csId,p(e)}).catch(function(e){h.errorAndDispatch("m2pResp error for "+b,e),m(e)})},m)}).catch(function(e){h.errorAndDispatch("Err reading table",b),m(e)})}function F(e,n){var o={};return"Insert"==e.crud||"InsertUpdate"==e.crud?o.Id=e.pd:o.Id=e.Id,_.findWhere(n,o)}function x(e,n,o){switch(e){case 0:switch(n){case"DF":return o.ifbe;case"CV":return o.icvbe;case"FV":return o.ifvbe}break;case 1:switch(n){case"DF":return o.ufbe;case"SV":return o.usvbe;case"CV":return o.ucvbe;case"FV":return o.ufvbe;case"SD":return o.sdfbe;case"HD":return o.hdfbe}}}function k(e){var t=V("mobileCaddy/smartStoreUtils");return new Promise(function(n,o){t.querySoupRecords(e,function(e){n(e)},function(e){o(e)})})}function J(e,t,r){var s=cordova.require("com.salesforce.plugin.smartstore");return console.debug("m2pRespUpRecs ("+e+") updateRecs -> "+JSON.stringify(r)),new Promise(function(n,o){0<r.length?s.upsertSoupEntriesWithExternalId(e,r,t,function(e){n(e)},function(e){o(e)}):n("OK")})}function j(e,t){console.debug("m2pRespDelRecs ("+e+") recsToDel -> "+JSON.stringify(t));var r=V("mobileCaddy/smartStoreUtils"),s=V("mobileCaddy/logger");return new Promise(function(n,o){0<t.length?-1==e.indexOf("SnapShot")?r.deleteRecordsFromSoup(t,e,function(e){n(e)},function(e){o(e)}):(console.debug("Deleting from SnapShot ",e),recsToDel2=t.filter(function(e){return null!=e}),r.deleteRecordsForExternalId(e,recsToDel2,"Id",function(e){n(e)},function(e){s.errorAndDispatch(e),o(e)})):n("OK")})}var u=100600;function f(e,n,o,t){console.log("in clean connection session heart beat");V("mobileCaddy/smartStoreUtils");var r=V("mobileCaddy/syncRefresh"),s=cordova.require("com.salesforce.plugin.smartstore"),a=V("mobileCaddy/logger"),i={},c=null;e.status==r.HEARTBEAT_NO_CONNECTION?"Sync - Refresh"==n.connSessionRec.mobilecaddy1__Session_Type__c?c="P2M RE Heartbeat No Connection":"Status Check"==n.connSessionRec.mobilecaddy1__Session_Type__c&&(c="M2P SC Heartbeat No Connection"):e.status==r.HEARTBEAT_EXCEPTION?"Sync - Refresh"==n.connSessionRec.mobilecaddy1__Session_Type__c?c=e.bogus?"P2M RE Exception/Timeout":"P2M RE Heartbeat Exception/Timeout":"Status Check"==n.connSessionRec.mobilecaddy1__Session_Type__c&&(c=e.bogus?"M2P SC Exception/Timeout":"M2P SC Heartbeat Exception/Timeout"):e.status==r.HEARTBEAT_FAILURE&&("Sync - Refresh"==n.connSessionRec.mobilecaddy1__Session_Type__c?c=e.bogus?"P2M RE Failure":"P2M RE Hearbeat Failure":"Status Check"==n.connSessionRec.mobilecaddy1__Session_Type__c&&(c=e.bogus?"M2P SC Failure":"M2P SC Heartbeat Failure")),null!==c?(n.connSessionRec.mobilecaddy1__Mobile_Process_Status__c=c,n.connSessionRec.SystemModstamp=(new Date).getTime(),n.connSessionRec.mobilecaddy1__Status__c="Closed",console.log("Upserting connection session"),s.upsertSoupEntries("Connection_Session__mc",[n.connSessionRec],function(){i.status=u,i.mc_add_status=e.status,o(i)},t)):(a.error("Unknown heartBeatObject.status. ",e.status),t())}o.exports={getRTSPendingconnSess:function(e,n){var i,c;i=e,c=n,V("mobileCaddy/smartStoreUtils").querySoupRecords("recsToSync",function(e){console.debug("recsToSync -> "+JSON.stringify(e));for(var n=null,o=null,t=0;t<e.length;t++)if(console.debug("recsToSync["+t+"] -> "+JSON.stringify(e[t])),null!==e[t].Current_Connection_Session&&void 0!==e[t].Current_Connection_Session){n=e[t].Current_Connection_Session,o=e[t];break}if(null!=n){var r=(new Date).getTime(),s=o._soupLastModifiedDate+3e4;if(s<r)console.debug("timeNow > timeoutTs",r,s),console.debug("We have a timedout Conn_Sess",n),i(n);else{console.debug("We have a SYNC_ALREADY_IN_PROGRESS",n);var a={status:100498};c(a)}}else console.debug("getRTSPendingconnSess - All clear"),i(n)},c)},CLEAN_CS_OK:u,cleanConnectionSessionHeartBeat:function(e,n,o,t){f(e,n,o,t)},cleanConnectionSessionVFEvent:function(e,n,o,t){var r,s,a,i,c,u;r=e,s=n,a=o,i=t,c=V("mobileCaddy/syncRefresh"),u={bogus:!0},"exception"===r.type?u.status=c.HEARTBEAT_EXCEPTION:u.status=c.HEARTBEAT_FAILURE,f(u,s,a,i)},CONN_SESS_OK:y,csStatusCheck:function(e,n,o){t(e,n,o)},maybeSyncConnSess:function(e,n,o){var t,r,s,a,i,c,u;t=e,r=n,s=o,a=mobileCaddy.require("mobileCaddy/devUtils"),i=V("mobileCaddy/smartStoreUtils"),c=V("mobileCaddy/logger"),u={},console.debug("maybeSyncConnSess"),i.querySoupRecsPromise("recsToSync").then(function(e){console.debug("Success from readRecords recsToSync -> "+JSON.stringify(e));var n=_.filter(e,function(e){return void 0!==e.currentConnectionSession});console.debug("connSessRTS -> "+JSON.stringify(n)),1<n.length||"M2P Conn_Sess Records Processed"!=t.mobilecaddy1__Mobile_Process_Status__c?a.syncMobileTable("Connection_Session__mc").then(function(e){console.debug("syncMobileTable -> ",JSON.stringify(e)),u.status=0,r(u)}).catch(function(e){c.warn("syncMobileTable ERROR -> ",e),s(e)}):(console.debug("maybeSyncConnSess - not syncing"),u.status=0,r(u))}).catch(function(e){c.error("querySoupRecsPromise ERROR -> ",e),s(e)})},processM2PUpdateResponse:function(e,n,o,t){d(e,n,o,t)},postProcessConnectionSession:function(e){return c=e,new Promise(function(o,n){var t=cordova.require("com.salesforce.plugin.smartstore"),r=V("mobileCaddy/logger"),s=function(e){r.error("postProcessConnectionSession error",e),n(e)},a=Array.isArray(c)?c:[c],i={};t.upsertSoupEntries("Connection_Session__mc",a,function(e){var n=Array.isArray(c);n=a.map(function(e){return{Id:e.Id,SystemModstamp:e.SystemModstamp-1,mobilecaddy1__Session_Type__c:null,mobilecaddy1__Mobile_Process_Status__c:null,mobilecaddy1__Session_Created_Location_Error__c:null,mobilecaddy1__MC_Proxy_ID__c:null}}),t.upsertSoupEntries("SnapShot_Connection_Session__mc",n,function(e){var n=e.map(function(e){return{Mobile_Table_Name:"Connection_Session__mc",CRUD_Operation:"Update",SOUP_Record_Id:e._soupEntryId,Id:e.Id,LastModifiedDateTime:e.SystemModstamp}});t.upsertSoupEntries("recsToSync",n,function(){console.log("success from upsert of recs to sync"),i.status=0,o(i)},s)},s)},s)});var c},handleUpdatedCS:function(e){return r=e,new Promise(function(n,e){var o=mobileCaddy.require("mobileCaddy/smartStoreUtils"),t=V("mobileCaddy/logger");console.log("handleUpdatedCS",r),r&&r.us&&0!==r.us.length?o.deleteRecordsForExternalId("Connection_Session__mc",r.us,"Id").then(function(e){return o.deleteRecordsForExternalId("SnapShot_Connection_Session__mc",r.us,"Id")}).then(function(e){return o.deleteRecordsForExternalId("recsToSync",r.us,"Id")}).then(function(e){console.log("handleUpdatedCS -> deleted from CS and RTS OK"),n()}).catch(function(e){t.error("handleUpdatedCS",e),n()}):n(),r&&r.uf&&0!==r.uf.length&&t.error("handleUpdatedCS -> we have uf",r.uf)});var r}}}),s("mobileCaddy/vsnUtils",function(r,e,n){var o=mobileCaddy.require("mobileCaddy/devUtils"),f=(cordova.require("com.salesforce.plugin.smartstore"),mobileCaddy.require("mobileCaddy/smartStoreUtils")),t=r("mobileCaddy/connSessUtils"),p=r("mobileCaddy/appDataUtils"),m=r("mobileCaddy/logger"),s=["recsToSync"];function a(e,n){return new Promise(function(o,n){null===e?f.listMobileTables(f.ALPHA,function(e){var n=s;_.each(e,function(e){n.push(e),n.push("SnapShot_"+e),localStorage.removeItem("meta-tableDEF-"+e),localStorage.removeItem("meta-tableCRUD-"+e)}),console.debug("allTables",n),o(n)},function(e){n(e)}):o([])})}function S(o,e){return new Promise(function(e,n){a(o).then(function(e){return Promise.all(e.map(f.deleteSoup))}).then(function(){e()}).catch(function(e){m.error(e),n(e)})})}function i(e){return new Promise(function(i,c){var u={},l=e?"Version Upgrade":"HardReset",d="";r("mobileCaddy/syncRefresh");new Promise(function(n,o){var e=r("mobileCaddy/syncRefresh");e.refreshToken(function(e){console.debug("Successfully refreshed access token. Continue reset."),n("ok")},function(e){console.error("Unable to refresh access token. Abort reset: "+JSON.stringify(e)),o(e)})}).then(function(){o.readRecords("appSoup").then(function(e){return e.records.forEach(function(e){u[e.Name]=e.CurrentValue}),console.info("appSoupRecs",JSON.stringify(u)),S(null)}).then(function(){d=h(u),console.log("resetURL",d);var n="";console.debug("deletedSoups OK");var e,o,t="localhost:3030"==window.location.host?"codeflow":"undefined"!=typeof mockStore?navigator.appVersion.includes("Electron")?"desktop":"platform":"device";if("codeflow"==t&&(e=localStorage.getItem("forceOAuth"),o=localStorage.getItem("appSoup")),localStorage.clear(),"codeflow"==t)localStorage.setItem("forceOAuth",e),localStorage.setItem("appSoup",o),n=window.location.protocol+"//"+window.location.host+"/www",i("ok");else if("platform"==t)n=window.location.href.substr(0,window.location.href.indexOf("#"));else{var r,s="";if(navigator&&navigator.connection&&(s=navigator.connection.type),window.device&&(r=window.device),navigator.appVersion.includes("Electron")){r=ipcRenderer.sendSync("request-device-info",""),s="wifi";var a="landscape"}n=d+"?deviceUuid="+r.uuid+"&deviceName="+r.name+"&deviceCordova="+r.cordova+"&deviceVersion="+r.version+"&deviceModel="+r.model+"&buildName="+u.buildName+"&buildVersion="+u.buildVersion+"&buildOS="+u.buildOS+"&knownAud="+u.audId+"&currentDv="+u.dynVersionNumber+"&orientation="+a+"&viewportWidth="+$j(window).width()+"&viewportHeight="+$j(window).height()+"&sessionType="+l+"&connType="+s+"&loginUrl="+u.loginUrl+"&millsFromEpoch="+(new Date).getTime()}p.updateNewValueInAppSoup("buildStatus","Resetting").then(function(){console.info("AppSoup Updated for reset"),f.deleteSoup("syncLib_system_data").then(function(e){console.log("Redirecting to: "+n);try{window.location.href=n}catch(e){m.errorAndDispatch("error on redirect",e),c(e)}i()}).catch(function(e){m.errorAndDispatch(e)}),i()}).catch(function(e){m.errorAndDispatch(e),c(e)})}).catch(function(e){m.errorAndDispatch(e),c(e)})}).catch(function(e){m.error("Tokens are bad, testRefreshAccessToken rejected with: "+JSON.stringify(e)),window.history.go(-(history.length-1)),navigator.appVersion.includes("Electron")||cordova.require("com.salesforce.plugin.sfaccountmanager").logout(),c(e)})})}function h(e){var n="/apex/mobilecaddy1__MobileCaddyBootstrap001_mc";switch(e.platAuthUrl){case"i":case"I":resetURL=e.instanceUrl+n;break;case"l":case"L":resetURL=e.loginUrl+n;break;case"":resetURL=void 0;break;default:resetURL=e.platAuthUrl}return resetURL||(e.authURLType||(e.authURLType="login"),resetURL="login"==e.authURLType?e.loginUrl+n:e.instanceUrl+n),resetURL}function c(){return new Promise(function(n,o){mobileCaddy.require("mobileCaddy/smartStoreUtils").queryMobileTable("appSoup","Name","dynVersionNumber").then(function(e){void 0!==e[0].NewValue&&e[0].NewValue!=e[0].CurrentValue?n(!0):n(!1)}).catch(function(e){m.error(e),o(e)})})}n.exports={checkForMigrateToInfo:function(e){return o=e,t=r("mobileCaddy/appDataUtils"),new Promise(function(e,n){null!==o.migrateTo&&void 0!==o.migrateTo?t.updateNewValueInAppSoup("dynVersionNumber",o.migrateTo).then(function(){e()}).catch(function(e){m.error(e),n(e)}):e()});var o,t},clearSoups:function(e,n){return S(e)},getSoupsToClear:function(e,n){return a(e)},hardReset:function(){return i()},upgradeAvailable:function(){return c()},upgradeIfAvailable:function(){return new Promise(function(n,o){c().then(function(e){e?t.getRTSPendingconnSess(function(e){if(null==e)return i(!0);n(!1)},function(e){n(!1)}):n(!1)}).catch(function(e){m.error(e),o(e)})})},_getBootstrapUrl:function(e){return h(e)}}}),s("mobileCaddy/logger",function(e,n,o){cordova.require("com.salesforce.plugin.smartstore");var s=e("mobileCaddy/smartStoreUtils"),a=e("mobileCaddy/appDataUtils"),u=0,l=1,d=2;function i(){return new Promise(function(n,o){localStorage.hasLogType?n(localStorage.hasLogType):s.listMobileTableColumns("Mobile_Log__mc",s.FULL,function(e){void 0===_.find(e,{path:"mobilecaddy1__Log_Type__c"})?(localStorage.setItem("hasLogType","false"),n("false")):(localStorage.setItem("hasLogType","true"),n("true"))},function(e){o(e)})})}function f(r,e){return new Promise(function(n,o){if(1==e.length&&(e=e[0]),"object"==typeof e&&(e=JSON.stringify(e)),"number"!=typeof e&&"boolean"!=typeof e||(e=e.toString()),"string"==typeof e){r==u&&localStorage.setItem("lastErrorLog",e.substring(0,1024));var t={mobilecaddy1__Error_Text__c:e.substring(0,1024),SystemModstamp:(new Date).getTime()};a.getCachedCurrentValueFromAppSoup("audId").then(function(e){return t.mobilecaddy1__Application_User_Device__c=e,i()}).then(function(e){"true"==e&&(t.mobilecaddy1__Log_Type__c="D"+r.toString()),s.insertRecords("Mobile_Log__mc",[t],function(e){n()},function(e){o(e)})}).catch(function(e){console.error(e),o(e)})}else logger.error("Trying to log unsupported type",typeof e),o("Trying to log unsupported type"+typeof e)})}function t(e,n,o,t){var r=localStorage.getItem("logLevel");if(n<=(r=void 0===r?0:r)){var s="";if(0<n){var a=t.stack.split("\n")[4];if(void 0!==a){var i=a.indexOf("at ");s=a.slice(i+2,a.length)}}var c=o[0];switch(n){case u:o[0]&&o[0].stack?c=o[0].message+", STACK:"+o[0].stack:o[1]&&o[1].stack?c+="\n"+o[1].message+", STACK:"+o[1].stack:c=o,f(n,c),console.error.apply(console,o);break;case l:l<=r&&(f(n,o),console.log.apply(console,o),console.log(s));break;default:d<=r&&(f(n,o),console.log.apply(console,o),console.log(s))}e&&(console.info("Dispatching error"),"undefined"!=typeof LOCAL_DEV&&LOCAL_DEV&&alert(c+"\n\nSee dev console for more information"))}}function r(){try{throw Error("")}catch(e){return e}}o.exports={debug:function(e){return t(!1,4,arguments,r())},error:function(e){return t(!1,u,arguments)},errorAndDispatch:function(e){return t(!0,u,arguments)},info:function(e){return t(!1,3,arguments,r())},log:function(e){return t(!1,d,arguments,r())},warn:function(e){return t(!1,l,arguments,r())},hasLogType:function(){return i()}}}),s("mobileCaddy/devUtils",function(S,e,n){var l=S("mobileCaddy/smartStoreUtils"),h=(S("mobileCaddy/mobileLogger"),S("mobileCaddy/logger")),c=cordova.require("com.salesforce.plugin.smartstore"),a=1,d=2,f=3,p=4,g=5,y=6,b=8,i=99,C=100400,R=C,T=100402,v=100700,E=101e3,u=101100,I=101200,r=101300,N=["syncLib_system_data","appSoup","cacheSoup","recsToSync","SnapShot_Connection_Session__mc"],D=["autonumber","CreatedById","CreatedDate","IsDeleted","IsClosed","IsWon","LastModifiedById","LastModifiedDate","LastReferencedDate","mobilecaddy1__MC_Proxy_ID","MC_Proxy_ID","OwnerId","SystemModstamp","Id","dirtyFlag"];function o(a){var i="Analytics";return new Promise(function(r,n){var e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0).valueOf();new Promise(function(n,o){c.soupExists("Analytics",function(e){e?n():c.registerSoup("Analytics",[{path:"Name",type:"integer"},{path:"Data",type:"string"}],function(e){n()},function(e){o(e)})},function(e){h.error(e),o(e)})}).then(function(){return i=s,new Promise(function(n,s){var e=S("mobileCaddy/appDataUtils"),a="";e.getCurrentValueFromAppSoup("audId").then(function(e){return a=e,l.querySoupRecsPromise("Analytics")}).then(function(e){var o=[],t=[],r=[];e.forEach(function(e){if(e.Name==i)o.push(e);else{var n={Name:e.Name.toString(),SystemModstamp:e.Name,mobilecaddy1__Error_Text__c:JSON.parse(e.Data),mobilecaddy1__Application_User_Device__c:a};h.hasLogType()&&(n.mobilecaddy1__Log_Type__c="analytic"),t.push(n),r.push(e._soupEntryId)}}),0!==t.length&&l.insertRecords("Mobile_Log__mc",t,function(e){c.removeFromSoup("Analytics",r,function(e){n(o)},function(e){h.error("Unable to insert analytic recs",e),s(e)})},function(e){h.error("Unable to insert analytic recs",e),s(e)}),n(o)}).catch(function(e){h.error("Error housekeeping Analytics",e),s(e)})});var i}).then(function(e){var n={};if(0===e.length){n[a]=1;var o={Name:s,Data:JSON.stringify(n)};r(n[a]),c.upsertSoupEntries(i,[o],function(e){},function(e){h.error("Unable to insert analytic recs",e)})}else{var t=e[0];(n=JSON.parse(t.Data))[a]=void 0===n[a]?1:n[a]+1,r(n[a]),t.Data=JSON.stringify(n),c.upsertSoupEntriesWithExternalId(i,[t],"Name",function(e){},function(e){h.error(e)})}}).catch(function(e){h.error("Error in analInc",e),n(e)})})}function P(a,o,i){return console.time("MC-TIMING checkTableAccess "+a),new Promise(function(r,s){var n=function(e,n){var o=0;switch(e){case v:o=1;break;case E:o=4;break;case u:o=7;break;case I:o=10;break;default:o=0}if("Y"==n.charAt(o))console.timeEnd("MC-TIMING checkTableAccess "+a),r(i);else{var t={};t.status=e+f,t.mc_add_status=a,console.timeEnd("MC-TIMING checkTableAccess "+a),s(t)}};-1==N.indexOf(a)?localStorage["meta-tableCRUD-"+a]?n(o,localStorage["meta-tableCRUD-"+a]):l.getTableDefnColumnValue(a,"Application Record CRUD").then(function(e){localStorage["meta-tableCRUD-"+a]=e,n(o,e)}).catch(function(e){console.timeEnd("MC-TIMING checkTableAccess "+a),console.info("Opps -> "+a),s(e)}):(console.timeEnd("MC-TIMING checkTableAccess "+a),r(i))})}function t(){return new Promise(function(n,o){if(!0===USE_FORCETK){var e=force.getUserId();n(e)}else s("userId").then(function(e){n(e)}).catch(function(e){h.error("getCurrentUserId",e),o(e)})})}function s(e){return new Promise(function(n,o){S("mobileCaddy/appDataUtils").getCachedCurrentValueFromAppSoup(e).then(function(e){n(e)}).catch(function(e){h.error("getCachedAppSoupValue",e),o(e)})})}function O(n,o,e,t){if("_soupLastModifiedDate"==n)return t;var r=_.findWhere(e,{path:n}),s={};if(void 0===r)return s.status=o+d,s.mc_add_status=n,s;var a=0;switch(o){case v:a=1;break;case E:a=4;break;case u:a=7;break;default:a=0}if("Y"!=r.crud.charAt(a))return s.status=o+f,s;try{return s.value=M(t,r.appColType,r.platColType),s}catch(e){return s.status=o+g,s.mc_add_status=e+"->"+n,s}}function U(t){return console.time("MC-TIMING listMobileTableColumns "+t),new Promise(function(n,o){localStorage["meta-tableDEF-"+t]?(console.timeEnd("MC-TIMING listMobileTableColumns "+t),n(JSON.parse(localStorage["meta-tableDEF-"+t]))):l.listMobileTableColumns(t,l.FULL,function(e){localStorage["meta-tableDEF-"+t]=JSON.stringify(e),console.timeEnd("MC-TIMING listMobileTableColumns "+t),n(e)},function(e){console.timeEnd("MC-TIMING listMobileTableColumns "+t),o(e)})})}function w(e,n,o){switch(o){case"checkbox":case"Deleted":return"true"===String(e);case"CreatedDate":case"date":case"datetime":case"LastActivtyDate":case"LastModifiedDate":case"LastReferencedDate":case"LastViewedDate":case"SystemModstamp":return null!==e?new Date(e):e;default:return e}}function M(e,n,o){switch(o){case"autonumber":throw"invalid_autonumber";case"checkbox":case"Deleted":if("boolean"==typeof e||"true"===e||"false"===e)return String(e);throw"invalid_boolean";case"date":if(e instanceof Date)return e.setUTCHours(0),e.setUTCMinutes(0),e.setUTCSeconds(0),e.setUTCMilliseconds(0),e.valueOf();if(null===e)return null;throw"invalid_date";case"datetime":if(e instanceof Date)return e.valueOf();throw"invalid_datetime";case"email":if(function(e){if(0===e.length)return!0;var n=e.indexOf("@"),o=e.lastIndexOf(".");return!(n<1||o<n+2||o+2>=e.length)}(e))return e;throw"invalid_email";default:switch(n){case"jsString":if("string"==typeof e)return e;if("number"==typeof e)return e.toString();throw"invalid_string";case"jsNumber":if("number"==typeof e||null===e)return e;throw"invalid_number";default:return e}}}function A(r,s){return console.time("MC-TIMING tableExists "+r),new Promise(function(n,o){var t={};localStorage["meta-tableCRUD-"+r]?(console.timeEnd("MC-TIMING tableExists "+r),n()):l.listMobileTables(l.ALPHA,function(e){0<=e.concat(N).indexOf(r)?(console.timeEnd("MC-TIMING tableExists "+r),n()):(t.status=s+a,t.mc_add_status=r,console.timeEnd("MC-TIMING tableExists "+r),o(t))},function(e){t.status=s+i,t.mc_add_status="Unkonwn error "+e,console.timeEnd("MC-TIMING tableExists "+r),o(t)})})}function L(n,c,u,o,l){return new Promise(function(s,e){var a={},i={};a.status=u,V().then(function(e){return e[n]&&(i=e[n]),t()}).then(function(r){$j.each(o,function(e,t){if(delete t._soupEntryId,delete t.$$HashKey,t.RecordTypeName){if(t.RecordTypeId=i[t.RecordTypeName],_.isEmpty(i))return a.status=u+d,a.mc_add_status=t.RecordTypeName,s(a);if(!t.RecordTypeId)return a.status=u+b,a.mc_add_status=t.RecordTypeName,s(a);delete t.RecordTypeName}for(var n in t)if(t.hasOwnProperty(n)&&n!=c){if(isValidFieldRes=O(n,u,l,t[n]),isValidFieldRes.status==u+d){a.status=isValidFieldRes.status,a.mc_add_status=n;break}if(isValidFieldRes.status==u+g){a.status=isValidFieldRes.status,a.mc_add_status=n;break}if(isValidFieldRes.status==u+f){a.status=isValidFieldRes.status,a.mc_add_status=n;break}if(u==v&&0<=D.indexOf(n)){a.status=u+y,a.mc_add_status=n;break}t[n]=isValidFieldRes.value}if(a.status!=u+d&&a.status!=u+g&&a.status!=u+y){var o=(new Date).getTime();u==v&&(t.CreatedById=r,t.CreatedDate=o),t.SystemModstamp=o,t.LastModifiedDate=o,t.LastModifiedById=r,t.IsDeleted="false",$j.each(l,function(e,n){if(u==v){var o=n.crud.charAt(1);D.indexOf(n.path)<0&&"false"==n.nillable&&"Y"==o?_.has(t,n.path)||(a.status=u+p,a.mc_add_status=n.path):("IsClosed"==n.path&&(t.IsClosed="false"),"IsWon"==n.path&&(t.IsWon="false"))}""!==n.proxyRefField&&void 0!==t[n.path]&&18<t[n.path].length&&(t[n.proxyRefField]=t[n.path])})}}),a.records=o,s(a)},function(e){h.error("validateRecords",e)})})}function V(){return new Promise(function(n,o){localStorage.getItem("lsDotsRecordTypes")?n(JSON.parse(localStorage.getItem("lsDotsRecordTypes"))):l.querySoupRecords("dotsRecordTypes",function(e){console.log("querySoupRecords dotsRecordTypes",e);var o={};e.forEach(function(e){var n={};JSON.parse(e.Data).forEach(function(e){e.recTypeDevName?(n[e.recTypeId]={recTypeName:e.recTypeName,recTypeDevName:e.recTypeDevName},n[e.recTypeName]=e.recTypeId,n[e.recTypeDevName]=e.recTypeId):(n[e.recTypeId]=e.recTypeName,n[e.recTypeName]=e.recTypeId)}),o[e.Table]=n}),localStorage.setItem("lsDotsRecordTypes",JSON.stringify(o)),n(o)},function(e){h.error("Error returned from upsert, message =  "+e),o(e)})})}function F(){return new Promise(function(t,n){J("recsToSync").then(function(e){var n=[],o=[];e.records.forEach(function(e){"Connection_Session__mc"!=e.Mobile_Table_Name&&void 0===n[e.Mobile_Table_Name]&&(n[e.Mobile_Table_Name]=!0,o.push(e.Mobile_Table_Name))}),t(o)}).catch(function(e){h.error(e),n(e)})})}function x(r,s){return new Promise(function(t,n){0<r.length&&-1==N.indexOf(s)?V().then(function(e){if(e[s]){var n=e[s],o=r.map(function(e){return"object"==typeof n[e.RecordTypeId]?(e.RecordTypeName=n[e.RecordTypeId].recTypeName,e.RecordTypeDevName=n[e.RecordTypeId].recTypeDevName):e.RecordTypeName=n[e.RecordTypeId],e.RecordTypeName||h.warn("enrichWithRecordTypeNames",e.RecordTypeId),e});t(o)}else t(r)}).catch(function(e){n(e)}):t(r)})}function k(t,r){var s={};return new Promise(function(n,o){A(t,v).then(function(){return U(t)}).then(function(e){return P(t,v,e)}).then(function(e){return new Promise(function(n,o){L(t,null,v,r,e).then(function(e){e.status==v?n(e.records):o(e)})})}).then(function(e){l.insertRecords(t,e,function(e){s.status=v,s.records=e,mobileCaddy.require("mobileCaddy/vsnUtils").upgradeAvailable().then(function(e){s.upgradeAvailable=e,n(s)}).catch(function(e){n(s),h.error(e)})},function(e){o(e),h.error(e)})}).catch(function(e){o(e),h.error(e)})})}function J(s,e){var a={},i="MC-TIMING readRecords "+s;return console.time(i),new Promise(function(t,r){A(s,E).then(function(){return P(s,E)}).then(function(){return U(s)}).then(function(o){l.querySoupRecords(s,function(n){(a.status=E,0<n.length)?-1==N.indexOf(s)?l.getTableDefnColumnValue(s,"Last Refresh Date/Time").then(function(e){return j(s,n,o,e,a)}).then(function(e){console.timeEnd(i),t(e)}).catch(function(e){r(e),h.error(e)}):j(s,n,o,null,a).then(function(e){console.timeEnd(i),t(e)}):(a.records=[],mobileCaddy.require("mobileCaddy/vsnUtils").upgradeAvailable().then(function(e){a.upgradeAvailable=e,console.timeEnd(i),t(a)}).catch(function(e){console.timeEnd(i),t(a),h.error(e)}))},function(e){console.timeEnd(i),r(e),h.error(e)})},function(e){console.timeEnd(i),r(e),h.error(e)})})}function j(o,t,r,s,a){return new Promise(function(n,e){$j.each(t,function(e,n){for(var o in n){var t=_.findWhere(r,{path:o});void 0!==t&&(n[o]=w(n[o],t.appColType,t.platColType),"LastModifiedDate"==o&&(n.dirtyFlag=K(n[o],s)))}}),a.records=t.filter(function(e){return"object"==typeof e}),x(a.records,o).then(function(e){return a.records=e,mobileCaddy.require("mobileCaddy/vsnUtils").upgradeAvailable()}).then(function(e){a.upgradeAvailable=e,n(a)}).catch(function(e){n(a),h.error(e)})})}function q(u){return new Promise(function(t,n){var r,s,a,i,o=cordova.require("com.salesforce.plugin.smartstore"),c={},e=/\{(\S*)\}/g.exec(u);tableName=e[1],(a=tableName,i=u,new Promise(function(n,e){if(m=i.match(/.* WHERE (.* = .*)/i),console.debug("m",m),null!==m&&null!==m[1]){var o=m[1].split("AND"),t={},r="";o.forEach(function(e){mWhere=e.match(/{(.*):(.*)} = (.*)/i),whereField=mWhere[2],r=mWhere[3].split("'")[1],t[whereField]=r}),void 0!==t.Id&&18<t.Id.length?l.getProxyFieldName(a).then(function(e){console.log("proxyFieldName",e),parsedSmartSql=i.replace("Id} =",e+"} ="),n(parsedSmartSql)}):n(i)}else n(i)})).then(function(e){return console.debug("smartSql2",e),r=o.buildSmartQuerySpec(e),console.debug("querySpec",r),s="MC-TIMING smartRead "+tableName,console.time(s),A(tableName,E)}).then(function(){return P(tableName,E)}).then(function(){return U(tableName)}).then(function(o){l.smartQuerySoupRecordsWithQuerySpec(r,function(n){(c.status=E,0<n.length)?-1==N.indexOf(tableName)?l.getTableDefnColumnValue(tableName,"Last Refresh Date/Time").then(function(e){return B(tableName,n,o,e,c)}).then(function(e){console.timeEnd(s),t(e)}):B(tableName,n,o,null,c).then(function(e){console.timeEnd(s),t(e)}):(c.records=[],mobileCaddy.require("mobileCaddy/vsnUtils").upgradeAvailable().then(function(e){c.upgradeAvailable=e,console.timeEnd(s),t(c)}).catch(function(e){console.timeEnd(s),t(c),h.error(e)}))},function(){n()})},function(e){console.timeEnd(s),n(e),h.error(e)})})}function B(o,t,a,i,r){return new Promise(function(n,e){var s=[];$j.each(t,function(e,n){var o=n[1];for(var t in o){var r=_.findWhere(a,{path:t});void 0!==r&&(o[t]=w(o[t],r.appColType,r.platColType),"LastModifiedDate"==t&&(n[1].dirtyFlag=K(n[1][t],i)))}s.push(o)}),r.records=s.filter(function(e){return"object"==typeof e}),x(r.records,o).then(function(e){return r.records=e,mobileCaddy.require("mobileCaddy/vsnUtils").upgradeAvailable()}).then(function(e){r.upgradeAvailable=e,n(r)}).catch(function(e){n(r),h.error(e)})})}function K(e,n){return n&&"null"!=n||(n=0),e.valueOf()>n}function H(a){return console.time("initialSync"),new Promise(function(t,r){if(0===a.length)t({status:C+p});else{var n={},s=S("mobileCaddy/syncRefresh");s.heartBeat(function(e){if(console.log("heartbeat call gave "+e.status),e.status==s.HEARTBEAT_OK||e.status==s.HEARTBEAT_NOT_DEVICE||e.status==s.HEARTBEAT_REFRESHED_OK){var o=[];console.debug("tableNames",JSON.stringify(a)),F().then(function(e){return console.debug("dirtyTableNames",e),e.forEach(function(e){dirtyIndex=a.indexOf(e),-1<dirtyIndex&&(o.push({table:e,status:T,mc_add_status:"Dirty records"}),a.splice(dirtyIndex,1))}),console.debug("tableNames",a),console.debug("resArr",o),function(e){Promise.resolve();var o=[];return e.reduce(function(e,n){return e.then(function(e){return a=n,new Promise(function(n,o){var t=S("mobileCaddy/syncRefresh"),r=function(e){console.debug("innerProcessRefreshTablePromise res",e),n(e)},s={table:a};t.p2mRefreshTable(a,0,!1,1,1,null,function(e){console.debug("refreshStatusObject",e),e.status==t.P2M_REFRESH_OK?s.status=R:(s.status=e.status,s.mc_add_status=e.mc_add_status),r(s)},function(e){h.error("innerProcessRefreshTablePromise error",e),o(e)})});var a}).then(function(e){return o.push(e),o}).catch(function(e){h.errorAndDispatch(e),reject(e)})},Promise.resolve())}(a)}).then(function(e){console.debug("doInitialSync res",e);var n=o.concat(e);console.debug("Promise.all resArrFinal",n),console.timeEnd("initialSync"),t(n);S("mobileCaddy/connSessUtils").maybeSyncConnSess({mobilecaddy1__Mobile_Process_Status__c:""},function(){console.log("success return from maybeSyncConnSess")},function(e){r(e),h.error(e)})}).catch(function(e){r(e),h.error(e)})}else n.status=T,n.mc_add_status=e.status,t(n),100101==n.mc_add_status||100102==n.mc_add_status?h.error(n):h.log(n)},function(e){h.error(e),n.status=T,t(n)})}})}function W(r,s,a){var t={};return new Promise(function(n,o){0<s.length?A(r,u).then(function(){return U(r)}).then(function(e){return P(r,u,e)}).then(function(t){return new Promise(function(n,o){var e=O(a,u,t);e.status!=u+d?L(r,a,u,s,t).then(function(e){e.status==u?n(e.records):o(e)}):o(e)})}).then(function(e){l.updateRecordsWithExternalId(r,e,a,function(e){t.status=u,t.records=e,mobileCaddy.require("mobileCaddy/vsnUtils").upgradeAvailable().then(function(e){t.upgradeAvailable=e,n(t)}).catch(function(e){n(t)})},function(e){o(e),h.error(e)})},function(e){o(e),h.error(e)}):(t.status=u,t.mc_add_status="No records supplied",t.records=[],n(t),h.warn(t))})}n.exports={SYNC_OK:R,SYNC_NOK:T,SYNC_ALREADY_IN_PROGRESS:C+98,SYNC_UNKONWN_TABLE:C+a,SYNC_MANDATORY_MISSING:C+p,DELETE_RECS_OK:I,DELETE_RECS_UNKONWN_TABLE:I+a,DELETE_RECS_UNKONWN_FIELD:I+d,DELETE_RECS_ACCESS_DENIED:I+f,DELETE_RECS_MANDATORY_MISSING:I+p,INSERT_RECS_OK:v,INSERT_RECS_UNKONWN_TABLE:v+a,INSERT_RECS_UNKONWN_FIELD:v+d,INSERT_RECS_ACCESS_DENIED:v+f,INSERT_RECS_MANDATORY_MISSING:v+p,INSERT_RECS_DATATYPE_MISMATCH:v+g,INSERT_RECS_PROTECTED_FIELD:v+y,INSERT_RECS_UNKNOWN_RECORD_TYPE:v+b,READ_RECS_OK:E,READ_RECS_UNKONWN_TABLE:E+a,READ_RECS_ACCESS_DENIED:E+f,UPDATE_RECS_OK:u,UPDATE_RECS_UNKONWN_TABLE:u+a,UPDATE_RECS_UNKONWN_FIELD:u+d,UPDATE_RECS_ACCESS_DENIED:u+f,UPDATE_RECS_DATATYPE_MISMATCH:u+g,UPDATE_RECS_UNKNOWN_ID:u+7,UPDATE_RECS_UNKNOWN_RECORD_TYPE:u+b,GET_REC_TYPES_UNKONWN_TABLE:r+a,analInc:function(e){return o(e)},deleteRecord:function(e,n,o){return r=e,s=[n],a=o,c={},new Promise(function(o,t){0<s.length?A(r,I).then(function(){return U(r)}).then(function(e){return P(r,I,e)}).then(function(t){return new Promise(function(n,o){var e=O(a,I,t);e.status!=I+d?L(r,a,I,s,t).then(function(e){e.status==I?n(e.records):(o(e),h.error(e))}):(o(e),h.error(e))})}).then(function(e){return l.queryMobileTable(r,a,s[0][a])}).then(function(e){if(0===e.length)c.status=I+p,h.warn("deleteRecord no record found",r),c.mc_add_status="no record found",t(c);else{if(!(e[0].Id.length<19))return i=e,l.querySoupRecsPromise("recsToSync");c.status=I+f,h.warn("deleteRecord Cannot delete synced records"),c.mc_add_status="Cannot delete synced records",t(c)}}).then(function(e){console.debug("tableName",r),console.debug("recsToDelete",i),console.debug("rts recs",e);var n=e.reduce(function(e,n){return n.Mobile_Table_Name==r&&_.findWhere(i,{_soupEntryId:n.SOUP_Record_Id})&&e.push({_soupEntryId:n._soupEntryId}),e},[]);console.debug("rtsRecSoupIds",n),l.deleteRecordsFromSoup(i,r,function(){l.deleteRecordsFromSoup(n,"recsToSync",function(){c.status=I,c.records=i,o(c)},function(e){t(e)})},function(e){t(e)})}).catch(function(e){t(e)}):(c.status=I,h.warn("deleteRecord No records supplied"),c.mc_add_status="No records supplied",c.records=[],o(c))});var r,s,a,i,c},dirtyTables:function(){return F()},syncMobileTable:function(e,n,o,t,r){return function(u,l,s,a,i){l=void 0===l||l;var d=S("mobileCaddy/connSessUtils"),f=S("mobileCaddy/syncRefresh"),p=S("mobileCaddy/smartStoreUtils");S("mobileCaddy/mobileLogger"),s||(s=0),a||(a=50),i||(i=!1);var m=function(e,n,o){var t={};f.p2mRefreshTable(e,s,!0,1,1,null,function(e){console.debug("refreshStatusObject",e),e.status==f.P2M_REFRESH_OK?t.status=R:(t.status=e.status,t.mc_add_status=e.mc_add_status),n(t)},o)},c=function(n,o,t){var r={};p.queryMobileTable("recsToSync","Mobile_Table_Name",n,function(e){if(0<e.length)try{f.m2pUpdateMobileTable(n,a,function(e){console.log("m2pStatusObject",e),e.status==f.M2P_UPDATE_OK&&void 0===e.mc_add_status?(s=0,r.status=0,o(r)):e.status==f.M2P_UPDATE_OK&&"more-to-sync"===e.mc_add_status?(console.log("moreToSync - Going round again"),c(n,o,t)):(r.status=e.status,r.mc_add_status=e.mc_add_status,o(r))},t)}catch(e){console.error(e)}else r.status=2,r.mc_add_status="no-sync-no-updates",o(r)},t)},_=function(n,e,o,t,r){var s={};console.log("skipP2M",i),"Dynamic (Submit First/Retain)"==e||"Dynamic (Submit First/Clear)"==e?c(n,function(e){console.log("statusObject",e),!i&&(0===e.status||o&&2==e.status)?m(n,t,r):(i&&0===e.status||2==e.status?s.status=R:s.status=T,s.mc_add_status=e.mc_add_status,t(s))},r):"Submit Only"==e||"Submit & Clear"==e||"Submit & Destroy"==e?c(n,function(e){0===e.status?s.status=R:(s.status=T,s.mc_add_status=e.mc_add_status),t(s)},r):h.errorAndDispatch("Unknown sync type",e,i)};return new Promise(function(t,r){var s={},a=function(e){localStorage.removeItem("syncInProgressTime"),t(e)},i=function(e){localStorage.removeItem("syncInProgressTime"),r(e)},e="syncTime"+u,n=localStorage.getItem(e),o=(new Date).valueOf(),c=n?parseInt(n)+5e3:0;"Connection_Session__mc"!=u&&o<c?(s.status=R,s.mc_add_status="sync-too-soon",t(s)):(localStorage.setItem(e,o),A(u,C).then(function(){f.heartBeat(function(e){if(console.log("heartbeat call gave "+e.status),e.status==f.HEARTBEAT_OK||e.status==f.HEARTBEAT_NOT_DEVICE||e.status==f.HEARTBEAT_REFRESHED_OK){var n=localStorage.getItem("syncInProgressTime"),o=(new Date).valueOf();console.log("syncInProgressTime",n,o),"Connection_Session__mc"!=u&&n&&o-12e4<n?(console.log("SYNC_ALREADY_IN_PROGRESS"),s.status=100498,i(s)):(localStorage.setItem("syncInProgressTime",o),p.getTableDefnColumnValue(u,"Sync Type").then(function(n){d.getRTSPendingconnSess(function(e){"Mobile_Log__mc"!=u?null!=e?d.csStatusCheck(e,function(e){e.status==d.CONN_SESS_OK?"Refresh Only"==n||"Refresh & Clear"==n?m(u,a,i):_(u,n,l,a,i):(s.status=R,s.mc_add_status=e.status,t(s))},function(e){h.errorAndDispatch(e),r(e)}):"Refresh Only"==n||"Refresh & Clear"==n?m(u,a,i):_(u,n,l,a,i):_(u,n,!1,a,i)},i)}).catch(function(e){i(e)}))}else s.status=T,s.mc_add_status=e.status,t(s),100101==s.mc_add_status||100102==s.mc_add_status?h.error(s):h.log(s)},i)}).catch(i))})}(e,n,o,t,r)},initialSync:function(e){return H(e)},getCurrentUserId:function(){return t()},getCurrentUserName:function(){return t="",new Promise(function(n,o){s("userFirstName").then(function(e){return t=e,s("userLastName")}).then(function(e){n(t+" "+e)}).catch(function(e){h.error("getCurrentUserName",e),o(e)})});var t},getUserLocale:function(){return s("userLocale")},getCachedAppSoupValue:function(e){return s(e)},getRecordTypes:function(e){return t=e,new Promise(function(n,o){A(t,r).then(function(){return V()}).then(function(e){n(e[t])}).catch(function(e){o(e)})});var t},insertRecord:function(e,n){return k(e,[n])},insertRecords:function(e,n){return k(e,n)},logout:function(){return console.log("Logout requested"),void(navigator.appVersion.includes("Electron")?ipcRenderer.sendSync("logout",""):cordova.require("com.salesforce.plugin.sfaccountmanager").logout())},readRecords:function(e,n){return console.debug("readRecords",e),J(e)},smartSql:function(e){return console.debug("smartSql",e),q(e)},updateRecord:function(e,n,o){return W(e,[n],o)},updateRecords:function(e,n,o){return W(e,n,o)},maybeReadTransformType:function(e,n,o){return w(e,0,o)},maybeWriteTransformType:function(e,n,o){return M(e,n,o)}}}),window.mobileCaddy=r("mobileCaddy")}();