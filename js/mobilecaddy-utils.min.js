/* mobilecaddy-utils - v3.1.1 - Bundle Time: 2023-02-20 11:55:38 */
/* git info: "2023-02-20 11:53:22 +0000": 6e9cdd460c64841d4deb69c45bbb8385f93c3453 (v3) */
/* Copyright 2023 MobileCaddy Ltd */

String.prototype.includes||(String.prototype.includes=function(e,n){"use strict";return"number"!=typeof n&&(n=0),!(n+e.length>this.length)&&-1!==this.indexOf(e,n)}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),t=n.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var o=arguments[1],r=0;r<t;){var i=n[r];if(e.call(o,i,r,n))return i;r++}},configurable:!0,writable:!0});var $j=jQuery.noConflict(),MC_TABLES=["Connection_Session__mc","Mobile_Log__mc","MC_Project__ap","MC_Time_Expense__ap","MC_Project_Location__ap"],_typeof=function(e){return typeof e};!function(){var e,n;!function(){var t={},o=[],r={};e=function(n){if(t[n]){if(n in r)o.slice(r[n]).join("->")}else;if(t[n].factory)try{return r[n]=o.length,o.push(n),i=t[n],a=i.factory,i.exports={},delete i.factory,a(e,i.exports,i),i.exports}finally{delete r[n],o.pop()}var i,a;return t[n].exports},(n=function(e,n){t[e],t[e]={id:e,factory:n}}).remove=function(e){delete t[e]}}(),"object"==typeof module&&"function"==typeof e&&(module.exports.require=e,module.exports.define=n),n("mobileCaddy",function(e,t,o){var r={define:n,require:e,START_PAGE_CONTROLLER:"",START_PAGE_CONTROLLER_VSN:"001",QUERY_BUFFER_SIZE:1e3,QUERY_BUFFER_SIZE_SL:1e3,INITIAL_APPCACHE_INFO:[],CONTAINER_VSN_KEY:"mcBaseBuildVersion"};o.exports=r}),n("mobileCaddy/mobileLogger",function(e,n,t){function o(){try{throw Error("")}catch(e){return e}}function r(e,n){var t=n.stack.split("\n")[4];if(void 0!==t){var o=t.indexOf("at ");t.slice(o+2,t.length)}}t.exports={logMessageAndThrow:function(e){!function(e,n){throw r(0,n),e}(e,o())},logMessage:function(e){r(0,o())},logObjectDetails:function(e){!function(e,n){for(var t in e)r(e[t],n)}(e,o())}}}),n("mobileCaddy/geoLocation",function(e,n,t){t.exports={getLocation:function(e,n){!function(e,n){var t=[];t.Error="Location information is unavailable.",t.ErrorNumber=2,e(t)}(e)}}}),n("mobileCaddy/startup",function(e,n,t){e("mobileCaddy/mobileLogger");var o=e("mobileCaddy/logger"),r=(cordova.require("com.salesforce.plugin.smartstore"),e("mobileCaddy/systemData")),i=e("mobileCaddy/smartStoreUtils"),a=e("mobileCaddy/appDataUtils"),s=(e("mobileCaddy/geoLocation"),e("mobileCaddy/syncRefresh")),c=!!window.LOCAL_DEV,u=!!window.USE_FORCETK,d=[],l=["Initialising"];(window.addEventListener("error",function(e){var n=e.error?e.error.stack:null;e.error&&e.error.toString()}),"serviceWorker"in navigator&&"function"==typeof BroadcastChannel)&&(new BroadcastChannel("sw-channel").onmessage=function(e){var n;n=e.data.payload,d=n.map(function(e){return{Name:"",Description:e}}),w().then(function(e){var n=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");n.upsertSoupEntries("cacheSoup",d,function(e){},function(e){})})});function f(){return new Promise(function(e,n){var t=function(){window.plugin&&plugin.mcsdk?plugin.mcsdk.getConfig(function(n){window[mobileCaddy.CONTAINER_VSN_KEY]=n.result.baseBuildVersion,n.result.baseBuildVersion.startsWith("3"),e()},function(n){o.error("Error getting mcsdk baseBuildVersion",n),e()}):e()};window.clientBundleVersion<"0.1.0"?t():setTimeout(t,800)})}function p(){return!(!window[mobileCaddy.CONTAINER_VSN_KEY]||!window[mobileCaddy.CONTAINER_VSN_KEY].startsWith("3"))}var m=100900,S=100901,h=100902;function y(e){var n=navigator.appVersion.match(/.Chrome\/(\S*)/gm),t=!1;if(n&&(n=n[0].split("/")[1].split(".")[0],Number(n)>=69&&(t=!0)),t&&"serviceWorker"in navigator)e({status:h});else{l.unshift("Checking Cache"),d=[];var o=localStorage.getItem("tmpCacheItems");if(o){var r=JSON.parse(o);if(r.length>0&&("preBootstrap-noupdate"==r[r.length-1].Description||"preBootstrap-checking"==r[r.length-1].Description))return d=[],void e({status:m});if(d=r,r.length>0&&"preBootstrap-cached"==r[r.length-1].Description)return void e({status:m})}else window.applicationCache?d.push({Name:"AppCache: Initial Status",Description:window.applicationCache.status}):d.push({Name:"AppCache: Initial Status",Description:"window.applicationCache is undefined"});if(window.applicationCache){window.applicationCache.addEventListener("checking",function(e){g(e)},!1),window.applicationCache.addEventListener("downloading",function(e){g(e)},!1),window.applicationCache.addEventListener("progress",function(e){g(e)},!1);var i={};switch(i.status=m,window.applicationCache.status){case window.applicationCache.CHECKING:case window.applicationCache.DOWNLOADING:return window.applicationCache.addEventListener("updateready",function(n){g(n,e)},!1),window.applicationCache.addEventListener("cached",function(n){g(n,e)},!1),window.applicationCache.addEventListener("error",function(n){g(n,e)},!1),void window.applicationCache.addEventListener("noupdate",function(n){g(n,e)},!1);case window.applicationCache.UPDATEREADY:default:e(i)}}else e({status:h})}}function g(e,n){"progress"==e.type?d.push({Name:"Event ",Description:e.loaded+" of "+e.total}):d.push({Name:"Event ",Description:e.type});var t={};"udpateready"==e.type||"cached"==e.type?t.status=m:t.status=S,n&&"function"==typeof n&&n(t)}function v(e,n){l.unshift("Preparing platform");var t=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),r=R("appSoupJson");if(""!==r){var i=JSON.parse(r);t.registerSoup("appSoup",[{path:"Name",type:"string"},{path:"CurrentValue",type:"string"},{path:"NewValue",type:"string"}],function(){t.upsertSoupEntries("appSoup",i,function(o){t.registerSoup("cacheSoup",[{path:"Name",type:"string"},{path:"Description",type:"string"}],function(){E(e,n)},function(e){})},function(e){})},function(e){})}else void 0!==c&&c?new Promise(function(e,n){var t=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");new Promise(function(e,n){if(u){var t=window.SF_LOGIN_URL?window.SF_LOGIN_URL:"https://login.salesforce.com";force.isLoggedIn()?e():(force.init({appId:"3MVG9Rd3qC6oMalWEuQby1hkUef0N2L7kTPExDjRAs1GH35ueKyc3q_D5NY0LLoLHnfwIr_Y8PyeRotaClrtZ",apiVersion:"v30.0",loginUrl:t,tokenStore:localStorage,oauthRedirectURL:"http://localhost:3030/oauthcallback.html",proxyURL:"http://localhost:3000"}),force.isLoggedIn()?e():force.login(function(){e()},function(e){alert("Salesforce login failed"),n(e)}))}else e()}).then(function(e){return new Promise(function(e,n){var t=!localStorage.getItem("initialSyncState");if(u&&t){var o=window.DEVICE_APP_NAME?window.DEVICE_APP_NAME:"BIZ001";force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/codeflowUtils001",contentType:"application/json",data:{buildVersion:"001",buildName:o,buildOS:"Android",deviceUuid:"c86d3e94574debug",overrideUserId:"",startPageControllerVersion:"001"}},function(n){e()},function(e){alert("Salesforce codeflowUtils001 failed"),n(e)})}else e()})}).then(function(o){l.unshift("Creating CodeFlow records"),t.soupExists("appSoup",function(o){o?t.soupExists("cacheSoup",function(o){o?e():t.registerSoup("cacheSoup",[{path:"Name",type:"string"},{path:"Description",type:"string"}],function(){e()},function(e){n(e)})},function(e){n(e)}):t.registerSoup("appSoup",[{path:"Name",type:"string"},{path:"teststring",type:"string"},{path:"testinteger",type:"string"},{path:"CurrentValue",type:"string"},{path:"NewValue",type:"string"},{path:"testno",type:"integer"}],function(){var o=window.DEVICE_APP_NAME?window.DEVICE_APP_NAME:"BIZ001",r=[{Name:"applicationName",CurrentValue:"MAP-0012001",NewValue:"MAP-0012001",_soupEntryId:1},{Name:"userId",CurrentValue:"",NewValue:"",_soupEntryId:2},{Name:"buildStatus",CurrentValue:"Initial",NewValue:"Initial",_soupEntryId:3},{Name:"buildVersion",CurrentValue:"001",NewValue:"001",_soupEntryId:4},{Name:"buildName",CurrentValue:o,NewValue:o,_soupEntryId:5},{Name:"buildOS",CurrentValue:"Android",NewValue:"Android",_soupEntryId:6},{Name:"deviceUuid",CurrentValue:"c86d3e94574debug",NewValue:"c86d3e94574debug",_soupEntryId:7},{Name:"accessToken",CurrentValue:"123",NewValue:"123",_soupEntryId:8}];localStorage.setItem("appSoup",JSON.stringify(r)),t.registerSoup("cacheSoup",[{path:"Name",type:"string"},{path:"Description",type:"string"}],function(){e()},function(e){n(e)})},function(e){n(e)})})}).catch(function(e){o.error(e),n(e)})}).then(function(t){E(e,n)}).catch(function(e){throw o.error(e),e}):navigator.appVersion.includes("Electron")?t.soupExists("appSoup",function(o){if(o)E(e,n);else{var r=[],i=ipcRenderer.sendSync("request-creds","");R("access_token","?"+i);if(r.push({Name:"accessToken",CurrentValue:R("access_token","?"+i),NewValue:null}),r.push({Name:"refreshToken",CurrentValue:R("refresh_token","?"+i),NewValue:null}),r.push({Name:"clientId",CurrentValue:R("client_id","?"+i),NewValue:null}),r.push({Name:"orgId",CurrentValue:R("org_id","?"+i),NewValue:null}),r.push({Name:"applicationName",CurrentValue:R("buildName","?"+i),NewValue:null}),r.push({Name:"buildName",CurrentValue:R("buildName","?"+i),NewValue:null}),window.location.pathname.startsWith("/apex/"))r.push({Name:"loginUrl",CurrentValue:window.location.protocol+"//"+window.location.host,NewValue:null});else{var a=window.location.pathname.split("/")[1];r.push({Name:"loginUrl",CurrentValue:window.location.protocol+"//"+window.location.host+"/"+a,NewValue:null})}var s=ipcRenderer.sendSync("request-device-info","");r.push({Name:"buildStatus",CurrentValue:"Initial"}),r.push({Name:"buildVersion",CurrentValue:s.buildVersion}),r.push({Name:"buildOS",CurrentValue:s.platform}),r.push({Name:"deviceUuid",CurrentValue:s.uuid});t.registerSoup("appSoup",[{path:"Name",type:"string"},{path:"CurrentValue",type:"string"},{path:"NewValue",type:"string"}],function(){t.upsertSoupEntries("appSoup",r,function(t){w().then(function(t){E(e,n)})},function(e){})},function(e){})}}):w().then(function(t){E(e,n)})}function w(){return new Promise(function(e,n){var t=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");t.soupExists("cacheSoup",function(o){if(o)e();else{t.registerSoup("cacheSoup",[{path:"Name",type:"string"},{path:"Description",type:"string"}],function(){e()},function(e){n(e)})}})})}var C=100800,b=100801;function E(e,n){var t=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");t.upsertSoupEntries("cacheSoup",d,function(){i.querySoupRecsPromise("appSoup").then(function(o){var c={},d=[];if(o.forEach(function(e){if(void 0!==c[e.Name])throw"Should only be 1 "+e.Name+" entry in the app soup.  Found more";c[e.Name]=e}),c.userOverrideId||(c.userOverrideId=""),"Complete"==c.buildStatus.CurrentValue&&"Complete"==c.buildStatus.NewValue)if(null!==e){var f={};if(f.status=b,f.mc_add_status=n.status,f.curVsn=c.dynVersionNumber.CurrentValue,void 0!==c.dynVersionNumber.NewValue&&(f.newVsn=c.dynVersionNumber.NewValue),navigator.appVersion.includes("Electron")){var m=window.location.protocol+"//"+window.location.host+window.location.pathname;ipcRenderer.send("startPageUrl",m)}"undefined"!=typeof plugin&&plugin.mcsdk&&window.Ionic.version&&window.Ionic.version.startsWith("1")&&plugin.mcsdk.getSplashScreenTimeout(function(e){setTimeout(function(){plugin.mcsdk.hideSplashScreen()},e.result)}),e(f)}else"undefined"!=typeof plugin&&plugin.mcsdk&&plugin.mcsdk.hideSplashScreen();else{l.unshift("Preparing database");var S=function(o,s){if(s.status){d=JSON.parse(o);var u=_.find(d,{Name:"audId"}).CurrentValue,f=_.find(d,{Name:"sysDataPlatSupVersion"}).CurrentValue;if(navigator.appVersion.includes("Electron")){var p=window.location.protocol+"//"+window.location.host+window.location.pathname;ipcRenderer.send("startPageUrl",p)}var m=_.find(d,{Name:"dynVersionNumber"}).CurrentValue;c.dynVersionNumber?c.dynVersionNumber.CurrentValue=m:c.dynVersionNumber={CurrentValue:m},localStorage.setItem("appSoupValObj",JSON.stringify(c)),a.getPlatformAppConfig(c,!0).then(function(){return l.unshift("Building system tables"),new Promise(function(e,n){(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).registerSoup("recsToSync",[{path:"Mobile_Table_Name",type:"string"},{path:"SOUP_Record_Id",type:"string"},{path:"Id",type:"string"},{path:"LastModifiedDateTime",type:"integer"},{path:"CRUD_Operation",type:"string"},{path:"Current_Connection_Session",type:"string"}],function(){e()},function(e){n(e)})})}).then(function(){return new Promise(function(e,n){(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).registerSoup("File_Library__ap",[{path:"Id",type:"string"},{path:"SF_Content_Version_Id__c",type:"string"},{path:"File_Type__c",type:"string"},{path:"Synchronised__c",type:"integer"}],function(){e()},function(e){n(e)})})}).then(function(){r.createSystemDataSoup(function(){l.unshift("Building tables"),i.buildMobileTables(function(){var o=c.buildStatus;o.CurrentValue="Complete",o.NewValue="Complete",d.map(function(e){return c[e.Name]&&(e._soupEntryId=c[e.Name]._soupEntryId),e}),d.push(o),l.unshift("Finalising build"),t.upsertSoupEntries("appSoup",d,function(){r.getRecordTypeDots(u,f).then(function(){if(null!==e){var t={};t.status=C,t.mc_add_status=n.status,"undefined"!=typeof plugin&&plugin.mcsdk&&window.Ionic.version&&window.Ionic.version.startsWith("1")&&plugin.mcsdk.getSplashScreenTimeout(function(e){setTimeout(function(){plugin.mcsdk.hideSplashScreen()},e.result)}),e(t)}else"undefined"!=typeof plugin&&plugin.mcsdk&&plugin.mcsdk.hideSplashScreen()}).catch(function(e){})},function(e){})},function(e){})},function(e){},u,f)}).catch(function(e){})}else"exception"===s.type&&alert(s.message)};s.heartBeat(function(e){p()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getAUDInfo001",contentType:"application/json",data:{buildVersion:c.buildVersion.CurrentValue,buildName:c.buildName.CurrentValue,buildOS:c.buildOS.CurrentValue,deviceUuid:c.deviceUuid.CurrentValue,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,overrideUserId:""}},function(e){var n={};n.status=e.status,S(JSON.parse(e.data),n)},function(e){}):!0===u?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getAUDInfo001",contentType:"application/json",data:{buildVersion:c.buildVersion.CurrentValue,buildName:c.buildName.CurrentValue,buildOS:c.buildOS.CurrentValue,deviceUuid:c.deviceUuid.CurrentValue,overrideUserId:force.getUserId(),startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN}},function(e){var n={status:"200"};S(e,n)},function(e){}):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".getAudInfo",c.buildVersion.CurrentValue,c.buildName.CurrentValue,c.buildOS.CurrentValue,c.deviceUuid.CurrentValue,c.userOverrideId,S,{escape:!1,timeout:3e4})},function(e){alert("Failed to refresh authentication. Please uninstall/re-install the application")})}}).catch(function(e){})},function(e){})}function R(e,n){n||(n=window.location.search),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(n);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}t.exports={startup:function(e){!function(e){if(window.ionic&&!window.Ionic&&(window.Ionic=window.ionic),!e)return new Promise(function(e,n){f().then(function(n){"undefined"!=typeof plugin&&plugin.mcsdk&&(!window.Ionic.version||window.Ionic.version.startsWith("1")),y(function(n){v(function(n){e(n)},n)})}).catch(function(e){o.error("setContainerVersion",e),n(e)})});f().then(function(n){"undefined"==typeof plugin||!plugin.mcsdk||window.Ionic.version&&window.Ionic.version.startsWith("1")||plugin.mcsdk.hideSplashScreen(),y(function(n){v(e,n)})}).catch(function(e){o.error("setContainerVersion",e)})}(e)}}}),n("mobileCaddy/systemData",function(e,n,t){var o=e("mobileCaddy"),r=e("mobileCaddy/logger"),i=(cordova.require("com.salesforce.plugin.smartstore"),e("mobileCaddy/appDataUtils"));function a(){return!(!window[o.CONTAINER_VSN_KEY]||!window[o.CONTAINER_VSN_KEY].startsWith("3"))}var s=!!window.USE_FORCETK;function c(e,n,t,i){!function(e,n,t,i){var c=function(c,u){if(u.status){var d=JSON.parse(c);d.forEach(function(e){});var l=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");l.registerSoup("syncLib_system_data",d,function(){!function(e,n,t,i){var c=function(e,n){if(n.status){var o=JSON.parse(e);(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntries("syncLib_system_data",o,t,i)}else"exception"===n.type?(alert(n.message),r.error("Exception return from getSystemDataRowValues = "+n.message)):r.error("Unknown return from getSystemDataRowValues = "+n.message)};a()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getSysDataSoupVariables001",contentType:"application/json",data:{audId:e,startPageControllerVersion:o.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:n}},function(e){var n={status:e.status};c(JSON.parse(e.data),n)},i):!0===s?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getSysDataSoupVariables001",contentType:"application/json",data:{audId:e,startPageControllerVersion:o.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:n}},function(e){var n={status:"200"};c(e,n)},i):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+o.START_PAGE_CONTROLLER+".getSysDataSoupVariables",e,n,c,{escape:!1})}(e,n,function(){!function(e,n,t,i){var c=function(e,n){if(n.status){var o=JSON.parse(e),a=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");a.upsertSoupEntries("syncLib_system_data",o,function(e){t(e)},function(e){r.error("Error returned from upsert, message =  "+e),i(e)})}else"exception"===n.type?(alert(n.message),r.error("Exception return from getDefsForSObjectMobileTables = "+n.message)):r.error("Unknown return from getDefsForSObjectMobileTables = "+n.message)};a()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getDefsForSObjectMobileTables001",contentType:"application/json",data:{audId:e,startPageControllerVersion:o.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:n}},function(e){var n={status:e.status};c(JSON.parse(e.data),n)},i):!0===s?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getDefsForSObjectMobileTables001",contentType:"application/json",data:{audId:e,startPageControllerVersion:o.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:n}},function(e){var n={status:"200"};c(e,n)},i):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+o.START_PAGE_CONTROLLER+".getDefsForSObjectMobileTables",e,n,c,{escape:!1,timeout:12e4})}(e,n,t,i)},i)},i)}else"exception"===u.type?(alert(u.message),r.error("Exception return from getSystemDataSoupDefinition = "+u.message)):r.error("Unknown return from getSystemDataSoupDefinition = "+u.message)};a()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getSystemDataSoupDefinition001",contentType:"application/json",data:{audId:e,startPageControllerVersion:o.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:n}},function(e){var n={status:e.status};c(JSON.parse(e.data),n)},i):!0===s?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/getSystemDataSoupDefinition001",contentType:"application/json",data:{audId:e,startPageControllerVersion:o.START_PAGE_CONTROLLER_VSN,systemDataPlatformSupportVersion:n}},function(e){var n={status:"200"};c(e,n)},i):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+o.START_PAGE_CONTROLLER+".getSystemDataSoupDefinition",e,n,c,{escape:!1})}(t,i,e,n)}t.exports={createSystemDataSoup:function(e,n,t,o){c(e,n,t,o)},getRecordTypeDots:function(e){return new Promise(function(n,t){var c,u=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),d=function(e,o){o.status?u.registerSoup("dotsRecordTypes",[{path:"Table",type:"string"},{path:"Data",type:"string"}],function(o){var i=JSON.parse(e).map(function(e){return{Table:e.mobileTableName,Data:JSON.stringify(e.recTypeInfoList)}});u.upsertSoupEntries("dotsRecordTypes",i,function(t){var o={};JSON.parse(e).forEach(function(e){var n={};e.recTypeInfoList.forEach(function(e){e.recTypeDevName?(n[e.recTypeId]={recTypeName:e.recTypeName,recTypeDevName:e.recTypeDevName},n[e.recTypeName]=e.recTypeId,n[e.recTypeDevName]=e.recTypeId):(n[e.recTypeId]=e.recTypeName,n[e.recTypeName]=e.recTypeId)}),o[e.mobileTableName]=n}),localStorage.setItem("lsDotsRecordTypes",JSON.stringify(o)),n()},function(e){r.error("Error returned from upsert, message =  "+e),t(e)})},function(e){t(e)}):"exception"===o.type?(r.error("Exception return from p2mRefreshRecTypeDOTs = "+o.message),t(o.message)):(r.error("Unknown return from p2mRefreshRecTypeDOTs = "+o.message),t(o.message))};i.getCachedCurrentValueFromAppSoup("syncRefreshVersion").then(function(n){c=n,a()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/p2mRefreshRecTypeDOTs001",contentType:"application/json",data:{audId:e,startPageControllerVersion:o.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:c,connSessJson:"{}"}},function(e){var n={status:e.status};d(JSON.parse(e.data),n)},function(e){d("[]",{status:"OK"})}):!0===s?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/p2mRefreshRecTypeDOTs001",contentType:"application/json",data:{audId:e,startPageControllerVersion:o.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:c,connSessJson:"{}"}},function(e){var n={status:"200"};d(e,n)},function(e){d("[]",{status:"OK"})}):Visualforce.remoting.Manager.getAction("mobilecaddy1."+o.START_PAGE_CONTROLLER+".p2mRefreshRecTypeDOTs")?Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+o.START_PAGE_CONTROLLER+".p2mRefreshRecTypeDOTs",e,c,"{}",d,{escape:!1,timeout:12e4}):d("[]",{status:"OK"})})})}}}),n("mobileCaddy/smartStoreUtils",function(e,n,t){var o=e("mobileCaddy/logUtils");cordova.require("com.salesforce.plugin.smartstore");function r(e,n,t){var o=[];function r(e){n(o)}function i(e){if(!t)throw e;t(e)}!function e(n){n.currentPageOrderedEntries.forEach(function(e){o.push(e)}),n.currentPageIndex<n.totalPages-1?cordova.require("com.salesforce.plugin.smartstore").moveCursorToNextPage(n,e):cordova.require("com.salesforce.plugin.smartstore").closeCursor(n,r,i)}(e)}function i(e,n,t){var o=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),i=o.buildAllQuerySpec("_soupEntryId",null,mobileCaddy.QUERY_BUFFER_SIZE);o.querySoup(e,i,function(e){r(e,function(e){n(e)},t)})}function a(e,n,t,o){(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).querySoup(e,n,function(e){r(e,function(e){t(e)},o)},o)}function s(e,n,t){var o=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");if(void 0===n&&void 0===t)return new Promise(function(n,t){o.runSmartQuery(e,function(e){r(e,function(e){n(e)},function(e){t(e)})},function(e){t(e)})});o.runSmartQuery(e,function(e){r(e,function(e){n(e)},t)},t)}function c(e,n,t,o,r){var i=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");if(void 0===o&&void 0===r)return new Promise(function(o,r){var s=i.buildExactQuerySpec(n,t,mobileCaddy.QUERY_BUFFER_SIZE_SL);a(e,s,function(e){o(e)},function(e){r(e)})});var s=i.buildExactQuerySpec(n,t,mobileCaddy.QUERY_BUFFER_SIZE_SL);a(e,s,function(e){o(e)},r)}function u(e,n,t,o,r,i,s){a(e,(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).buildExactQuerySpec(n,t,mobileCaddy.QUERY_BUFFER_SIZE_SL),function(e){var n=[];e.forEach(function(e){e[o]==r&&n.push(e)}),i(n)},s)}function d(e,n,t){p("Row Mapping PT","Mobile Table Name",function(o){u("syncLib_system_data","MC_Var_String_001","Platform Table Definition",o,e,function(e){e.length,n(e[0])},t)},t)}function l(e,n){return new Promise(function(t,o){d(e,function(e){p("Row Mapping PT",n,function(n){t(e[n])},function(e){o(e)})},function(e){o(e)})})}function f(e,n,t){return new Promise(function(o,r){var i=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");d(e,function(e){p("Row Mapping PT",n,function(n){e[n]=t,i.upsertSoupEntries("syncLib_system_data",[e],function(){o()},function(e){r(e)})},function(e){r(e)})},function(e){r(e)})})}function p(e,n,t,o){var r=e+"_"+n,i=localStorage.getItem(r);i?t(i):u("syncLib_system_data","MC_Var_String_001",e,"MC_Var_String_003",n,function(e){e.length,localStorage.setItem(r,e[0].MC_Var_String_004),t(e[0].MC_Var_String_004)},o)}function m(e,n,t,o){a("syncLib_system_data",(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).buildExactQuerySpec("MC_Var_String_001",e,mobileCaddy.QUERY_BUFFER_SIZE_SL),function(o){var r=[];n.forEach(function(n){var t=!1;if(o.forEach(function(e){if(e.MC_Var_String_003==n)return r.push(e.MC_Var_String_004),void(t=!0)}),!t)throw"No mapping found for type = "+e+" and value = "+n}),t(r)},o)}var _=1,S=2;function h(e){return new Promise(function(n,t){(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).soupExists("Analytics",function(e){n(e)},function(n){o.error("soupExists",e,n).then(function(e){E("Mobile_Log__mc",[e],function(e){t(n)},function(e){t(e)})}).catch(function(e){t(n)})})})}function y(e,n,t){m("Row Mapping PT",["Mobile Table Name","Build Order"],function(o){var r=o[0],i=o[1];c("syncLib_system_data","MC_Var_String_001","Platform Table Definition",function(t){var o=[];e==S?(t.sort(function(e,n){var t=0,o=parseInt(e[i]),r=parseInt(n[i]);return isNaN(o)||isNaN(r)||(t=o-r),t}),t.forEach(function(e){o.push(e[r])}),null!==n&&n(o)):(t.forEach(function(e){o.push(e[r])}),e==_&&o.sort(),null!==n&&n(o))},t)},t)}var g=0,v=1,w=2;function C(e,n,t,o){m("Row Mapping TC",["Parent SOUP Name","Table Column Name","Mobile Column Type","Application Field CRUD","META isNillable","Platform Column Type","Device Value Type","Proxy Ref Field Name"],function(o){var r=o[0],i=o[1],a=o[2],s=o[3],c=o[4],d=o[5],l=o[6],f=o[7];u("syncLib_system_data","MC_Var_String_001","Platform Table Column",r,e,function(e){var o=[];e.forEach(function(e){n==g?o.push(e[i]):n==w?o.push({path:e[i],type:e[a],crud:e[s],nillable:e[c],platColType:e[d],appColType:e[l],proxyRefField:e[f]}):o.push({path:e[i],type:e[a]})}),t(o)},function(e){})},o)}function b(e,n,t,o){if(0!==e.length){var r=[];if(e.forEach(function(e){e&&e._soupEntryId&&r.push(e._soupEntryId)}),0!==r.length)(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).removeFromSoup(n,r,function(e){t(e)},o);else t()}else t()}function E(e,n,t,o){(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntries(e,n,function(n){var r=(new Date).getTime();!function(e,n,t,o,r){var i;R(e).then(function(e){return i=e,n="audId",t=localStorage.getItem("appSoup-"+n),new Promise(function(e,o){t?e(t):function(e){return new Promise(function(n,t){var o=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),r=o.buildExactQuerySpec("Name",e,mobileCaddy.QUERY_BUFFER_SIZE);a("appSoup",r,function(e){e[0]?n(e[0].CurrentValue):n(e[0])},function(e){t(e)})})}(n).then(function(t){localStorage.setItem("appSoup-"+n,t),e(t)})});var n,t}).then(function(o){return n.forEach(function(n){var r="PROXY%"+e+"%"+t+"%"+n._soupEntryId+"%"+o;n.Id=r,n[i]=r}),function(e,n){return new Promise(function(t,o){(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntries(e,n,function(e){t(e)},function(e){o(e)})})}(e,n)}).then(function(e){o(e)}).catch(function(e){r(e)})}(e,n,r,function(n){var i=[];n.forEach(function(n){var t={Mobile_Table_Name:e,CRUD_Operation:"Insert",SOUP_Record_Id:n._soupEntryId,Id:n.Id,LastModifiedDateTime:r};i.push(t)}),(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntriesWithExternalId("recsToSync",i,"Id",t,o)},o)},o)}function R(e){return new Promise(function(n,t){var o=localStorage.getItem("proxyField-"+e);o?n(o):C(e,g,function(t){var o=null;t.forEach(function(n){n.includes("MC_Proxy_ID")&&(o=n,localStorage.setItem("proxyField-"+e,n))}),n(o)},function(e){n(null)})})}t.exports={ALPHA:_,BUILD:S,listSoups:function(){return new Promise(function(e,n){Promise.resolve();var t=["Connection_Session__mc","Mobile_Log__mc"],r=["SnapShot_Connection_Session__mc","SnapShot_Mobile_Log__mc"],i=["appSoup","cacheSoup","dotsRecordTypes","recsToSync","syncLib_system_data"];h("Analytics").then(function(a){a&&i.unshift("Analytics"),y(_,function(n){n.splice(n.indexOf("Connection_Session__mc"),1),n.splice(n.indexOf("Mobile_Log__mc"),1);var o=t.concat(n).concat(r);n.reduce(function(e,n){return e.then(function(){return l(n,"Snapshot Data Required")}).then(function(e){return"Yes"==e&&-1==t.indexOf(n)&&o.push("SnapShot_"+n),o}).catch(function(e){})},Promise.resolve()).then(function(n){e(n.concat(i))})},function(e){o.error("Failed to listSoups",e).then(function(t){E("Mobile_Log__mc",[t],function(t){n(e)},function(t){n(e)})}).catch(function(t){n(e)})})})})},listMobileTables:y,FULL:w,listMobileTableColumns:C,queryMobileTable:c,buildMobileTables:function(e,n){y(S,function(t){var o=t.length;t.forEach(function(t){C(t,v,function(r){var i=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");i.registerSoup(t,r,function(){f(t,"SOUP Built Date/Time",(new Date).getTime()).then(function(){return function(e,n){n.forEach(function(n){n.path.includes("MC_Proxy_ID")&&localStorage.setItem("proxyField-"+e,n.path)})}(t,r),l(t,"Snapshot Data Required")}).then(function(a){"Yes"==a?i.registerSoup("SnapShot_"+t,r,function(){f(t,"Snapshot SOUP Built Date/Time",(new Date).getTime()),0==--o&&e()},function(e){n(e)}):0==--o&&e()}).catch(function(e){n(e)})},n)},function(e){n(e)})})},n)},getProxyFieldName:R,getSysDataRowMapColHeading:p,getSysDataRowMapColHeadings:m,getTableDefnColumnValue:function(e,n){return l(e,n)},setTableDefnColumnValue:f,queryMobileTableWithAnd:u,smartQuerySoupRecordsWithQuerySpec:s,insertRecords:E,updateRecordsWithExternalId:function(e,n,t,o,r){(function(e,n,t){var o=n.length,r=0;return new Promise(function(i,a){R(e).then(function(s){n.forEach(function(u,d){c(e,t,u[t]).then(function(l){if(l.length>0){var f=l[0];for(var p in u)f[p]=u[p];n[d]=f,++r>=o&&i(n)}else"Id"==t&&u.Id.length>18?c(e,s,u.Id).then(function(e){if(e.length>0){var t=e[0];for(var s in u)"Id"!=s&&(t[s]=u[s]);n[d]=t,++r>=o&&i(n)}else a({status:101107})}):a({status:101107})}).catch(function(e){a(e)})})}).catch(function(e){a(e)})})})(e,n,t).then(function(n){var i=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");i.upsertSoupEntriesWithExternalId(e,n,t,function(n){c("recsToSync","Mobile_Table_Name",e,function(t){var a=[];n.forEach(function(n){var o,r;if(t.forEach(function(e){e.Id!=n.Id||(o=e)}),void 0!==o)if(o.Current_Connection_Session&&void 0!==o.Current_Connection_Session)switch(o.CRUD_Operation){case"Insert":case"InsertUpdate":r="InsertUpdate";break;default:r="UpdateUpdate"}else r=o.CRUD_Operation;else r="Update";var i={Mobile_Table_Name:e,SOUP_Record_Id:n._soupEntryId,Id:n.Id,CRUD_Operation:r,LastModifiedDateTime:n.SystemModstamp};"InsertUpdate"!=r&&"UpdateUpdate"!=r||(i.Current_Connection_Session=o.Current_Connection_Session),a.push(i)}),i.upsertSoupEntriesWithExternalId("recsToSync",a,"Id",o,r)},r)},r)}).catch(function(e){r(e)})},deleteSoup:function(e){return new Promise(function(n,t){(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).removeSoup(e,function(){o.log("deleteSoup",e).then(function(e){h("Mobile_Log__mc").then(function(t){t?E("Mobile_Log__mc",[e],function(e){n()},function(e){n()}):n()})}).catch(function(e){t(e)})},function(e){o.errorAndDispatch("deleteSoup",e).then(function(n){E("Mobile_Log__mc",[n],function(n){t(e)},function(n){t(e)})}).catch(function(n){t(e)})})})},querySoupRecords:i,querySoupRecsPromise:function(e){return new Promise(function(n,t){i(e,function(e){n(e.filter(function(e){return"object"==_typeof(e)}))},function(e){t(e)})})},querySoupRecordsWithQuerySpec:a,deleteRecordsForExternalId:function(e,n,t,o,r){if(!o&&!r)return new Promise(function(o,r){if(0===n.length)o();else{var i="";"object"==_typeof(n[0])?n.forEach(function(e,n){i+=0===n?"'"+e[t]+"'":",'"+e[t]+"'"}):n.forEach(function(e,n){i+=0===n?"'"+e+"'":", '"+e+"'"});var a="SELECT {"+e+":_soupEntryId} FROM {"+e+"} WHERE {"+e+":"+t+"} IN ("+i+")",c=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");s(c.buildSmartQuerySpec(a,1e4)).then(function(n){var t=n.map(function(e){return e[0]});c.removeFromSoup(e,t,function(e){o(e)},function(e){r(e)})}).catch(function(e){r(e)})}});if(0===n.length)o();else{var i=[];n.forEach(function(e){i.push(e[t])});var a="";n.forEach(function(e,n){a+=0===n?"'"+e[t]+"'":",'"+e[t]+"'"});var c="SELECT {"+e+":_soupEntryId} FROM {"+e+"} WHERE {"+e+":"+t+"} IN ("+a+")",u=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");s(u.buildSmartQuerySpec(c,1e4),function(n){var t=n.map(function(e){return e[0]});u.removeFromSoup(e,t,function(e){o()},function(e){r(e)})},function(e){r(e)})}},deleteRecordsForExternalId2:function(e,n,t,o,r){if(0===n.length)o();else{var i="SELECT {"+e+":_soupEntryId}, {"+e+":Id} FROM {"+e+"}",a=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");s(a.buildSmartQuerySpec(i,1e4)).then(function(t){var i=[];t.forEach(function(e){n.includes(e[1])&&i.push(e[0])}),i.length>0?a.removeFromSoup(e,i,function(e){o()},function(e){r(e)}):o()}).catch(function(e){r(e)})}},deleteRecordsFromSoup:b}}),n("mobileCaddy/appDataUtils",function(e,n,t){cordova.require("com.salesforce.plugin.smartstore");var o=e("mobileCaddy/smartStoreUtils"),r=!!window.LOCAL_DEV,i=!!window.USE_FORCETK;function a(e){return new Promise(function(n,t){var r=(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).buildExactQuerySpec("Name",e,mobileCaddy.QUERY_BUFFER_SIZE);o.querySoupRecordsWithQuerySpec("appSoup",r,function(e){e[0]?n(e[0].CurrentValue):n(e[0])},function(e){t(e)})})}function s(e,n,t,r){return new Promise(function(i,a){var s=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),c=s.buildExactQuerySpec("Name",e,mobileCaddy.QUERY_BUFFER_SIZE);o.querySoupRecordsWithQuerySpec("appSoup",c,function(o){if(o.length>0)o[0][t]=n,s.upsertSoupEntries("appSoup",o,function(e){i(e)},function(e){a(e)});else if(r){var c={Name:e};c[t]=n,s.upsertSoupEntries("appSoup",[c],function(e){i(e)},function(e){a(e)})}else i()},function(e){a(e)})})}function c(e,n){return s(e,n,"CurrentValue",!0)}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(t,a){new Promise(function(e,n){r?window.REMOTE_NAMESPACE?e({result:window.REMOTE_NAMESPACE}):e(null):"undefined"!=typeof plugin&&plugin.mcsdk||r?plugin.mcsdk.getAppConfigNamespace(function(n){e(n)}):e(null)}).then(function(s){var u;null===s||null===s.result?t():(u=e,new Promise(function(e,n){if(u)e(u);else{var t={};o.querySoupRecsPromise("appSoup").then(function(n){n.forEach(function(e){void 0===t[e.Name]&&(t[e.Name]=e)}),e(t)})}})).then(function(e){var o=function(e,n){if(n.status){var o=[],r="string"==typeof e?JSON.parse(e):e;if(r.dvUpgradeReq)t(r);else{for(var i in r)if(null!==r[i])if("translations"==i){var a=JSON.parse(r[i].replace(/(\r\n|\n|\r|\t)/gm,""));for(var s in a)null!==a[s]&&o.push({Name:"translations-"+s,CurrentValue:a[s]})}else if("string"==typeof r[i]){var u="version"===i?"appConfigVersion":i;o.push({Name:u,CurrentValue:r[i].replace(/(\r\n|\n|\r|\t)/gm,"")})}else o.push({Name:i,CurrentValue:JSON.stringify(r[i])});o.reduce(function(e,n){return e.then(function(e){return c(n.Name,n.CurrentValue)})},Promise.resolve()).then(function(e){t(e)}).catch(function(e){})}}else"exception"===n.type&&t()};if(window[mobileCaddy.CONTAINER_VSN_KEY]&&window[mobileCaddy.CONTAINER_VSN_KEY].startsWith("3")){var u=e.appConfigVersion?e.appConfigVersion.CurrentValue:"";(function(e){return new Promise(function(n,t){e&&plugin.mcsdk.getGetAppConfigData?plugin.mcsdk.getGetAppConfigData(function(e){n(e.result)},function(e){n(null)}):n(null)})})(n).then(function(n){if(n){o(n,{status:200})}else plugin.mcsdk.request({method:"POST",path:"/services/apexrest/"+s.result+"/getAppConfig001",contentType:"application/json",data:{params:JSON.stringify({currentAppConfigVersion:u,buildVersion:e.buildVersion.CurrentValue,buildName:e.buildName.CurrentValue,dynamicVersion:e.dynVersionNumber.CurrentValue,clientBundleVersion:window.clientBundleVersion,containerBaseBuildVersionw:window[mobileCaddy.CONTAINER_VSN_KEY]})}},function(e){o(e,{status:200})},function(e){t()})}).catch(function(e){logger.error("ERROR maybeGetPlatformAppConfigFromContainer",e),a(e)})}else if(r&&!i){Visualforce.remoting.Manager.invokeAction("GetAppConfiguration001.getAppConfig",e.buildVersion.CurrentValue,e.buildName.CurrentValue,o,{escape:!1,timeout:3e4})}else{var d=e.appConfigVersion?e.appConfigVersion.CurrentValue:"";if(!0!==i)return fetch("/services/apexrest/"+s.result+"/getAppConfig001",{method:"POST",mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.accessToken.CurrentValue},body:JSON.stringify({params:JSON.stringify({currentAppConfigVersion:d,buildVersion:e.buildVersion.CurrentValue,buildName:e.buildName.CurrentValue,dynamicVersion:e.dynVersionNumber.CurrentValue,clientBundleVersion:window.clientBundleVersion})})}).then(function(e){return 200===e.status?e.json():Promise.reject(e)}).then(function(e){o(e,{status:"200"})}).catch(function(e){a(e)});force.request({method:"POST",path:"/services/apexrest/"+s.result+"/getAppConfig001",contentType:"application/json",data:{params:JSON.stringify({currentAppConfigVersion:d,buildVersion:e.buildVersion.CurrentValue,buildName:e.buildName.CurrentValue,dynamicVersion:e.dynVersionNumber.CurrentValue,clientBundleVersion:window.clientBundleVersion})}},function(e){var n={status:"200"};o(e,n)},function(e){t()})}})})})}t.exports={getPlatformAppConfig:function(e){return u()},getCurrentValueFromAppSoup:function(e){return a(e)},getCachedCurrentValueFromAppSoup:function(e){return function(e){var n=localStorage.getItem("appSoup-"+e);return new Promise(function(t,o){n?t(n):a(e).then(function(n){localStorage.setItem("appSoup-"+e,n),t(n)})})}(e)},updateNewValueInAppSoup:function(e,n){return function(e,n){return s(e,n,"NewValue",!1)}(e,n)},upsertNewValueInAppSoup:function(e,n){return function(e,n){return s(e,n,"NewValue",!0)}(e,n)},updateCurrentValueInAppSoup:function(e,n){return function(e,n){return s(e,n,"CurrentValue",!1)}(e,n)},upsertCurrentValueInAppSoup:function(e,n){return c(e,n)}}}),n("mobileCaddy/syncRefresh",function(e,n,t){var o=e("mobileCaddy/appDataUtils"),r=e("mobileCaddy/smartStoreUtils"),i=e("mobileCaddy/logger"),a=(cordova.require("com.salesforce.plugin.smartstore"),e("mobileCaddy/geoLocation")),s=(window.LOCAL_DEV,!!window.USE_FORCETK),c=98;n.SYNC_ALREADY_IN_PROGRESS_INC=c;var u=100400;n.SYNC=u;var d=u,l=100402;n.SYNC_NOK_STATUS=l;var f="006";n.CSINHEAD_SYNC_VSN=f;var p="mc_failure_tab_";function m(){return!(!window[mobileCaddy.CONTAINER_VSN_KEY]||!window[mobileCaddy.CONTAINER_VSN_KEY].startsWith("3"))}function S(e,n,t,o,a,s){s&&s({status:0,table:e}),n=void 0===n||n;t||(t=0),o||(o=50),a||(a=!1);var f=function(e,n,o){var r={};w(e,t,!0,1,1,null,function(e){e.status==g?(r.status=u,n(r)):(r.status=e.status,r.mc_add_status=e.mc_add_status,e.sessNum&&(r.sessNum=e.sessNum),n(r))},o)},p=function e(n,i,a){var s={};r.queryMobileTable("recsToSync","Mobile_Table_Name",n,function(r){if(r.length>0)try{D(n,o,function(o){o.status==P&&void 0===o.mc_add_status?(t=0,s.status=0,i(s)):o.status==P&&"more-to-sync"===o.mc_add_status?e(n,i,a):(s.status=o.status,s.mc_add_status=o.mc_add_status,i(s))},a)}catch(e){}else s.status=2,s.mc_add_status="no-sync-no-updates",i(s)},a)},m=function(e,n,t,o,r){var s={};localStorage.removeItem("mcM2pMoreToSync"),"Dynamic (Submit First/Retain)"==n||"Dynamic (Submit First/Clear)"==n?p(e,function(n){!a&&(0===n.status||t&&2==n.status)?f(e,o,r):a&&0===n.status||2==n.status?(s.status=u,s.mc_add_status=n.mc_add_status,o(s)):(s.status=l,s.mc_add_status=n.mc_add_status,o(s))},r):"Submit Only"==n||"Submit & Clear"==n||"Submit & Destroy"==n?p(e,function(e){0===e.status?(s.status=u,o(s)):(s.status=l,s.mc_add_status=e.mc_add_status,o(s))},r):i.errorAndDispatch("Unknown sync type",n,a)};return new Promise(function(t,o){var a={},p=function(n){localStorage.removeItem("syncInProgressTime"),s&&(n.table=e,s(n)),t(n)},_=function(n){localStorage.removeItem("syncInProgressTime"),s&&s({table:e,status:-1}),o(n)},S="syncTime"+e,h=localStorage.getItem(S),y=(new Date).valueOf(),g=h?parseInt(h)+5e3:0;"Connection_Session__mc"!=e&&y<g?(a.status=u,a.mc_add_status="sync-too-soon",t(a)):(localStorage.setItem(S,y),localStorage.removeItem("tmpFailedRecordsAccum"),k(function(s){if(s.status==V||s.status==L||s.status==F){var S=localStorage.getItem("syncInProgressTime"),h=(new Date).valueOf();"Connection_Session__mc"!=e&&S&&S>h-12e4?(a.status=u+c,_(a)):(localStorage.setItem("syncInProgressTime",h),r.getTableDefnColumnValue(e,"Sync Type").then(function(r){B(function(s){"Mobile_Log__mc"!=e?null!==s&&void 0!==s?j(s,function(o){o.status==W?"Refresh Only"==r||"Refresh & Clear"==r?f(e,p,_):m(e,r,n,p,_):(a.status=d,a.mc_add_status=o.status,t(a))},function(e){i.errorAndDispatch(e),o(e)}):"Refresh Only"==r||"Refresh & Clear"==r?f(e,p,_):m(e,r,n,p,_):m(e,r,!1,p,_)},_)}).catch(function(e){_(e)}))}else a.status=l,a.mc_add_status=s.status,t(a),100101==a.mc_add_status||100102==a.mc_add_status?i.error(a):i.log(a)},_))})}function h(e){return new Promise(function(n,t){var o=function(e){t(e)},a=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),s={},c={},u={},d=e.mt,l=a.buildExactQuerySpec("Mobile_Table_Name",d,mobileCaddy.QUERY_BUFFER_SIZE);r.querySoupRecordsWithQuerySpec("recsToSync",l,function(t){t.forEach(function(e){if("Insert"==e.CRUD_Operation||"InsertUpdate"==e.CRUD_Operation)c[e.Id]=1;else{if("Update"!=e.CRUD_Operation&&"UpdateUpdate"!=e.CRUD_Operation)return void i.error("RTS contains record with non support CRUD Operation"+e);u[e.Id]=1}}),r.getProxyFieldName(d).then(function(i){var l=[],f=[];(e.records.forEach(function(e){var n=!0;null!==e.recordData.MC_Proxy_ID__c&&c.hasOwnProperty(e.recordData[i])&&(n=!1),n&&u.hasOwnProperty(e.recordData.Id)&&(n=!1),n&&l.push(e.recordData)}),e.ds)&&e.ds.oq.concat(e.ds.sd.concat(e.ds.hd.concat(e.ds.sh))).forEach(function(e){u.hasOwnProperty(e)||f.push(e)});var p=a.buildExactQuerySpec("Mobile_Table_Name",d,mobileCaddy.QUERY_BUFFER_SIZE);r.querySoupRecordsWithQuerySpec("recsToSync",p,function(i){i.length==t.length?r.deleteRecordsForExternalId2(d,f,"Id",function(){a.upsertSoupEntriesWithExternalId(d,l,"Id",function(){a.soupExists("SnapShot_"+d,function(t){t?r.deleteRecordsForExternalId2("SnapShot_"+d,f,"Id",function(){a.upsertSoupEntriesWithExternalId("SnapShot_"+d,l,"Id",function(){se(e),y(e.platAuthUrl),s.status=0,s.cs=e.cs,s.cp=e.cp,s.lastRefreshDatetime=e.lastRefreshDatetime,n(s)},o)},o):(se(e),y(e.platAuthUrl),s.status=0,s.lastRefreshDatetime=e.lastRefreshDatetime,s.cs=e.cs,s.cp=e.cp,n(s))},o)},o)},o):(s.status=0,s.mc_add_status=1,s.cs=e.cs,s.cp=e.cp,s.lastRefreshDatetime=e.lastRefreshDatetime,n(s))},o)})},o)})}function y(e){e||(e=""),o.updateCurrentValueInAppSoup("platAuthUrl",e).catch(function(n){i.error("setPlatAuthUrl",e,n)})}var g=100500;n.P2M_REFRESH_OK=g;var v=100402;function w(e,n,t,a,c,u,d,l){var p,_,S,y,C=function(o,s){if(s.status){var p,m,S=new RegExp("\n","g");o=o.replace(S,"\\n"),S=new RegExp("\r","g"),o=o.replace(S,""),h(m=JSON.parse(o)).then(function(n){return p=n,r.setTableDefnColumnValue(e,"Last Refresh Date/Time",p.lastRefreshDatetime)}).then(function(){var n="P2M RE Records Processed";return"Connection_Session__mc"==e&&(n="P2M Conn_Sess Records Processed"),1==p.mc_add_status&&(n="P2M RE Abandoned"),y.connSessionRec.mobilecaddy1__Mobile_Process_Status__c=n,y.connSessionRec.Id=p.cs,te(y.connSessionRec)}).then(function(){return oe(m.csM2P)}).then(function(){t&&_<f?ne(y.connSessionRec,function(){m["Session Number"]&&m["Session Number"]<m["Total Sessions"]?w(e,n,t,m["Session Number"]+1,m["Total Sessions"],m.CsPId,d,l):m.moreBatches?w(e,n,t,"newBatch",1,null,d,l):(b.status=g,d(b))},l):m["Session Number"]&&m["Session Number"]<m["Total Sessions"]?w(e,n,t,m["Session Number"]+1,m["Total Sessions"],m.CsPId,d,l):m.moreBatches?w(e,n,t,"newBatch",1,null,d,l):(b.status=g,d(b))}).catch(function(e){l(e)})}else"exception"===s.type&&i.error("p2mRefresh",e,s.message,s.where),$(s,y,function(e){b.status=v,b.mc_add_status=e.mc_add_status,a>1&&(b.csPId=u,b.sessNum=a,b.totalSess=c),d(b)},l)},b={},R="newBatch"==a;R&&(a=1);try{r.getTableDefnColumnValue(e,"Last Refresh Date/Time").then(function(e){(S=e)&&"null"!=S||(S=0);var r=new Date;return S<r-n||a>1||R||!t?o.getCachedCurrentValueFromAppSoup("audId"):(b.status=100402,b.status=100497,d(b),Promise.reject(b))}).then(function(e){return p=e,o.getCachedCurrentValueFromAppSoup("syncRefreshVersion")}).then(function(e){return I(_=e,"Sync - Refresh","P2M RE Process Called",a,c,u)}).then(function(e){if(y=e,!t){var n=JSON.parse(y.connSessJson);n.initialSync=!0,y.connSessJson=JSON.stringify(n)}if(R){var o=JSON.parse(y.connSessJson);o.firstBatch=!1,y.connSessJson=JSON.stringify(o)}return E(_,t)}).then(function(n){n&&(y.connSessJson=JSON.parse(y.connSessJson),y.connSessJson.csM2P=n,y.connSessJson=JSON.stringify(y.connSessJson)),m()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/p2mRefreshTable001",contentType:"application/json",data:{audId:p,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:_,mobileTableName:e,deviceRefreshIds:[],lastRefreshDateTime:S,thirdPartyJson:"",connSessJson:y.connSessJson}},function(e){var n={status:e.status};C(JSON.parse(e.data),n)},function(e){d("[]",{status:"OK"}),C({type:"exception"},{status:null})}):!0===s?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/p2mRefreshTable001",contentType:"application/json",data:{audId:p,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:_,mobileTableName:e,deviceRefreshIds:[],lastRefreshDateTime:S,thirdPartyJson:"",connSessJson:y.connSessJson}},function(e,n){void 0===n&&((n={}).status="200"),C(e,n)},l):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".p2mRefreshTable",p,_,e,[],S,"",y.connSessJson,C,{buffer:!1,escape:!1,timeout:12e4})}).catch(function(e){100497==e.status?d(e):(i.error(e),l(e))})}catch(e){i.errorAndDispatch(e)}}function C(e,n,t){return new Promise(function(r,i){o.getCachedCurrentValueFromAppSoup("audId").then(function(o){r("PROXY%"+e+"%"+t+"%"+n+"%"+o)}).catch(function(e){i(e)})})}function b(e,n,t,o){var r;if("Throw Exception"==o)throw i.errorAndDispatch("nullHandler - NULL value found",e,n,t.Id),"NULL value found for field "+n+" in Mobile Table "+e+" with Id = "+t.Id;return"Return NULL"==o?r=null:"Return Empty String"==o&&(r=""),r}function E(e,n){return new Promise(function(t,o){if(e<f||!n)t();else{var a,s=[];r.queryMobileTable("recsToSync","Mobile_Table_Name","Connection_Session__mc").then(function(e){return(a=e).length>0?r.querySoupRecsPromise("Connection_Session__mc"):Promise.resolve([])}).then(function(e){a.forEach(function(n){for(var t,o=0;o<e.length;++o)if(e[o].Id===n.Id&&e[o].Id.length<20){t=e[o];break}t&&s.push({Id:n.Id,t:function(e){switch(e){case"Sync - Refresh":return 1;case"Sync - Update":return 2;case"Status Check":return 3;default:return i.error("Unkown Session_Type__c",e),0}}(t.mobilecaddy1__Session_Type__c),s:function(e){switch(e){case"P2M RE Records Processed":return 1;case"P2M Conn_Sess Records Processed":return 2;case"P2M RE Abandoned":return 3;case"P2M RE Exception/Timeout":return 4;case"P2M RE Heartbeat Exception/Timeout":return 5;case"P2M RE Failure":return 6;case"P2M RE Hearbeat Failure":return 7;case"M2P Conn_Sess Records Processed":return 8;case"M2P Records Processed":return 9;case"M2P UP Failed - RTS Cleared":return 10;case"M2P SC - Status Check Processed":return 11;case"M2P SC Failure":return 12;case"M2P SC Exception/Timeout":return 13;case"M2P SC Heartbeat Exception/Timeout":return 14;case"M2P SC Heartbeat Failure":return 15;case"M2P UP Received - Records Processed":return 16;case"P2M InitialSync Faliure":return 17;default:return i.error("Unknown CS status",e),0}}(t.mobilecaddy1__Mobile_Process_Status__c)})}),t(s)}).catch(function(e){i.error(e),t(null)})}})}function R(e,n,t,o,r,a,s,c,u,d,l){var f={MobileTable:e,connSessProxyId:d,records:[]};s.forEach(function(o){for(var s,d=0;d<c.length;++d)if(c[d].Id===o.Id){s=c[d];break}if(s){var l={RTSRowNum:o._soupEntryId,RecordCRUD:function(e){switch(e){case"Insert":return"I";case"InsertDelete":return"T";case"Update":return"U";case"UpdatetDelete":return"Q";case"Delete":return"D";default:return null}}(o.CRUD_Operation),fields:[]};switch(l.RecordCRUD){case"I":case"T":l=function(e,n,t,o,r,i,a,s){for(var c in s){var u={name:c};if("mobilecaddy1__Error_Text__c"==c)u.value=JSON.stringify(s[c]),e.fields.push(u);else if("_soupEntryId"!=c&&"_soupLastModifiedDate"!=c){var d,l={};l[o]=c;var f=_.findWhere(t,l);if(null===s[c]){var p=f[i];d=b(n,c,s,p)}else if(d=s[c],f){var m=f[a];"M2P UP Unquoted"!=m||"true"!=d&&"false"!=d||(d="true"==d)}u.value=d,e.fields.push(u)}}return e}(l,e,n,t,0,r,a,s),f.records.push(l);break;case"D":case"U":case"Q":for(var p,m=0;m<u.length;++m)if(u[m].Id===o.Id){p=u[m];break}p?(l=function(e,n,t,o,r,i,a,s,c){var u=!1;for(var d in s)if("_soupEntryId"!=d&&"_soupLastModifiedDate"!=d){var l={name:d};if(s[d]!=c[d]||"SystemModstamp"==d){var f,p;u=!0;var m=null,S=null,h={};h[o]=d;var y=_.findWhere(t,h);null===s[d]?(m=y[i],f=b(n,d,s,m)):(f=s[d],y&&("M2P UP Unquoted"!=(S=y[a])||"true"!=f&&"false"!=f||(f="true"==f))),null===c[d]&&y?(m||(m=y[i]),p=b(n,d,c,m)):(p=c[d],y&&(S||(S=y[a]),"M2P UP Unquoted"!=S||"true"!=p&&"false"!=p||(p="true"==p))),l.previousValue=p,l.value=f,e.fields.push(l)}}return u?(e.fields.push({name:"Id",previousValue:c.Id,value:c.Id}),e):[]}(l,e,n,t,0,r,a,s,p),f.records.push(l)):i.errorAndDispatch("createUpdateJson Missing snapShot",e,s.Id);break;default:i.errorAndDispatch("createUpdateJson unknown CRUD",e,o.Id,o.CRUD_Operation)}}else i.errorAndDispatch("createUpdateJson Missing primary",e,o.Id)}),l(JSON.stringify(f))}function T(e,n,t,o,i){var a=[];n.forEach(function(e){var n={};t.forEach(function(t){if(e.Id==t.Id&&"Insert"==e.CRUD_Operation)for(var o in t)"_soupEntryId"!=o&&"_soupLastModifiedDate"!=o&&(n[o]=t[o])}),_.isEmpty(n)||a.push(n)}),0===a.length?o():r.getProxyFieldName(e).then(function(n){(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntriesWithExternalId("SnapShot_"+e,a,n,o,i)})}function I(e,n,t,s,c,u){return new Promise(function(e,d){var l={};a.getLocation(function(a){var f={mobilecaddy1__Session_Type__c:n,mobilecaddy1__Mobile_Process_Status__c:t,SystemModstamp:(new Date).getTime()},p=a.ErrorNumber;0!==p?f.mobilecaddy1__Session_Created_Location_Error__c=a.Error:(f.Session_Created_Location__Longitude__s=a.Latitude,f.Session_Created_Location__Latitude__s=a.Longitude),function(e,n,t,o){var i={},a=new Date,s=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");r.getProxyFieldName(e).then(function(r){s.upsertSoupEntries(e,[n],function(n){var c=n[0];C(e,c._soupEntryId,a.getTime()).then(function(n){c.Id=n,c[r]=n,s.upsertSoupEntries(e,[c],function(e){i.status=0,i.proxyId=n,i.insertedRecord=e[0],t(i)},o)}).catch(function(e){o(e)})},o)}).catch(function(e){o(e)})}("Connection_Session__mc",f,function(n){var t=new Date,r={"Sync Session Proxy ID":null,"Total Sessions":c,"Session Number":s,"Device Call Date/Time":t.getTime(),"Connection Session Proxy ID":n.proxyId};u&&(r.CsPId=u),0!==p?r.ErrorNumber=p:(r["Location Long"]=a.Longitude,r["Location Lat"]=a.Latitude),l.status=0,l.connSessionRec=n.insertedRecord,l.connSessProxyId=n.proxyId;var d={version:"NULL"};window.device&&(d=window.device),o.getCurrentValueFromAppSoup("containerVersion").then(function(n){r.containerVsn=n,r.OSVsn=d.version,l.connSessJson=JSON.stringify(r),e(l)}).catch(function(n){i.error("buildConnectionSession - Could not get containerVsn",n),r.OSVsn=d.version,l.connSessJson=JSON.stringify(r),e(l)})},function(e){d(e)})},function(e){d(e)})})}function N(e){return new Promise(function(n,t){var a={},c=function(e){n(e)},u=function(e){t(e)},d=(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).buildExactQuerySpec("Mobile_Table_Name",e,mobileCaddy.QUERY_BUFFER_SIZE);r.querySoupRecordsWithQuerySpec("recsToSync",d,function(n){if(0!==n.length){var t=!1;"Connection_Session__mc"!=e&&n.length>3e4&&(t=!0);var d=[];d=t?(d=_.sortBy(n,"_soupLastModifiedDate")).slice(0,3e4):n,r.querySoupRecords(e,function(n){r.querySoupRecords("SnapShot_"+e,function(t){r.getSysDataRowMapColHeadings("Row Mapping TC",["Parent SOUP Name","Table Column Name","M2P Update Converter DEVICE","M2P Update NULL Handler DEVICE","M2P Update Formatter DEVICE"],function(l){var f=l[0],p=l[1],S=(l[2],l[3]),h=l[4];r.queryMobileTableWithAnd("syncLib_system_data","MC_Var_String_001","Platform Table Column",f,e,function(l){var f=[];_.each(d,function(e){var t;t=e.Id,_.find(n,function(e){return e.Id==t})&&f.push(e)}),_.isEmpty(f)?r.setTableDefnColumnValue(e,"Last Sync Date/Time",(new Date).getTime()).then(function(){a.status=P,a.mc_add_status=O,c(a)}).catch(function(e){i.error(e)}):R(e,l,p,0,S,h,f,n,t,"",function(t){var r;o.getCachedCurrentValueFromAppSoup("audId").then(function(e){return r=e,o.getCachedCurrentValueFromAppSoup("syncRefreshVersion")}).then(function(o){T(e,d,n,function(){var n=function(e,n){a.result=e,a.event=n,c(a)};t=t.replace(/: undefined/g,': "undefined"'),m()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pUpdateTable001",contentType:"application/json",data:{audId:r,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:o,mobileTableName:e,jsonRecords:t,connSessJson:"{}"}},function(e,t){void 0===t&&((t={}).status="200"),n(JSON.parse(e.data),t)},u):!0===s?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pUpdateTable001",contentType:"application/json",data:{audId:r,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:o,mobileTableName:e,jsonRecords:t,connSessJson:"{}"}},function(e,t){void 0===t&&((t={}).status="200"),n(e,t)},u):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".m2pUpdateTable",r,o,e,t,JSON.stringify({"Session Number":1,"Location Long":10,"Location Lat":10,"Total Sessions":1,"Device Call Date/Time":(new Date).getTime(),"Connection Session Proxy ID":"1",ErrorNumber:2}),n,{buffer:!1,escape:!1,timeout:3e4})},u)}).catch(function(e){u(e)})})},u)},u)},u)},u)}else r.setTableDefnColumnValue(e,"Last Sync Date/Time",(new Date).getTime()).then(function(){a.status=P,a.mc_add_status=O,c(a)}).catch(function(e){i.log("No recs to sync")})},u)})}var P=100300;n.M2P_UPDATE_OK=P;var O=100310;function D(e,n,t,a){var c,u,d={};try{o.getCachedCurrentValueFromAppSoup("syncRefreshVersion").then(function(e){u=e;var n=localStorage.getItem("mcM2pMoreToSync")?2:1;return I(0,"Sync - Update","M2P Process Called",n,n,null)}).then(function(e){return c=e,E(u,!0)}).then(function(l){l&&(c.connSessJson=JSON.parse(c.connSessJson),c.connSessJson.csM2P=l,c.connSessJson=JSON.stringify(c.connSessJson));var p=(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).buildExactQuerySpec("Mobile_Table_Name",e,mobileCaddy.QUERY_BUFFER_SIZE);r.querySoupRecordsWithQuerySpec("recsToSync",p,function(l){var p,S,h=(p=l,(S=JSON.parse(localStorage.getItem("tmpFailedRecordsAccum")))?p.filter(function(e){return!S[e.Id]}):p);if(0!==h.length){var y=!1;"Connection_Session__mc"!=e&&h.length>n?(y=!0,localStorage.setItem("mcM2pMoreToSync","true")):localStorage.removeItem("mcM2pMoreToSync");(function(e,n,t,o){e.forEach(function(e){e.Current_Connection_Session=n}),(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntriesWithExternalId("recsToSync",e,"Id",t,o)})(y?_.sortBy(h,"_soupLastModifiedDate").slice(0,n):h,c.connSessProxyId,function(n){r.querySoupRecords(e,function(l){r.querySoupRecords("SnapShot_"+e,function(p){r.getSysDataRowMapColHeadings("Row Mapping TC",["Parent SOUP Name","Table Column Name","M2P Update Converter DEVICE","M2P Update NULL Handler DEVICE","M2P Update Formatter DEVICE"],function(_){var S=_[0],h=_[1],g=(_[2],_[3]),v=_[4];r.queryMobileTableWithAnd("syncLib_system_data","MC_Var_String_001","Platform Table Column",S,e,function(r){R(e,r,h,0,g,v,n,l,p,c.connSessProxyId,function(r){var p;o.getCachedCurrentValueFromAppSoup("audId").then(function(o){p=o,T(e,n,l,function(){var n=function(n,o){var s;o.status?(n=n.replace(/,}/g,"}"),H(s=JSON.parse(n),r,function(n){c.connSessionRec.mobilecaddy1__Mobile_Process_Status__c="Connection_Session__mc"==e?"M2P Conn_Sess Records Processed":"M2P Records Processed",c.connSessionRec.Id=n.csId,te(c.connSessionRec).then(function(){return oe(s.csM2P)}).then(function(){y?(d.status=P,d.mc_add_status="more-to-sync",t(d)):u<f?ne(c.connSessionRec,function(){d.status=P,t(d)},a):(d.status=P,t(d))}).catch(function(e){a(e)})},a)):"exception"===o.type?(d.status=P,d.mc_add_status=A,t(d),i.error("m2pUpdate",e,o.message,o.where)):(d.status=P,d.mc_add_status=U,t(d),i.error("m2pUpdate",e,o.message,o.where))};r=r.replace(/: undefined/g,': "undefined"'),m()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pUpdateTable001",contentType:"application/json",data:{audId:p,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:u,mobileTableName:e,jsonRecords:r,connSessJson:"{}"}},function(e,t){void 0===t&&((t={}).status="200"),n(JSON.parse(e.data),t)},a):!0===s?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pUpdateTable001",contentType:"application/json",data:{audId:p,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN,syncRefreshDataVersion:u,mobileTableName:e,jsonRecords:r,connSessJson:c.connSessJson}},function(e,t){void 0===t&&((t={}).status="200"),n(e,t)},a):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".m2pUpdateTable",p,u,e,r,c.connSessJson,n,{buffer:!1,escape:!1,timeout:3e4})},a)}).catch(function(e){a(e)})})},a)},a)},a)},a)},a)}else r.setTableDefnColumnValue(e,"Last Sync Date/Time",(new Date).getTime()).then(function(){d.status=P,d.mc_add_status=O,t(d)}).catch(function(e){a(e)})},a)},a)}catch(e){i.errorAndDispatch(e)}}n.M2P_NO_RECS_TO_SYNC=O;var V=100100;n.HEARTBEAT_OK=V;var A=100101;n.HEARTBEAT_EXCEPTION=A;var U=100102;n.HEARTBEAT_FAILURE=U;var M=100103;n.HEARTBEAT_NO_CONNECTION=M;var L=100104;n.HEARTBEAT_NOT_DEVICE=L;var F=100105;function k(e,n){var t={},o=navigator.appVersion.includes("Electron");o||navigator&&navigator.connection&&"undefined"!=typeof Connection?o||navigator.connection.type!=Connection.NONE?m()?function(e,n){var t={};plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/heartBeat001",contentType:"application/json",data:{startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN}},function(n){n.status?(t.status=V,e(t)):(t.status=U,e(t))},function(n){401===n.status?J(function(n){t.status=F,e(t)},function(n){t.status=A,e(t)}):(i.error("sendSDKHeartBeat ERR",n),t.status=U,e(t))})}(e):"undefined"==typeof Visualforce?(i.log("Visualforce not currently defined"),new Promise(function(e,n){var t=window.location.pathname,o=new XMLHttpRequest;o.open("GET",t,!0),o.send(),o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE&&200==o.status){i.log("Startpage re-fetched",t);var e=new RegExp('"(\\S+VFRemote.js)"'),r=e.exec(o.response);if(r&&r[0]){var a=r[1];s=a,c=function(){i.log("remote script fetched",a),i.log("set up Visualforce ref")},u=document.createElement("script"),d=document.getElementsByTagName("script")[0],u.async=1,u.onload=u.onreadystatechange=function(e,n){(n||!u.readyState||/loaded|complete/.test(u.readyState))&&(u.onload=u.onreadystatechange=null,u=void 0,n||c&&c())},u.src=s,d.parentNode.insertBefore(u,d)}else n("Could not find VFRemote.js mention in "+t)}else o.readyState==XMLHttpRequest.DONE&&n(o.status);var s,c,u,d}}).then(function(t){x(e,n)}).catch(function(n){i.errorAndDispatch("Startpage Load Error: "+window.location.pathname,n),t.status=U,e(t)})):x(e,n):(t.status=M,e(t)):(localStorage.connection?t.status=localStorage.connection:t.status=L,e(t))}function x(e,n){var t={};Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".heartBeat",function(n,o){o.status?(t.status=V,e(t)):"exception"===o.type?q(function(n){t.status=F,e(t)},function(n){t.status=A,e(t)}):(t.status=U,e(t))},{escape:!1,timeout:3e4})}function q(e,n){m()?J(e,n):r.querySoupRecords("appSoup",function(t){var r={};t.forEach(function(e){r[e.Name]=e.CurrentValue}),function(e,n,t){arguments.length>3&&void 0!==arguments[3]&&arguments[3];!0;var r="grant_type=refresh_token&identity_url="+e.identityUrl+"&client_id="+e.clientId+"&refresh_token="+e.refreshToken+"&orgId="+e.orgId+"&audId="+e.audId+"&userId="+e.userId;var a=new XMLHttpRequest;a.open("POST","https://mobilecaddy.secure.force.com/apex/ProxyToken",!0);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.send(r);a.onreadystatechange=function(){if(a.readyState==XMLHttpRequest.DONE&&200==a.status){var e=JSON.parse(a.response);Visualforce.remoting.oauthAccessToken=e.access_token,Visualforce.remoting.last.refresh(function(){o.updateCurrentValueInAppSoup("accessToken",e.access_token).then(function(){n(e.access_token)}).catch(function(e){t(e)})},function(e){i.error("in VF last refresh error"),t(e)})}else a.readyState==XMLHttpRequest.DONE&&i.error("refreshTokenRequest error.",a.status)}}(r,e,n)},function(e){n(e)})}function J(e,n){plugin.mcsdk.refreshAccessToken(function(t){t.result?o.updateCurrentValueInAppSoup("accessToken",t.result).then(function(){e(t.result)}).catch(function(e){i.error("mcsdkRefreshToken updateCurrentValueInAppSoup ERROR",e),n(e)}):(i.error("mcsdkRefreshToken ERROR",t),n(t))},function(e){i.error("mcsdkRefreshToken ERROR",e),n(e)})}function B(e,n){r.querySoupRecords("recsToSync",function(t){for(var o=null,r=null,i=0;i<t.length;i++)if(null!==t[i].Current_Connection_Session&&void 0!==t[i].Current_Connection_Session){o=t[i].Current_Connection_Session,r=t[i];break}if(null!==o&&void 0!==o){var a=(new Date).getTime(),s=r._soupLastModifiedDate+3e4;if(a>s)e(o);else{var c={status:100498};n(c)}}else e(o)},n)}n.HEARTBEAT_REFRESHED_OK=F;var W=100200;n.CONN_SESS_OK=W;var K=100201;function j(e,n,t){try{var a;o.getCachedCurrentValueFromAppSoup("syncRefreshVersion").then(function(e){return a=e,I(0,"Status Check","M2P SC Status Check Requested",1,1,null)}).then(function(c){k(function(u){var d;u.status==V||u.status==L||u.status==F?o.getCachedCurrentValueFromAppSoup("audId").then(function(o){d=o;var u=function(o,a){var s;a.status?((s=JSON.parse(o)).cs_fc_jr&&(s.cs_fc_jr=JSON.parse(s.cs_fc_jr)),"Received Processed"==s.cs_fc_sc?function(e,n,t,o){try{H(n.cs_fc_jr,function(i){e.connSessionRec.mobilecaddy1__Mobile_Process_Status__c="M2P SC - Status Check Processed",e.connSessionRec.SystemModstamp=(new Date).getTime(),e.connSessionRec.mobilecaddy1__Status__c="Closed",e.connSessionRec.Id=n.cs_sc_sf,r.queryMobileTable("Connection_Session__mc","Id",n.cs_fc_jr.cp).then(function(t){if(t[0]){var o=t[0];return o.Id=n.cs_fc_jr.csId,o.SystemModstamp=(new Date).getTime(),o.mobilecaddy1__Mobile_Process_Status__c="M2P Records Processed",te([e.connSessionRec,o])}return Promise.resolve()}).then(function(){t({status:W})}).catch(function(e){o(e)})},o)}catch(e){i.errorAndDispatch("processM2PUpdateResponse",e),o("processM2PUpdateResponse-error")}}(c,s,n,t):function(e,n,t){r.queryMobileTable("recsToSync","Current_Connection_Session",e,function(e){if(0!==e.length){for(var o=0;o<e.length;o++)e[o].Current_Connection_Session=null,"InsertUpdate"==e[o].CRUD_Operation?e[o].CRUD_Operation="Insert":"UpdateUpdate"==e[o].CRUD_Operation&&(e[o].CRUD_Operation="Update");var r=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");r.upsertSoupEntries("recsToSync",e,n,t)}else n()},t)}(e,function(){r.queryMobileTable("Connection_Session__mc","mobilecaddy1__MC_Proxy_ID__c",e,function(e){if(e.length>0){var o=e[0];"Received Not Processed"==s.cs_fc_sc?function(e,n,t,o,r){e.mobilecaddy1__Mobile_Process_Status__c="M2P UP Failed - RTS Cleared",e.mobilecaddy1__Session_Type__c="Sync Update",e.mobilecaddy1__Status__c="Closed",e.SystemModstamp=(new Date).getTime(),e.Id=t.cs_fc_sf,te(e).then(function(){n.connSessionRec.mobilecaddy1__Mobile_Process_Status__c="M2P SC - Status Check Processed",n.connSessionRec.SystemModstamp=(new Date).getTime(),n.connSessionRec.mobilecaddy1__Status__c="Closed",n.connSessionRec.Id=t.cs_sc_sf,te(n.connSessionRec)}).catch(function(e){r(e)})}(o,c,s,0,t):function(e,n,t,o,i){r.deleteRecordsFromSoup([e],"Connection_Session__mc",function(e){n.connSessionRec.mobilecaddy1__Mobile_Process_Status__c="M2P SC - Status Check Processed",n.connSessionRec.SystemModstamp=(new Date).getTime(),n.connSessionRec.mobilecaddy1__Status__c="Closed",n.connSessionRec.Id=t.cs_sc_sf,n.connSessionRec.mobilecaddy1__Session_Type__c="Status Check",te(n.connSessionRec).then(function(){o({status:W})}).catch(function(e){i(e)})},i)}(o,c,s,n,t)}else n({status:W})},t)},t)):(i.error("csStatusCheck",a.message),n({status:K}))},l=c.connSessJson,f=localStorage.getItem("lastErrorLog");f&&(localStorage.removeItem("lastErrorLog"),(l=JSON.parse(l)).lastErrorLog=f,l=JSON.stringify(l)),m()?plugin.mcsdk.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pCSStatusCheck001",contentType:"application/json",data:{audId:d,syncRefreshDataVersion:a,statusCheckCSProxyId:e,connSessJson:l,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN}},function(e,n){void 0===n&&((n={}).status="200"),u(JSON.parse(e.data),n)},function(e){i.error("err -> "+JSON.stringify(e)),t(e)}):!0===s?force.request({method:"POST",path:"/services/apexrest/mobilecaddy1/m2pCSStatusCheck001",contentType:"application/json",data:{audId:d,syncRefreshDataVersion:a,statusCheckCSProxyId:e,connSessJson:l,startPageControllerVersion:mobileCaddy.START_PAGE_CONTROLLER_VSN}},function(e,n){void 0===n&&((n={}).status="200"),u(e,n)},function(e){i.error("err -> "+JSON.stringify(e)),t(e)}):Visualforce.remoting.Manager.invokeAction("mobilecaddy1."+mobileCaddy.START_PAGE_CONTROLLER+".m2pCSStatusCheck",d,a,e,l,u,{buffer:!1,escape:!1,timeout:3e4})}).catch(function(e){t(e)}):ee(u,c,function(e){n({status:W,mc_add_status:e.mc_add_status})},t)},t)}).catch(function(e){t(e)})}catch(e){i.errorAndDispatch(e)}}function H(e,n,t,o){o||(o=t,t=n,n="{}");var a=1,s=e.mt,c=void 0!==e.is?e.is:[],u=void 0!==e.id?e.id:[],d=void 0!==e.us?e.us:[],l=void 0!==e.ifmf?e.ifmf:[],f=void 0!==e.ufmf?e.ufmf:[],p=[],m=[],S=[],h=[],y=[],g=[],v=[],w=[],C=[],b=[],E=[];if(c=c.concat(u),ae(s,e.af,c,d),void 0===e.if)b=[];else if(void 0===e.if.if)b=e.if;else{a=2;var R=e.if.if.map(function(n){return{pd:n,fbe:void 0!==e.ifbe?e.ifbe:"K"}}),T=e.if.ifv.map(function(n){return{pd:n,fbe:void 0!==e.ifvbe?e.ifvbe:"K"}}),I=e.if.icv.map(function(n){return{pd:n,fbe:void 0!==e.icvbe?e.icvbe:"K"}});b=R.concat(T.concat(I))}(function(e,n,t,o){return new Promise(function(i,a){e=JSON.parse(e);var s=t.concat(o),c=t;if(e.records&&e.records.length>n.length+s.length){var u=[];r.getProxyFieldName(e.MobileTable).then(function(o){e.records.forEach(function(e){if("I"==e.RecordCRUD){var t=e.fields.find(function(e){return e.name==o}).value;_.findWhere(n,{pd:t})||_.findWhere(s,{pd:t})||u.push({pd:t,fbe:"K"})}}),u.length>0&&(c=t.concat(u)),i(c)})}else i(c)})})(n,c,b,l).then(function(n){if(b=n,void 0===e.uf)E=[];else if(void 0===e.uf.uf)E=e.uf;else{a=2;var t=e.uf.uf.map(function(n){return{Id:n,fbe:void 0!==e.ufbe?e.ufbe:"K"}}),o=e.uf.usv.map(function(n){return{Id:n,fbe:void 0!==e.usvbe?e.usvbe:"K"}}),r=e.uf.sdf.map(function(n){return{Id:n,fbe:void 0!==e.sdfbe?e.sdfbe:"K"}}),i=e.uf.hdf.map(function(n){return{Id:n,fbe:void 0!==e.hdfbe?e.hdfbe:"K"}}),c=e.uf.ufv.map(function(n){return{Id:n,fbe:void 0!==e.ufvbe?e.ufvbe:"K"}}),u=e.uf.ucv.map(function(n){return{Id:n,fbe:void 0!==e.ucvbe?e.ucvbe:"K"}});E=t.concat(o.concat(r.concat(i.concat(c.concat(u)))))}return G("SnapShot_"+s)}).then(function(e){return C=e,G(s)}).then(function(n){r.queryMobileTable("recsToSync","Mobile_Table_Name",s,function(u){for(var _ in u)if(u[_].Current_Connection_Session==e.cp){var R=!1,T={},I={};switch(u[_].CRUD_Operation){case"Insert":case"InsertUpdate":for(var N in c)if(u[_].Id==c[N].pd){if(c[N].crud=u[_].CRUD_Operation,I=Q(c[N],n),"Insert"==u[_].CRUD_Operation){switch(e.stbe){case"D":v.push(I),w.push(c[N]);break;default:if("U"==c[N].pc){if(I.Id=c[N].Id,void 0!==c[N].an&&(void 0!==c[N].nf?I[c[N].nf]=c[N].an:I.Name=c[N].an),void 0!==c[N].lu)for(var P in c[N].lu)c[N].lu.hasOwnProperty(P),I[P]=c[N].lu[P];h.push(I),g.push(I)}}m.push(u[_]._soupEntryId)}else{if(I.Id=c[N].Id,void 0!==c[N].an&&(void 0!==c[N].nf?I[c[N].nf]=c[N].an:I.Name=c[N].an),void 0!==c[N].lu)for(var O in c[N].lu)c[N].lu.hasOwnProperty(O),I[O]=c[N].lu[O];h.push(I);var D=Q(c[N],C);D.Id=c[N].Id,g.push(D),(T=u[_]).Current_Connection_Session=null,T.CRUD_Operation="Update",T.Id=c[N].Id,p.push(T)}R=!0;break}if(!R)for(N in b)if(u[_].Id==b[N].pd){if(b[N].crud=u[_].CRUD_Operation,"Insert"==u[_].CRUD_Operation)switch("K",1==a?Y(0,b[N].fl,e):b[N].fbe){case"K":(T=u[_]).Current_Connection_Session=null,p.push(T);break;case"R":break;default:I=Q(b[N],n),v.push(I),m.push(u[_]._soupEntryId),w.push(b[N])}else"InsertUpdate"==u[_].CRUD_Operation&&((T=u[_]).Current_Connection_Session=null,T.CRUD_Operation="Insert",p.push(T));R=!0;break}if(!R)for(N in l)if(u[_].Id==l[N].pd){if(l[N].crud=u[_].CRUD_Operation,"Insert"==u[_].CRUD_Operation)switch(l[N].fbe){case"K":(T=u[_]).Current_Connection_Session=null,p.push(T);break;case"R":break;default:I=Q(l[N],n),v.push(I),m.push(u[_]._soupEntryId),w.push(l[N])}else"InsertUpdate"==u[_].CRUD_Operation&&((T=u[_]).Current_Connection_Session=null,T.CRUD_Operation="Insert",p.push(T));R=!0;break}break;case"Update":case"UpdateUpdate":for(N in d)if(u[_].Id==d[N].Id){if(d[N].crud=u[_].CRUD_Operation,"Update"==u[_].CRUD_Operation){switch(I=Q(d[N],n),e.stbe){case"D":v.push(I),w.push(d[N]);break;default:if("M"==d[N].pc&&(I.SystemModstamp=new Date(d[N].sm)),void 0!==d[N].lu)for(var V in d[N].lu)d[N].lu.hasOwnProperty(V)&&(I[V]=d[N].lu[V]);S.push(I),y.push(I)}m.push(u[_]._soupEntryId)}else"UpdateUpdate"==u[_].CRUD_Operation&&((T=u[_]).Current_Connection_Session=null,T.CRUD_Operation="Update",p.push(T));R=!0;break}if(!R)for(N in E)if(u[_].Id==E[N].Id){if("Update"==u[_].CRUD_Operation)switch("K",1==a?Y(1,E[N].fl,e):E[N].fbe){case"K":(T=u[_]).Current_Connection_Session=null,p.push(T);break;case"R":break;default:I=Q(E[N],n),v.push(I),m.push(u[_]._soupEntryId),w.push(E[N])}else"UpdateUpdate"==u[_].CRUD_Operation&&((T=u[_]).Current_Connection_Session=null,T.CRUD_Operation="Update",p.push(T));R=!0;break}if(!R)for(N in f)if(u[_].Id==f[N].Id){if(f[N].crud=u[_].CRUD_Operation,"Update"==u[_].CRUD_Operation)switch(f[N].fbe){case"K":(T=u[_]).Current_Connection_Session=null,p.push(T);break;case"R":break;default:I=Q(f[N],n),v.push(I),m.push(u[_]._soupEntryId),w.push(f[N])}else"UpdateUpdate"==u[_].CRUD_Operation&&((T=u[_]).Current_Connection_Session=null,T.CRUD_Operation="Update",p.push(T));R=!0;break}}}var A;r.getProxyFieldName(s).then(function(e){return A=e,Z(s,"Id",S)}).then(function(e){return Z(s,A,h)}).then(function(e){return Z("SnapShot_"+s,"Id",y)}).then(function(e){return Z("SnapShot_"+s,A,g)}).then(function(e){return X(s,v)}).then(function(e){return X("SnapShot_"+s,w)}).then(function(e){return n=p,new Promise(function(e,t){n.length>0?(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntries("recsToSync",n,function(n){e(n)},function(e){t(e)}):e("OK")});var n}).then(function(e){return n=m,new Promise(function(e,t){n.length>0?(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).removeFromSoup("recsToSync",n,function(n){e(n)},function(e){t(e)}):e("OK")});var n}).then(function(n){return se(e)}).then(function(){var n={status:0};n.csId=e.csId,t(n)}).catch(function(e){i.errorAndDispatch("m2pResp error for "+s,e),o(e)})},o)}).catch(function(e){i.errorAndDispatch("Err reading table",s),o(e)})}function Q(e,n){var t={};return"Insert"==e.crud||"InsertUpdate"==e.crud?t.Id=e.pd:t.Id=e.Id,_.findWhere(n,t)}function Y(e,n,t){switch(e){case 0:switch(n){case"DF":return t.ifbe;case"CV":return t.icvbe;case"FV":return t.ifvbe}break;case 1:switch(n){case"DF":return t.ufbe;case"SV":return t.usvbe;case"CV":return t.ucvbe;case"FV":return t.ufvbe;case"SD":return t.sdfbe;case"HD":return t.hdfbe}}}function G(e){return new Promise(function(n,t){r.querySoupRecords(e,function(e){n(e)},function(e){t(e)})})}function Z(e,n,t){return new Promise(function(o,r){t.length>0?(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntriesWithExternalId(e,t,n,function(e){o(e)},function(e){r(e)}):o("OK")})}function X(e,n){return new Promise(function(t,o){if(n.length>0)if(-1==e.indexOf("SnapShot"))r.deleteRecordsFromSoup(n,e,function(e){t(e)},function(e){o(e)});else{var a=n.filter(function(e){return e&&"Insert"==e.crud&&(e.Id=e.pd),null!==e&&void 0!==e});r.deleteRecordsForExternalId(e,a,"Id",function(e){t(e)},function(e){i.errorAndDispatch(e),o(e)})}else t("OK")})}var z=100600;function $(e,n,t,o){var r={bogus:!0};"exception"===e.type?r.status=A:r.status=U,ee(r,n,t,o)}function ee(e,n,t,o){var r={},a=null;(e.status==M?"Sync - Refresh"==n.connSessionRec.mobilecaddy1__Session_Type__c?a="P2M RE Heartbeat No Connection":"Status Check"==n.connSessionRec.mobilecaddy1__Session_Type__c&&(a="M2P SC Heartbeat No Connection"):e.status==A?"Sync - Refresh"==n.connSessionRec.mobilecaddy1__Session_Type__c?a=e.bogus?"P2M RE Exception/Timeout":"P2M RE Heartbeat Exception/Timeout":"Status Check"==n.connSessionRec.mobilecaddy1__Session_Type__c&&(a=e.bogus?"M2P SC Exception/Timeout":"M2P SC Heartbeat Exception/Timeout"):e.status==U&&("Sync - Refresh"==n.connSessionRec.mobilecaddy1__Session_Type__c?a=e.bogus?"P2M RE Failure":"P2M RE Hearbeat Failure":"Status Check"==n.connSessionRec.mobilecaddy1__Session_Type__c&&(a=e.bogus?"M2P SC Failure":"M2P SC Heartbeat Failure")),null!==a)?(n.connSessionRec.mobilecaddy1__Mobile_Process_Status__c=a,n.connSessionRec.SystemModstamp=(new Date).getTime(),n.connSessionRec.mobilecaddy1__Status__c="Closed",(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntries("Connection_Session__mc",[n.connSessionRec],function(){r.status=z,r.mc_add_status=e.status,t(r)},o)):(i.error("Unknown heartBeatObject.status. ",e.status),o())}function ne(e,n,t){var o={};r.querySoupRecsPromise("recsToSync").then(function(r){var a=_.filter(r,function(e){return void 0!==e.currentConnectionSession});a.length>1||"M2P Conn_Sess Records Processed"!=e.mobilecaddy1__Mobile_Process_Status__c?S("Connection_Session__mc").then(function(e){o.status=0,n(o)}).catch(function(e){i.warn("syncMobileTable ERROR -> ",e),t(e)}):(o.status=0,n(o))}).catch(function(e){i.error("querySoupRecsPromise ERROR -> ",e),t(e)})}function te(e){return new Promise(function(n,t){var o=function(e){i.error("postProcessConnectionSession error",e),t(e)},r=Array.isArray(e)?e:[e],a={},s=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");s.upsertSoupEntries("Connection_Session__mc",r,function(t){var i=Array.isArray(e);i=r.map(function(e){return{Id:e.Id,SystemModstamp:e.SystemModstamp-1,mobilecaddy1__Session_Type__c:null,mobilecaddy1__Mobile_Process_Status__c:null,mobilecaddy1__Session_Created_Location_Error__c:null,mobilecaddy1__MC_Proxy_ID__c:null}}),s.upsertSoupEntries("SnapShot_Connection_Session__mc",i,function(e){var t=e.map(function(e){return{Mobile_Table_Name:"Connection_Session__mc",CRUD_Operation:"Update",SOUP_Record_Id:e._soupEntryId,Id:e.Id,LastModifiedDateTime:e.SystemModstamp}});s.upsertSoupEntries("recsToSync",t,function(){a.status=0,n(a)},o)},o)},o)})}function oe(e){return new Promise(function(n,t){e&&e.us&&0!==e.us.length?r.deleteRecordsForExternalId("Connection_Session__mc",e.us,"Id").then(function(n){return r.deleteRecordsForExternalId("SnapShot_Connection_Session__mc",e.us,"Id")}).then(function(n){return r.deleteRecordsForExternalId("recsToSync",e.us,"Id")}).then(function(e){n()}).catch(function(e){i.error("handleUpdatedCS",e),n()}):n(),e&&e.uf&&0!==e.uf.length&&i.error("handleUpdatedCS -> we have uf",e.uf)})}function re(e){return e?localStorage.getItem(p+e)?JSON.parse(localStorage.getItem(p+e)):{}:(n=[],ie().forEach(function(e){var t=re(e.replace(p,""));_.isEmpty(t)||n.push({table:e.replace(p,""),failures:t})}),n);var n}function ie(){for(var e=[],n=0,t=localStorage.length;n<t;++n)localStorage.key(n).startsWith(p)&&e.push(localStorage.key(n));return e}function ae(e,n,t,o){var r={};if(localStorage.getItem("mcM2pMoreToSync")){if(localStorage.getItem(p+e)){localStorage.getItem(p+e);r=JSON.parse(localStorage.getItem(p+e)),t.forEach(function(e){delete r[e.pd]}),o.forEach(function(e){delete r[e.Id]})}}else localStorage.removeItem(p+e),r={};if(n){var i={};n.forEach(function(e){i[e.Id]=e,r[e.Id]=e}),localStorage.setItem("tmpFailedRecordsAccum",JSON.stringify(i))}Object.keys(r).length>0?localStorage.setItem(p+e,JSON.stringify(r)):localStorage.removeItem(p+e)}function se(e){return new Promise(function(n,t){null!==e.migrateTo&&void 0!==e.migrateTo?o.updateNewValueInAppSoup("dynVersionNumber",e.migrateTo).then(function(){n()}).catch(function(e){i.error(e),t(e)}):n()})}n.CLEAN_CS_OK=z,t.exports={CSINHEAD_SYNC_VSN:f,refreshToken:function(e,n){q(e,n)},genProxyId:function(e,n,t){return C(e,n,t)},addProxyIds:function(e,n,t,i,a){!function(e,n,t,i,a){var s;r.getProxyFieldName(e).then(function(e){return s=e,o.getCachedCurrentValueFromAppSoup("audId")}).then(function(o){n.forEach(function(n){var r="PROXY%"+e+"%"+t+"%"+n._soupEntryId+"%"+o;n.Id=r,n[s]=r}),(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).upsertSoupEntries(e,n,function(e){i(e)},a)}).catch(function(e){a(e)})}(e,n,t,i,a)},getSyncRecFailures:re,P2M_REFRESH_OK:g,p2mRefreshTable:function(e,n,t,o,r,i,a,s){w(e,n,t,o,r,i,a,s)},buildConnectionSession:function(e,n,t,o,r,i){return I(0,n,t,o,r,i)},M2P_UPDATE_OK:P,M2P_NO_RECS_TO_SYNC:O,m2pUpdateMobileTable:function(e,n,t,o){D(e,n,t,o)},m2pRecoveryUpdateMobileTable:function(e){return N(e)},HEARTBEAT_OK:V,HEARTBEAT_EXCEPTION:A,HEARTBEAT_FAILURE:U,HEARTBEAT_NO_CONNECTION:M,HEARTBEAT_NOT_DEVICE:L,HEARTBEAT_REFRESHED_OK:F,heartBeat:function(e,n){k(e,n)},handleRefreshResponse:h,_getSyncFailureTableKeys:ie,_storeSyncFailures:ae,createUpdateJson:R,syncMobileTable:S,getRTSPendingconnSess:B,CLEAN_CS_OK:z,cleanConnectionSessionHeartBeat:ee,cleanConnectionSessionVFEvent:$,CONN_SESS_OK:W,csStatusCheck:j,maybeSyncConnSess:ne,processM2PUpdateResponse:H,postProcessConnectionSession:te,handleUpdatedCS:oe}}),n("mobileCaddy/fileUtils",function(e,n,t){var o,r,i=e("mobileCaddy/appDataUtils"),a=e("mobileCaddy/smartStoreUtils"),s=e("mobileCaddy/logger"),c=e("mobileCaddy/syncRefresh"),u=(cordova.require("com.salesforce.plugin.smartstore"),"fileUtils.js"),d="File_Library__ap",l=1e4,f="SF_Content_Version_Id__c",p="Synchronised__c",m="File_Type__c",_="Local_Path",S="In_App_Composer__c",h=!!window.USE_FORCETK,y=!!window.LOCAL_DEV,g="numFilesToDownload",v="currFileDownloadIdx",w="allFilesDownloaded",C=0,b=0,E=0,R=1,T=2,I="";function N(){return(o=localStorage.getItem("mcFileStorageDirectory"))||(o=cordova.file?cordova.file.documentsDirectory?cordova.file.documentsDirectory:cordova.file.dataDirectory:"CodeFlow",localStorage.setItem("mcFileStorageDirectory",o),o)}function P(){return!(!window[mobileCaddy.CONTAINER_VSN_KEY]||!window[mobileCaddy.CONTAINER_VSN_KEY].startsWith("3"))}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(n,t){++e>=120&&(s.error("TIMEOUT checkForMediaDigest"),n()),y&&n(),"undefined"!=typeof plugin&&plugin.mcsdk&&plugin.mcsdk.getMediaInstallerDigest?plugin.mcsdk.getMediaInstallerDigest(function(t){switch(t.result.status){case"pending":setTimeout(function(t){O(e).then(function(e){n(e)})},1e3);break;case"notfound":n();break;case"error":s.error(t.result.message),n();break;case"complete":(r=JSON.parse(t.result.message).contains,new Promise(function(e,n){var t=r.map(function(e){return"'"+e.fid+"'"}),i={};r.forEach(function(e){return i[e.fid]=e.cvid});var c=t.join(","),u="SELECT * FROM {"+d+"} WHERE {"+d+":Id} IN ("+c+")",l=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),f=l.buildSmartQuerySpec(u,1);a.smartQuerySoupRecordsWithQuerySpec(f).then(function(e){return function(e,n){return new Promise(function(t){var r=e.reduce(function(e,t){var r=t[1];return r[I+p]=1,r[I+_]=o+n[r.Id].cvid+".xxx",e.push(r),e},[]);t(r)})}(e,i)}).then(function(n){l.upsertSoupEntriesWithExternalId(d,n,"Id",function(n){e()})}).catch(function(e){s.error("ERROR updateFileLibraryFromDigest",e),n(e)})})).then(function(e){n()}).catch(function(e){s.error("ERROR updateFileLibraryFromDigest",err),n()})}var r},function(e){s.error("ERROR getMediaInstallerDigest",e),n()}):n()})}function D(e){switch(e){case"jpg":return"image/jpeg";case"png":return"image/png";case"svg":return"image/svg+xml";case"m4v":case"mp4":return"video/mpeg"}}function V(){return y?T:P()&&"ios"==cordova.platformId?R:E}function A(e,n){if("CodeFlow"!=o)window.resolveLocalFileSystemURL(o+"media",function(t){t.getFile(e[1]+"."+e[2],{create:!0,exclusive:!1},function(t){(function(e,n){return new Promise(function(t,o){e.createWriter(function(e){e.onwriteend=function(){t()},e.onerror=function(e){s.error("Failed file write: "+e.toString()),o()},n.data?e.write(n.data):n.arrayBuffer().then(function(n){e.write(n)})})})})(t,n).then(function(n){U(e)})})},function(e){});else{if(h){var t=btoa(new Uint8Array(n).reduce(function(e,n){return e+String.fromCharCode(n)},""));!function(e,n){var t={filename:e,base64:n};fetch("http://localhost:3000/codeflow/storefile",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(t)}).then(function(e){}).catch(function(e){})}(e[1]+"."+e[2],t)}U(e)}}function U(e){var n="SELECT * FROM {"+d+"} WHERE {"+d+":Id} = '"+e[0]+"'";s.log("soql",n);var t=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),r=t.buildSmartQuerySpec(n,1);a.smartQuerySoupRecordsWithQuerySpec(r).then(function(n){var r=n[0][1];s.log("myRec",r),r[I+p]=1,r[I+_]=o+e[1]+"."+e[2],t.upsertSoupEntriesWithExternalId(d,[r],"Id",function(e){})}).catch(function(e){})}t.exports={downloadFiles:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(function(n,t){var r;C=0,window.LOCAL_DEV&&!window.USE_FORCETK?(localStorage.setItem(w,"true"),O(),n([{status:200}])):(o||N(),new Promise(function(e,n){"CodeFlow"!=o?window.resolveLocalFileSystemURL(o+"",function(n){n.getDirectory("media",{create:!0,exclusive:!1},function(n){e()},function(n){s.error("Error Creating media directory",n),e()})}):e()}).then(function(e){return new Promise(function(e,n){y?window.REMOTE_NAMESPACE?(I=window.REMOTE_NAMESPACE+"__",e({result:window.REMOTE_NAMESPACE})):e(null):"undefined"!=typeof plugin&&plugin.mcsdk||y?plugin.mcsdk.getAppConfigNamespace(function(n){I=n.result?n.result+"__":"",e(n)}):e(null)})}).then(function(e){return O()}).then(function(n){return function(e){return new Promise(function(n,t){var o=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");o.soupExists(d,function(o){if(o){var r=e?" AND {"+d+":"+I+S+"} = '"+e+"'":"",i="SELECT {"+d+":Id},{"+d+":"+I+f+"},{"+d+":"+I+m+"},{"+d+":"+I+S+"} FROM {"+d+"} WHERE {"+d+":"+I+p+"} = 0"+r,c=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),u=c.buildSmartQuerySpec(i,l);a.smartQuerySoupRecordsWithQuerySpec(u).then(function(e){if(s.log("Query res",e),e&&e[0]){var t=[],o=[];e.forEach(function(e){"Published"===e[3]?t.push(e):o.push(e)}),n(t.concat(o))}else n([])}).catch(function(e){t(e)})}else n([])},function(e){s.error("Failed to check soupExists for "+d),t(e)})})}(e)}).then(function(e){e.length>0?(r=e,localStorage.setItem(g,r.length),b=r.length,new Promise(function(e,n){var t={accessToken:null,instanceUrl:null,downloadUrl:null};i.getCurrentValueFromAppSoup("accessToken").then(function(e){return t.accessToken=e||JSON.parse(localStorage.getItem("forceOAuth")).access_token,i.getCurrentValueFromAppSoup("instanceUrl")}).then(function(e){return t.instanceUrl=y?"":e||JSON.parse(localStorage.getItem("forceOAuth")).instance_url+"/",i.getCurrentValueFromAppSoup("communityId")}).then(function(n){n?i.getCurrentValueFromAppSoup("communityUrl").then(function(o){t.downloadUrl=o+"/services/data/v39.0/connect/communities/"+n+"/files/",e(t)}):(t.downloadUrl=t.instanceUrl+"/services/data/v39.0/connect/files/",e(t))}).catch(function(e){s.error("Error creating connectionInfo",e)})}).then(function(e){return Promise.all(r.map(function(n){return function e(n,t){return s.log(u,"doDownloadFile",n),new Promise(function(r,i){var a,d,l,f,p;y&&!h?r():(a=n[1],d=t.accessToken,l=t.instanceUrl,f="/services/data/v39.0/sobjects/ContentVersion/"+a,p=l+f,new Promise(function(e,n){if(a&&a.length>0){s.log(u,"urlToDownload",p);var t=new Headers;t.append("Authorization","Bearer "+d),t.append("Content-Type","application/json");var o={method:"GET",headers:t,mode:"cors"},r=new Request(p);if(P())plugin.mcsdk.request({method:"GET",path:f,contentType:"application/json",data:{}},function(n){e({fileId:n.ContentDocumentId,fileExtension:n.FileExtension})},function(e){n(e)});else if(y){var i={contentType:"application/json",method:"GET",path:p};force.request(i,function(n){e({fileId:n.ContentDocumentId,fileExtension:n.FileExtension})},function(e){s.error(u,"getFileIdFromContentVersionId",e),n(e)})}else fetch(r,o).then(function(e){return s.log(u,e),200==e.status?e.json():(s.error("resp.status",e.status),s.error("resp.statusText",e.statusText),s.error("resp.type",e.type),Promise.reject("Failed to read ContentVersionId object"))}).then(function(n){e({fileId:n.ContentDocumentId,fileExtension:n.FileExtension})}).catch(function(e){s.error(u,"Something went wrong!",e),n(e)})}else e(null)})).then(function(a){var d;a&&a.fileId&&a.fileId.length>0?(d=n[1]+"."+n[2],new Promise(function(e,n){if("CodeFlow"!=o){var t=o+"media/"+d;window.resolveLocalFileSystemURL(t,function(n){e(!0)},function(n){n.code&&1===n.code||s.error("Error checkMediaFileExists resolveLocalFileSystemURL",n),e(!1)})}else e(!1)})).then(function(d){if(d)U(n),r({status:200});else{var l=t.downloadUrl+a.fileId+"/content";switch(s.log(u,"urlToDownload",l),V(),V()){case E:var f=new Headers;f.append("Authorization","Bearer "+t.accessToken),f.append("Content-Type",D(a.fileExtension));var p={method:"GET",headers:f,mode:"cors"},m=new Request(l);fetch(m,p).then(function(o){switch(s.log(u,o),o.status){case 200:C++,localStorage.setItem(v,C),C===b&&localStorage.setItem(w,"true"),A(n,o),r(o);break;case 401:c.refreshToken(function(o){return t.accessToken=o,e(n,t)},function(e){s.error(u,"Failed to refresh token",e),i(e)});break;default:s.error("resp.status",o.status),s.error("resp.statusText",o.statusText),s.error("resp.type",o.type),r(o)}}).catch(function(e){s.error("Something went wrong!",e),i(e)});break;case R:window.resolveLocalFileSystemURL(o,function(e){var i=o+"media/"+n[1]+"."+n[2];cordova.plugin.http.downloadFile(l,{},{Authorization:"Bearer "+t.accessToken},i,function(e){C++,localStorage.setItem(v,C),C===b&&localStorage.setItem(w,"true"),U(n),r({status:200})},function(e){r(e)})});break;case T:var _={contentType:D(a.fileExtension),method:"GET",path:l,fileExtension:a.fileExtension};force.request(_,function(e){A(n,e),r(e)},function(e){s.error(u,"doDownloadFile",e),i(e)})}}}).catch(function(e){s.error("ERROR checkFileExists",e),r()}):r()}).catch(function(e){s.error(e),i(e)})})}(n,e).then(function(e){return e}).catch(function(e){return e})})).then(function(e){return s.log("accum",e),e}).catch(function(e){return e})}).then(function(e){s.log("res1",e),n(e)}).catch(function(e){t("filesToDownload2")})):(s.log("No files to download"),localStorage.setItem(w,"true"),n([{status:200}]))}).catch(function(e){t(e)}))})},storeFilesInfo:function(e){return new Promise(function(n,t){o||N();var r=e,i="",s=(r.map(function(e,n){return i+=0===n?"'"+e.Id+"'":",'"+e.Id+"'",e.Id}),"SELECT {"+d+":Id} FROM {"+d+"} WHERE {"+d+":Id} IN ("+i+")"),c=(window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore")).buildSmartQuerySpec(s,l);a.smartQuerySoupRecordsWithQuerySpec(c).then(function(e){var n;return n=0!==e.length?r.filter(function(n){return!e[0].includes(n.Id)}):r,a.upsertSoupEntries(d,n)}).then(function(e){n(e)}).catch(function(e){t(e)})})},getStorageDirectory:N,readAsDataURL:function(e){return new Promise(function(n,t){if(cordova.platformId)if("ios"==cordova.platformId)if(r)n(r+e);else{var o=localStorage.getItem("cdvFileURI");o?n((r=o)+e):window.resolveLocalFileSystemURL(N(),function(t){r=window.Ionic.WebView?window.Ionic.WebView.convertFileSrc(t.toURL()+"media/"):plugin.Ionic.WebView.convertFileSrc(t.toURL()+"media/"),localStorage.setItem("cdvFileURI",r),n(r+e)})}else n("./../media/"+e);else if(window.location.origin.includes("localhost"))window.IonicVersion&&6===window.IonicVersion?n("/assets/mock/files/"+e):n("/mock/files/"+e);else{var i=window.cdfyAwsUrl;if(i)n(i+"/"+e);else{var a=e.substring(0,e.indexOf("."));n("/sfc/servlet.shepherd/version/download/"+a)}}})}}}),n("mobileCaddy/vsnUtils",function(e,n,t){var o=e("mobileCaddy/devUtils"),r=e("mobileCaddy/appDataUtils"),i=mobileCaddy.require("mobileCaddy/smartStoreUtils"),a=e("mobileCaddy/syncRefresh"),s=e("mobileCaddy/logger"),c=["cacheSoup","recsToSync"];function u(){return!(!window[mobileCaddy.CONTAINER_VSN_KEY]||!window[mobileCaddy.CONTAINER_VSN_KEY].startsWith("3"))}function d(e,n){return new Promise(function(n,t){null===e?i.listMobileTables(i.ALPHA,function(e){var t=c;_.each(e,function(e){t.push(e),t.push("SnapShot_"+e),localStorage.removeItem("meta-tableDEF-"+e),localStorage.removeItem("meta-tableCRUD-"+e)}),n(t)},function(e){t(e)}):n([])})}function l(e,n){return new Promise(function(n,t){d(e).then(function(e){return Promise.all(e.map(i.deleteSoup))}).then(function(){n()}).catch(function(e){s.error(e),t(e)})})}function f(e){return new Promise(function(n,t){var o={},c=e?"Version Upgrade":"HardReset";new Promise(function(e,n){a.refreshToken(function(n){e("ok")},function(e){n(e)})}).then(function(){i.querySoupRecsPromise("appSoup").then(function(e){return e.forEach(function(e){o[e.Name]=e.CurrentValue}),l(null)}).then(function(){return p(o)}).then(function(t){var r,i,a="localhost:3030"==window.location.host?"codeflow":"undefined"!=typeof mockStore?navigator.appVersion.includes("Electron")?"desktop":"platform":"device";"codeflow"==a&&(r=localStorage.getItem("forceOAuth"),i=localStorage.getItem("appSoup"));if(e&&localStorage.getItem("lsItemsToPersist")){var s=JSON.parse(localStorage.getItem("lsItemsToPersist")).map(function(e){return{key:e,value:localStorage.getItem(e)}});s.push({key:"lsItemsToPersist",value:localStorage.getItem("lsItemsToPersist")}),localStorage.clear(),s.forEach(function(e){localStorage.setItem(e.key,e.value)})}else localStorage.clear();if("codeflow"==a)localStorage.setItem("forceOAuth",r),localStorage.setItem("appSoup",i),window.location.protocol+"//"+window.location.host+"/www",n("ok");else{if("platform"!=a)return u()?Promise.resolve(t):function(e,n,t){return new Promise(function(o,r){var i,a="";navigator&&navigator.connection&&(a=navigator.connection.type),window.device&&(i=window.device);var s="";navigator.appVersion.includes("Electron")&&(i=ipcRenderer.sendSync("request-device-info",""),a="wifi",s="landscape");var c=c||s,u=e+"?deviceUuid="+i.uuid+"&deviceName="+i.name+"&deviceCordova="+i.cordova+"&deviceVersion="+i.version+"&deviceModel="+i.model+"&buildName="+n.buildName+"&buildVersion="+n.buildVersion+"&buildOS="+n.buildOS+"&knownAud="+n.audId+"&currentDv="+n.dynVersionNumber+"&orientation="+c+"&viewportWidth="+window.innerWidth+"&viewportHeight="+window.innerHeight+"&sessionType="+t+"&connType="+a+"&loginUrl="+n.loginUrl+"&millsFromEpoch="+(new Date).getTime();"undefined"!=typeof plugin&&plugin.mcsdk?plugin.mcsdk.getRESTBootstrapSetting(function(r){r.result?plugin.mcsdk.getConfig(function(r){var s={deviceUuid:i.uuid,deviceCordova:i.cordova,deviceName:i.name,deviceVersion:i.version,deviceModel:i.model,buildName:n.buildName,buildVersion:n.buildVersion,buildOS:n.buildOS,orientation:c,viewportWidthString:window.innerWidth,viewportHeightString:window.innerHeight,sessionType:t,userLanguage:"",connType:a,millsFromEpochString:(new Date).getTime(),loginUrl:n.loginUrl,containerVersion:r.containerVersion,containerAppName:r.containerAppName,containerBundleID:r.containerBundleID},u=new URL(e),d=u.origin;return fetch(d+"/services/apexrest/mobilecaddy1/mcBootstrap001/",{method:"POST",mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n.accessToken},body:JSON.stringify(s)}).then(function(e){return e.json()}).then(function(e){var n=new URL(e.path);o({type:"rest",pathname:n.pathname})})}):o(u)}):o(u)})}(t,o,c);window.location.href.substr(0,window.location.href.indexOf("#"))}}).then(function(e){r.updateNewValueInAppSoup("buildStatus","Resetting").then(function(){i.deleteSoup("syncLib_system_data").then(function(o){if(u())plugin.mcsdk.upgradeDynamicVersion(c,function(e){t(e)});else if(e.type&&"rest"==e.type)plugin.mcsdk.upgradeDynamicVersion(e.pathname);else{try{window.location.href=e}catch(e){s.errorAndDispatch("error on redirect",e),t(e)}n()}}).catch(function(e){s.errorAndDispatch(e)}),n()}).catch(function(e){s.errorAndDispatch(e),t(e)})}).catch(function(e){s.errorAndDispatch(e),t(e)})}).catch(function(e){s.error("Tokens are bad, testRefreshAccessToken rejected with: "+JSON.stringify(e)),window.history.go(-(history.length-1)),navigator.appVersion.includes("Electron")||("undefined"!=typeof plugin&&plugin.mcsdk?plugin.mcsdk.logout():cordova.require("com.salesforce.plugin.sfaccountmanager").logout()),t(e)})})}function p(e){return new Promise(function(n,t){var o,r="/apex/mobilecaddy1__MobileCaddyBootstrap001_mc";switch(e.platAuthUrl){case"i":case"I":o=e.instanceUrl+r;break;case"l":case"L":o=e.loginUrl+r;break;case"":o=void 0;break;default:o=e.platAuthUrl}o?n(o):"undefined"!=typeof plugin&&plugin.mcsdk?plugin.mcsdk.getBootstrapUrl(function(e){n(e.result)},function(e){s.error("Failed to get boostrap URL from contaner",e),t(e)}):(e.authURLType||(e.authURLType="login"),o="login"==e.authURLType?e.loginUrl+r:e.instanceUrl+r,n(o))})}function m(){return o.upgradeAvailable()}t.exports={clearSoups:function(e,n){return l(e)},getSoupsToClear:function(e,n){return d(e)},hardReset:function(){return f()},upgradeAvailable:function(){return m()},upgradeIfAvailable:function(){return new Promise(function(n,t){m().then(function(r){if(r&&"force"==e)return f(!0);if(r){var i="skip-failures"==e?a.getSyncRecFailures():null;o.dirtyTables(i).then(function(e){e.length>0?n(!1):a.getRTSPendingconnSess(function(e){if(null===e||void 0===e)return f(!0);n(!1)},function(e){n(!1)})}).catch(function(e){s.error(e),t(e)})}else n(!1)}).catch(function(e){s.error(e),t(e)})});var e},_getBootstrapUrl:function(e){return p(e)}}}),n("mobileCaddy/logUtils",function(e,n,t){var o=0,r=1,i=2,a=3,s=4;function c(e,n){return new Promise(function(t,r){if(1==n.length&&(n=n[0]),"object"==_typeof(n)&&(n=JSON.stringify(n)),"number"!=typeof n&&"boolean"!=typeof n||(n=n.toString()),"string"==typeof n){e==o&&localStorage.setItem("lastErrorLog",n.substring(0,1024));var i={mobilecaddy1__Error_Text__c:n.substring(0,1024),SystemModstamp:(new Date).getTime()},a=localStorage.getItem("appSoup-audId");i.mobilecaddy1__Application_User_Device__c=a,i.mobilecaddy1__Log_Type__c="D"+e.toString(),t(i)}else r("Trying to log unsupported type"+_typeof(n))})}function u(e,n,t,a){return new Promise(function(s,u){var d=localStorage.getItem("logLevel");d=null===d||void 0==_typeof(d)?0:d;if(n>0){var l=a.stack.split("\n")[4];if(void 0!==l){var f=l.indexOf("at ");l.slice(f+2,l.length)}}var p=t[0];switch(n){case o:t[0]&&t[0].stack?p=t[0].message+", STACK:"+t[0].stack:t[1]&&t[1].stack?p+="\n"+t[1].message+", STACK:"+t[1].stack:p=t,c(n,p).then(function(e){s(e)});break;case r:case i:c(n,t).then(function(e){s(e)});break;default:c(n,t).then(function(e){s(e)})}e&&"undefined"!=typeof LOCAL_DEV&&LOCAL_DEV&&alert(p+"\n\nSee dev console for more information")})}function d(){try{throw Error("")}catch(e){return e}}t.exports={debug:function(e){return u(!1,s,arguments,d())},error:function(e){return u(!1,o,arguments)},errorAndDispatch:function(e){return u(!0,o,arguments)},info:function(e){return u(!1,a,arguments,d())},log:function(e){return u(!1,i,arguments,d())},warn:function(e){return u(!1,r,arguments,d())},doLog:u}}),n("mobileCaddy/logger",function(e,n,t){var o=e("mobileCaddy/smartStoreUtils"),r=e("mobileCaddy/logUtils"),i=0,a=1,s=2,c=3,u=4;function d(e,n,t,i){r.doLog(e,n,t,i).then(function(e){var r=localStorage.getItem("logLevel");(r=null===r||void 0==_typeof(r)?0:r)>=n&&o.insertRecords("Mobile_Log__mc",[e],function(e){},function(e){f(e,_typeof(t))})}).catch(function(e){f(e,_typeof(t))})}function l(){try{throw Error("")}catch(e){return e}}function f(e){return d(!1,i,arguments)}t.exports={debug:function(e){return d(!1,u,arguments,l())},error:f,errorAndDispatch:function(e){return d(!0,i,arguments)},info:function(e){return d(!1,c,arguments,l())},log:function(e){return d(!1,s,arguments,l())},warn:function(e){return d(!1,a,arguments,l())}}}),n("mobileCaddy/devUtils",function(e,n,t){var o=e("mobileCaddy/smartStoreUtils"),r=e("mobileCaddy/appDataUtils"),i=(e("mobileCaddy/fileUtils"),e("mobileCaddy/syncRefresh")),a=e("mobileCaddy/logger"),s=(cordova.require("com.salesforce.plugin.smartstore"),!!window.USE_FORCETK),c=1,u=2,d=3,l=4,f=5,p=6,m=8,S=99,h=100400,y=100402,g=100700,v=101e3,w=101100,C=101200,b=101300,E=["syncLib_system_data","appSoup","cacheSoup","recsToSync","SnapShot_Connection_Session__mc"],R=["autonumber","CreatedById","CreatedDate","IsDeleted","IsClosed","IsWon","LastModifiedById","LastModifiedDate","LastReferencedDate","mobilecaddy1__MC_Proxy_ID","MC_Proxy_ID","OwnerId","SystemModstamp","Id","dirtyFlag"],T=0;function I(e){return new Promise(function(n,t){var i=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),s=new Date,c=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0).valueOf();new Promise(function(e,n){var t=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore");t.soupExists("Analytics",function(o){o?e():t.registerSoup("Analytics",[{path:"Name",type:"integer"},{path:"Data",type:"string"}],function(n){e()},function(e){n(e)})},function(e){a.error(e),n(e)})}).then(function(){return function(e){return new Promise(function(n,t){var i=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),s="";r.getCurrentValueFromAppSoup("audId").then(function(e){return s=e,o.querySoupRecsPromise("Analytics")}).then(function(r){var c=[],u=[],d=[];r.forEach(function(n){if(n.Name==e)c.push(n);else{var t={Name:n.Name.toString(),SystemModstamp:n.Name,mobilecaddy1__Error_Text__c:JSON.parse(n.Data),mobilecaddy1__Application_User_Device__c:s,mobilecaddy1__Log_Type__c:"analytic"};u.push(t),d.push(n._soupEntryId)}}),0!==u.length&&o.insertRecords("Mobile_Log__mc",u,function(e){i.removeFromSoup("Analytics",d,function(e){n(c)},function(e){a.error("Unable to insert analytic recs",e),t(e)})},function(e){a.error("Unable to insert analytic recs",e),t(e)}),n(c)}).catch(function(e){a.error("Error housekeeping Analytics",e),t(e)})})}(c)}).then(function(t){var o={};if(0===t.length){o[e]=1;var r={Name:c,Data:JSON.stringify(o)};n(o[e]),i.upsertSoupEntries("Analytics",[r],function(e){},function(e){a.error("Unable to insert analytic recs",e)})}else{var s=t[0];(o=JSON.parse(s.Data))[e]=void 0===o[e]?1:o[e]+1,n(o[e]),s.Data=JSON.stringify(o),i.upsertSoupEntriesWithExternalId("Analytics",[s],"Name",function(e){},function(e){a.error(e)})}}).catch(function(e){a.error("Error in analInc",e),t(e)})})}function N(e,n,t){return new Promise(function(r,i){var a=function(n,o){var a=0;switch(n){case g:a=1;break;case v:a=4;break;case w:a=7;break;case C:a=10;break;default:a=0}if("Y"==o.charAt(a))r(t);else{var s={};s.status=n+d,s.mc_add_status=e,i(s)}};-1==E.indexOf(e)?localStorage["meta-tableCRUD-"+e]?a(n,localStorage["meta-tableCRUD-"+e]):o.getTableDefnColumnValue(e,"Application Record CRUD").then(function(t){localStorage["meta-tableCRUD-"+e]=t,a(n,t)}).catch(function(e){i(e)}):r(t)})}function P(){return new Promise(function(e,n){if(!0===s){var t=force.getUserId();e(t)}else O("userId").then(function(n){e(n)}).catch(function(e){a.error("getCurrentUserId",e),n(e)})})}function O(e){return new Promise(function(n,t){r.getCachedCurrentValueFromAppSoup(e).then(function(e){n(e)}).catch(function(e){a.error("getCachedAppSoupValue",e),t(e)})})}function D(e,n,t,o){if("_soupLastModifiedDate"==e)return o;var r=_.findWhere(t,{path:e}),i={};if(void 0===r)return i.status=n+u,i.mc_add_status=e,i;var a=0;switch(n){case g:a=1;break;case v:a=4;break;case w:a=7;break;default:a=0}if("Y"!=r.crud.charAt(a))return i.status=n+d,i;try{return i.value=U(o,r.appColType,r.platColType),i}catch(t){return i.status=n+f,i.mc_add_status=t+"->"+e,i}}function V(e){return new Promise(function(n,t){localStorage["meta-tableDEF-"+e]?n(JSON.parse(localStorage["meta-tableDEF-"+e])):o.listMobileTableColumns(e,o.FULL,function(t){localStorage["meta-tableDEF-"+e]=JSON.stringify(t),n(t)},function(e){t(e)})})}function A(e,n,t){switch(t){case"checkbox":case"Deleted":return"true"===String(e);case"CreatedDate":case"date":case"datetime":case"LastActivtyDate":case"LastModifiedDate":case"LastReferencedDate":case"LastViewedDate":case"SystemModstamp":return null!==e?new Date(e):e;default:return e}}function U(e,n,t){var o=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;switch(t){case"autonumber":throw"invalid_autonumber";case"checkbox":case"Deleted":if("boolean"==typeof e||"true"===e||"false"===e)return String(e);throw"invalid_boolean";case"date":if("string"==typeof e){if(!o.test(e))throw"invalid_date";e=new Date(e)}if(e instanceof Date)return e.setUTCHours(0),e.setUTCMinutes(0),e.setUTCSeconds(0),e.setUTCMilliseconds(0),e.valueOf();if(null===e)return null;throw"invalid_date";case"datetime":if("string"==typeof e){if(!o.test(e))throw"invalid_datetime";e=new Date(e)}if(e instanceof Date)return e.valueOf();if(null===e)return null;throw"invalid_datetime";case"email":if(function(e){if(0===e.length)return!0;var n=e.indexOf("@"),t=e.lastIndexOf(".");return!(n<1||t<n+2||t+2>=e.length)}(e))return e;throw"invalid_email";default:switch(n){case"jsString":if("string"==typeof e)return e;if("number"==typeof e)return e.toString();throw"invalid_string";case"jsNumber":if("number"==typeof e||null===e)return e;throw"invalid_number";default:return e}}}function M(e,n){return new Promise(function(t,r){var i={};localStorage["meta-tableCRUD-"+e]?t():o.listMobileTables(o.ALPHA,function(o){o.concat(E).indexOf(e)>=0?t():(i.status=n+c,i.mc_add_status=e,r(i))},function(e){i.status=n+S,i.mc_add_status="Unkonwn error "+e,r(i)})})}function L(e,n,t,o,r){return new Promise(function(i,s){var c={},S={};c.status=t,F().then(function(n){return n[e]&&(S=n[e]),P()}).then(function(e){o.forEach(function(o){if(delete o._soupEntryId,delete o.$HashKey,o.RecordTypeName){if(o.RecordTypeId=S[o.RecordTypeName],_.isEmpty(S))return c.status=t+u,c.mc_add_status=o.RecordTypeName,i(c);if(!o.RecordTypeId)return c.status=t+m,c.mc_add_status=o.RecordTypeName,i(c);delete o.RecordTypeName}for(var a in o)if(o.hasOwnProperty(a)&&a!=n){var s=D(a,t,r,o[a]);if(s.status==t+u){c.status=s.status,c.mc_add_status=a;break}if(s.status==t+f){c.status=s.status,c.mc_add_status=a;break}if(s.status==t+d){c.status=s.status,c.mc_add_status=a;break}if(t==g&&R.indexOf(a)>=0){c.status=t+p,c.mc_add_status=a;break}o[a]=s.value}if(c.status!=t+u&&c.status!=t+f&&c.status!=t+p){var h=(new Date).getTime();t==g&&(o.CreatedById=e,o.CreatedDate=h),o.SystemModstamp=h,o.LastModifiedDate=h,o.LastModifiedById=e,o.IsDeleted="false",r.forEach(function(e){if(t==g){var n=e.crud.charAt(1);R.indexOf(e.path)<0&&"false"==e.nillable&&"Y"==n?_.has(o,e.path)||(c.status=t+l,c.mc_add_status=e.path):("IsClosed"==e.path&&(o.IsClosed="false"),"IsWon"==e.path&&(o.IsWon="false"))}""!==e.proxyRefField&&void 0!==o[e.path]&&o[e.path].length>18&&(o[e.proxyRefField]=o[e.path])})}}),c.records=o,i(c)},function(e){a.error("validateRecords",e)})})}function F(){return new Promise(function(e,n){localStorage.getItem("lsDotsRecordTypes")?e(JSON.parse(localStorage.getItem("lsDotsRecordTypes"))):o.querySoupRecords("dotsRecordTypes",function(n){var t={};n.forEach(function(e){var n={};JSON.parse(e.Data).forEach(function(e){e.recTypeDevName?(n[e.recTypeId]={recTypeName:e.recTypeName,recTypeDevName:e.recTypeDevName},n[e.recTypeName]=e.recTypeId,n[e.recTypeDevName]=e.recTypeId):(n[e.recTypeId]=e.recTypeName,n[e.recTypeName]=e.recTypeId)}),t[e.Table]=n}),localStorage.setItem("lsDotsRecordTypes",JSON.stringify(t)),e(t)},function(e){a.error("Error returned from upsert, message =  "+e),n(e)})})}function k(e,n,t){var r,i={};return new Promise(function(s,c){n.length>0?M(e,C).then(function(){return V(e)}).then(function(n){return N(e,C,n)}).then(function(o){return new Promise(function(r,i){var s=D(t,C,o);s.status!=C+u?L(e,t,C,n,o).then(function(e){e.status==C?r(e.records):(i(e),a.error(e))}):(i(s),a.error(s))})}).then(function(r){return o.queryMobileTable(e,t,n[0][t])}).then(function(n){if(0===n.length)i.status=C+l,a.warn("deleteRecord no record found",e),i.mc_add_status="no record found",c(i);else{if(!(n[0].Id.length<19))return r=n,o.querySoupRecsPromise("recsToSync");i.status=C+d,a.warn("deleteRecord Cannot delete synced records"),i.mc_add_status="Cannot delete synced records",c(i)}}).then(function(n){var t=n.reduce(function(n,t){return t.Mobile_Table_Name==e&&_.findWhere(r,{_soupEntryId:t.SOUP_Record_Id})&&n.push({_soupEntryId:t._soupEntryId}),n},[]);o.deleteRecordsFromSoup(r,e,function(){o.deleteRecordsFromSoup(t,"recsToSync",function(){i.status=C,i.records=r,s(i)},function(e){c(e)})},function(e){c(e)})}).catch(function(e){c(e)}):(i.status=C,a.warn("deleteRecord No records supplied"),i.mc_add_status="No records supplied",i.records=[],s(i))})}function x(e){return new Promise(function(n,t){B("recsToSync").then(function(t){var o=[],r=[],i={};e&&e.forEach(function(e){i[e.table]=e.failures}),t.records.forEach(function(n){"Connection_Session__mc"==n.Mobile_Table_Name||void 0!==o[n.Mobile_Table_Name]||e&&i[n.Mobile_Table_Name]&&(!i[n.Mobile_Table_Name]||i[n.Mobile_Table_Name][n.Id])||(o[n.Mobile_Table_Name]=!0,r.push(n.Mobile_Table_Name))}),n(r)}).catch(function(e){a.error(e),t(e)})})}function q(e,n){return new Promise(function(t,o){e.length>0&&-1==E.indexOf(n)?F().then(function(o){if(o[n]){var r=o[n],i=e.map(function(e){return"object"==_typeof(r[e.RecordTypeId])?(e.RecordTypeName=r[e.RecordTypeId].recTypeName,e.RecordTypeDevName=r[e.RecordTypeId].recTypeDevName):e.RecordTypeName=r[e.RecordTypeId],e.RecordTypeName||a.warn("enrichWithRecordTypeNames",e.RecordTypeId),e});t(i)}else t(e)}).catch(function(e){o(e)}):t(e)})}function J(e,n){var t=JSON.parse(JSON.stringify(n)),r={};return new Promise(function(n,i){M(e,g).then(function(){return V(e)}).then(function(n){return N(e,g,n)}).then(function(n){return new Promise(function(o,r){L(e,null,g,t,n).then(function(e){e.status==g?o(e.records):r(e)})})}).then(function(t){o.insertRecords(e,t,function(e){r.status=g,r.records=e,ee().then(function(e){r.upgradeAvailable=e,n(r)}).catch(function(e){n(r),a.error(e)})},function(e){i(e),a.error(e)})}).catch(function(e){i(e),a.error(e)})})}function B(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n={};return new Promise(function(t,r){M(e,v).then(function(){return N(e,v)}).then(function(){return V(e)}).then(function(i){o.querySoupRecords(e,function(s){n.status=v,s.length>0?-1==E.indexOf(e)?o.getTableDefnColumnValue(e,"Last Refresh Date/Time").then(function(t){return W(e,s,i,t,n)}).then(function(e){t(e)}).catch(function(e){r(e),a.error(e)}):W(e,s,i,null,n).then(function(e){t(e)}):(n.records=[],ee().then(function(e){n.upgradeAvailable=e,t(n)}).catch(function(e){t(n),a.error(e)}))},function(e){r(e),a.error(e)})},function(e){r(e),a.error(e)})})}function W(e,n,t,o,r){return new Promise(function(i,s){n.forEach(function(e){for(var n in e){var r=_.findWhere(t,{path:n});void 0!==r&&(e[n]=A(e[n],r.appColType,r.platColType),"LastModifiedDate"==n&&(e.dirtyFlag=H(e[n],o)))}}),r.records=n.filter(function(e){return"object"==_typeof(e)}),q(r.records,e).then(function(e){return r.records=e,ee()}).then(function(e){r.upgradeAvailable=e,i(r)}).catch(function(e){i(r),a.error(e)})})}function K(e,n){return new Promise(function(t,r){var i,s,c=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),u={},d=/FROM\s+\{(\S*)\}/gi.exec(e),l=n||1e3,f=d[1];(function(e,n){return new Promise(function(t,r){var i=!0,a=n.match(/SELECT\s+(.*)\s+FROM/i);"*"!==a[1]&&(i=!1);var s=n.match(/\s+FROM\s+{(.*)}\s+WHERE\s+(.*)/i);if(null!==s&&null!==s[1]){var c,u,d=n,l=s[2].split(" AND "),f={},p="";l.forEach(function(e){var n=e.match(/{(.*):(.*)}\s+=\s+(.*)/i);if(n){var t=n[2];p=n[3].split("'")[1],f[t]=p}}),l.forEach(function(e){var n=e.match(/{(.*):(.*)}\s+IN\s+\((.*)\)/i);if(n&&"Id"==n[2]){var t=n[3].split(",");(u=t.some(function(e){return e.length>20}))&&(c=n[3])}}),void 0!==f.Id&&f.Id.length>18||u?o.getProxyFieldName(e).then(function(e){if(u){var n=":Id} IN ("+c+") OR {"+s[1]+":"+e+"} IN";d=d.replace(":Id} IN",n)}else d=d.replace("Id} =",e+"} =");t([d,i])}):t([d,i])}else t([n,i])})})(f,e).then(function(e){var n=e[0];return s=e[1],i=c.buildSmartQuerySpec(n,l),"MC-TIMING smartRead "+f,M(f,v)}).then(function(){return N(f,v)}).then(function(){return V(f)}).then(function(e){o.smartQuerySoupRecordsWithQuerySpec(i,function(n){u.status=v,n.length>0?-1==E.indexOf(f)&&s?o.getTableDefnColumnValue(f,"Last Refresh Date/Time").then(function(t){return j(f,n,e,t,u)}).then(function(e){t(e)}):j(f,n,e,null,u).then(function(e){t(e)}):(u.records=[],ee().then(function(e){u.upgradeAvailable=e,t(u)}).catch(function(e){t(u),a.error(e)}))},function(){r()})},function(e){r(e),a.error(e)})})}function j(e,n,t,o,r){return new Promise(function(i,s){var c=[],u=!0;n.forEach(function(e){var n;if("object"==_typeof(e[1]))for(var r in n=e[1]){var i=_.findWhere(t,{path:r});void 0!==i&&(n[r]=A(n[r],i.appColType,i.platColType),"LastModifiedDate"==r&&(e[1].dirtyFlag=H(e[1][r],o)))}else n=e,u=!1;c.push(n)}),r.records=c.filter(function(e){return"object"==_typeof(e)}),u?q(r.records,e).then(function(e){return r.records=e,ee()}).then(function(e){r.upgradeAvailable=e,i(r)}).catch(function(e){i(r),a.error(e)}):ee().then(function(e){r.upgradeAvailable=e,i(r)}).catch(function(e){i(r),a.error(e)})})}function H(e,n){return n&&"null"!=n||(n=0),e.valueOf()>n}function Q(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=n?n.sessNum:1,o=n?n.totalSess:1,r=n?n.csPId:null;return new Promise(function(n,s){var c=function(e){n(e)},u={table:e};i.p2mRefreshTable(e,0,!1,t,o,r,function(e){e.status==i.P2M_REFRESH_OK?(u.status=h,c(u)):(u.status=e.status,u.mc_add_status=e.mc_add_status,e.sessNum&&(u.sessNum=e.sessNum,u.totalSess=e.totalSess,u.csPId=e.csPId),c(u))},function(e){a.error("innerProcessRefreshTablePromise error",e),s(e)})})}function Y(e,n){return new Promise(function(t,o){if(0===e.length)t({status:h+l});else{var r={};i.heartBeat(function(s){if(s.status==i.HEARTBEAT_OK||s.status==i.HEARTBEAT_NOT_DEVICE||s.status==i.HEARTBEAT_REFRESHED_OK){var c=[];x().then(function(t){return t.forEach(function(n){var t=e.indexOf(n);t>-1&&(c.push({table:n,status:y,mc_add_status:"Dirty records"}),e.splice(t,1))}),function e(n,t,o,r){return new Promise(function(i,a){o||(o=[]),r||(r=1);var s,c=localStorage.getItem("doParallelInitialSyncFlag")?"true"===localStorage.getItem("doParallelInitialSyncFlag"):!!window.doParallelInitialSyncFlag&&window.doParallelInitialSyncFlag,u=c&&(window.location.origin.includes("localhost")||window.mcBaseBuildVersion&&"3"===window.mcBaseBuildVersion[0])?Z:G;window.syncFun=u.name,u(n,t,o).then(function(c){if(c.forEach(function(e,n){e&&(o.push(e),e.status!=h&&void 0===s&&(s=n))}),void 0!==s)if(r<3){var u=n.splice(s,n.length-s);setTimeout(function(n){e(u,t,o,r+1).then(function(e){i(e)}).catch(function(e){a(e)})},3e3)}else a(o);else i(o)})})}(e,n,null)}).then(function(e){var n=c.concat(e).filter(function(e){return e});t(n);var r={mobilecaddy1__Mobile_Process_Status__c:""};X().then(function(e){i.maybeSyncConnSess(r,function(){},function(e){o(e),a.error(e)})})}).catch(function(e){if(Array.isArray(e)){var n=c.concat(e).filter(function(e){return e});a.error("InitialSync Failed"),z("Mobile_Log__mc").then(function(e){var t={mobilecaddy1__Mobile_Process_Status__c:""};X().then(function(e){i.maybeSyncConnSess(t,function(){z("Mobile_Log__mc"),o(n)},function(e){o(e),a.error(e)})})}).catch(function(e){a.error("Failed sending Mobile Logs"),o(e)}),o(n)}else o(e),a.error(e)})}else r.status=y,r.mc_add_status=s.status,t(r),100101==r.mc_add_status||100102==r.mc_add_status?a.error(r):a.log(r)},function(e){a.error(e),r.status=y,t(r)})}})}function G(e,n,t){Promise.resolve();var o,r=[];return t&&(o={},t.forEach(function(e){o[e.table]={sessNum:e.sessNum?e.sessNum:1,csPId:e.csPId,totalSess:e.totalSess?e.totalSess:1}})),e.reduce(function(e,t){return e.then(function(e){if(e&&e[e.length-1].status!=h)return Promise.resolve();n&&n({status:0,table:t});var r=o&&o[t]?o[t]:null;return r?Q(t,r):Q(t)}).then(function(e){return n&&n(e),e&&r.push(e),r}).catch(function(e){a.errorAndDispatch(e)})},Promise.resolve())}function Z(e,n){return new Promise(function(t,o){var r=e.map(function(e){return function(e,n){return new Promise(function(t,o){var r=1500*T;T++,setTimeout(function(){Q(e).then(function(o){n&&n({status:0,table:e}),t(o)}).catch(function(e){o(e)})},r)})}(e,n)});Promise.allSettled=Promise.allSettled||function(e){return Promise.all(e.map(function(e){return e.then(function(e){return{status:"fulfilled",value:e}}).catch(function(e){return{status:"rejected",reason:e}})}))},Promise.allSettled(r).then(function(e){t(e.map(function(e){return e.value}))}).catch(function(e){a.errorAndDispatch(e),t(values)})})}function X(){return new Promise(function(e,n){var t=window.smartstore?window.smartstore:cordova.require("com.salesforce.plugin.smartstore"),r="SELECT * FROM {Connection_Session__mc} WHERE {Connection_Session__mc:mobilecaddy1__Mobile_Process_Status__c} = 'P2M RE Exception/Timeout'",i=t.buildSmartQuerySpec(r,100);o.smartQuerySoupRecordsWithQuerySpec(i,function(n){var o=n.map(function(e){return e[1].mobilecaddy1__Mobile_Process_Status__c="P2M InitialSync Faliure",e[1]});t.upsertSoupEntries("Connection_Session__mc",o,function(n){var o=n.map(function(e){return{Id:e.Id,SystemModstamp:e.SystemModstamp-1,mobilecaddy1__Session_Type__c:null,mobilecaddy1__Mobile_Process_Status__c:null,mobilecaddy1__Session_Created_Location_Error__c:null,mobilecaddy1__MC_Proxy_ID__c:null}});t.upsertSoupEntries("SnapShot_Connection_Session__mc",o,function(n){var o=n.map(function(e){return{Mobile_Table_Name:"Connection_Session__mc",CRUD_Operation:"Insert",SOUP_Record_Id:e._soupEntryId,Id:e.Id,LastModifiedDateTime:e.SystemModstamp}});t.upsertSoupEntries("recsToSync",o,function(){e()},function(e){a.error(e)})},function(e){a.error(e)})},function(e){a.error(e)}),e()},function(e){a.error(e),n(e)})})}function z(e,n,t,o,r,a){return new Promise(function(s,c){M(e,h).then(function(){return i.syncMobileTable(e,n,t,o,r,a)}).then(function(e){s(e)}).catch(function(e){c(e)})})}function $(e,n,t){var r=JSON.parse(JSON.stringify(n)),i={};return new Promise(function(n,s){r.length>0?M(e,w).then(function(){return V(e)}).then(function(n){return N(e,w,n)}).then(function(n){return new Promise(function(o,i){var a=D(t,w,n);a.status!=w+u?L(e,t,w,r,n).then(function(e){e.status==w?o(e.records):i(e)}):i(a)})}).then(function(r){o.updateRecordsWithExternalId(e,r,t,function(e){i.status=w,i.records=e,ee().then(function(e){i.upgradeAvailable=e,n(i)}).catch(function(e){n(i)})},function(e){s(e),a.error(e)})},function(e){s(e),a.error(e)}):(i.status=w,i.mc_add_status="No records supplied",i.records=[],n(i),a.warn(i))})}function ee(){return new Promise(function(e,n){o.queryMobileTable("appSoup","Name","dynVersionNumber").then(function(n){void 0!==n[0].NewValue&&n[0].NewValue!=n[0].CurrentValue?e(!0):e(!1)}).catch(function(e){a.error(e),n(e)})})}t.exports={SYNC_OK:h,SYNC_NOK:y,SYNC_ALREADY_IN_PROGRESS:h+98,SYNC_UNKONWN_TABLE:h+c,SYNC_MANDATORY_MISSING:h+l,DELETE_RECS_OK:C,DELETE_RECS_UNKONWN_TABLE:C+c,DELETE_RECS_UNKONWN_FIELD:C+u,DELETE_RECS_ACCESS_DENIED:C+d,DELETE_RECS_MANDATORY_MISSING:C+l,INSERT_RECS_OK:g,INSERT_RECS_UNKONWN_TABLE:g+c,INSERT_RECS_UNKONWN_FIELD:g+u,INSERT_RECS_ACCESS_DENIED:g+d,INSERT_RECS_MANDATORY_MISSING:g+l,INSERT_RECS_DATATYPE_MISMATCH:g+f,INSERT_RECS_PROTECTED_FIELD:g+p,INSERT_RECS_UNKNOWN_RECORD_TYPE:g+m,READ_RECS_OK:v,READ_RECS_UNKONWN_TABLE:v+c,READ_RECS_ACCESS_DENIED:v+d,UPDATE_RECS_OK:w,UPDATE_RECS_UNKONWN_TABLE:w+c,UPDATE_RECS_UNKONWN_FIELD:w+u,UPDATE_RECS_ACCESS_DENIED:w+d,UPDATE_RECS_DATATYPE_MISMATCH:w+f,UPDATE_RECS_UNKNOWN_ID:w+7,UPDATE_RECS_UNKNOWN_RECORD_TYPE:w+m,GET_REC_TYPES_UNKONWN_TABLE:b+c,analInc:function(e){return I(e)},deleteRecord:function(e,n,t){return k(e,[n],t)},dirtyTables:function(e){return x(e)},syncMobileTable:function(e,n,t,o,r){return z(e,n,t,o,r)},initialSync:function(e){return Y(e)},getCurrentUserId:function(){return P()},getCurrentUserName:function(){return e="",new Promise(function(n,t){O("userFirstName").then(function(n){return e=n,O("userLastName")}).then(function(t){n(e+" "+t)}).catch(function(e){a.error("getCurrentUserName",e),t(e)})});var e},getUserLocale:function(){return O("userLocale")},getCachedAppSoupValue:function(e){return O(e)},getRecordTypes:function(e){return function(e){return new Promise(function(n,t){M(e,b).then(function(){return F()}).then(function(t){n(t[e])}).catch(function(e){t(e)})})}(e)},insertRecord:function(e,n){return J(e,[n])},insertRecords:function(e,n){return J(e,n)},logout:function(){return localStorage.clear(),void(navigator.appVersion.includes("Electron")?ipcRenderer.sendSync("logout",""):"undefined"!=typeof plugin&&plugin.mcsdk?plugin.mcsdk.logout():cordova.require("com.salesforce.plugin.sfaccountmanager").logout())},readRecords:function(e,n){return B(e,n)},smartSql:function(e){return K(e)},updateRecord:function(e,n,t){return $(e,[n],t)},updateRecords:function(e,n,t){return $(e,n,t)},maybeReadTransformType:function(e,n,t){return A(e,0,t)},maybeWriteTransformType:function(e,n,t){return U(e,n,t)},upgradeAvailable:function(){return ee()}}}),window.mobileCaddy=e("mobileCaddy")}();